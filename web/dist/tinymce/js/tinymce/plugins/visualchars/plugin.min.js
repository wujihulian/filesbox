(function(i){"use strict";function Y(){}function l(n){return function(){return n}}function E(){return y}var T,_=function(n){function t(){return e}var e=n;return{get:t,set:function(r){e=r},clone:function(){return _(t())}}},z=tinymce.util.Tools.resolve("tinymce.PluginManager"),W=function(n){return{isEnabled:function(){return n.get()}}},K=function(n,t){return n.fire("VisualChars",{state:t})},m=l(!1),O=l(!0),y=(T={fold:function(n,t){return n()},is:m,isSome:m,isNone:O,getOr:S,getOrThunk:M,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:l(null),getOrUndefined:l(void 0),or:S,orThunk:M,map:E,each:Y,bind:E,exists:m,forall:O,filter:E,equals:w,equals_:w,toArray:function(){return[]},toString:l("none()")},Object.freeze&&Object.freeze(T),T);function w(n){return n.isNone()}function M(n){return n()}function S(n){return n}function N(n){return function(t){return function(e){if(e===null)return"null";var r=typeof e;return r=="object"&&(Array.prototype.isPrototypeOf(e)||e.constructor&&e.constructor.name==="Array")?"array":r=="object"&&(String.prototype.isPrototypeOf(e)||e.constructor&&e.constructor.name==="String")?"string":r}(t)===n}}function b(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e)}function k(n){return n.dom().nodeValue}function x(n,t,e){(function(r,o,u){if(!($(u)||nn(u)||tn(u)))throw i.console.error("Invalid call to Attr.set. Key ",o,":: Value ",u,":: Element ",r),new Error("Attribute value was not simple");r.setAttribute(o,u+"")})(n.dom(),t,e)}function I(n,t){n.dom().removeAttribute(t)}function D(n,t){var e=function(r,o){var u=r.dom().getAttribute(o);return u===null?void 0:u}(n,t);return e===void 0||e===""?[]:e.split(" ")}function C(n){return n.dom().classList!==void 0}function X(n,t){return function(e,r,o){var u=D(e,r).concat([o]);return x(e,r,u.join(" ")),!0}(n,"class",t)}function J(n,t){return function(e,r,o){var u=function(c,f){for(var a=[],s=0,gn=c.length;s<gn;s++){var H=c[s];f(H,s)&&a.push(H)}return a}(D(e,r),function(c){return c!==o});return 0<u.length?x(e,r,u.join(" ")):I(e,r),!1}(n,"class",t)}function Q(n){(C(n)?n.dom().classList:function(t){return D(t,"class")}(n)).length===0&&I(n,"class")}function A(n,t){var e,r="";for(e in n)r+=e;return new RegExp("["+r+"]",t?"g":"")}function L(n){var t,e="";for(t in n)e&&(e+=","),e+="span.mce-"+n[t];return e}function P(n){return n.nodeName.toLowerCase()==="span"&&n.classList.contains("mce-nbsp-wrap")}function B(n,t){var e=p.filterDescendants(v.fromDom(t),p.isMatch);b(e,function(r){var o=r.dom().parentNode;if(P(o))(function(a,s){C(a)?a.dom().classList.add(s):X(a,s)})(v.fromDom(o),d.nbspClass);else{for(var u=p.replaceWithSpans(n.dom.encode(k(r))),c=n.dom.create("div",null,u),f=void 0;f=c.lastChild;)n.dom.insertAfter(f,r.dom());n.dom.remove(r.dom())}})}function R(n,t){var e=n.dom.select(d.selector,t);b(e,function(r){P(r)?function(o,u){C(o)?o.dom().classList.remove(u):J(o,u),Q(o)}(v.fromDom(r),d.nbspClass):n.dom.remove(r,!0)})}function V(n,t){return function(e){e.setActive(t.get());function r(o){return e.setActive(o.state)}return n.on("VisualChars",r),function(){return n.off("VisualChars",r)}}}var U,j=function(n){function t(){return o}function e(u){return u(n)}var r=l(n),o={fold:function(u,c){return c(n)},is:function(u){return n===u},isSome:O,isNone:m,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(u){return j(u(n))},each:function(u){u(n)},bind:e,exists:e,forall:e,filter:function(u){return u(n)?o:y},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(u){return u.is(n)},equals_:function(u,c){return u.fold(m,function(f){return c(n,f)})}};return o},Z=function(n){return n==null?y:j(n)},$=N("string"),nn=N("boolean"),en=N("function"),tn=N("number"),Nn=Array.prototype.slice,rn=(en(Array.from)&&Array.from,i.Node.ATTRIBUTE_NODE,i.Node.CDATA_SECTION_NODE,i.Node.COMMENT_NODE,i.Node.DOCUMENT_NODE,i.Node.DOCUMENT_TYPE_NODE,i.Node.DOCUMENT_FRAGMENT_NODE,i.Node.ELEMENT_NODE,i.Node.TEXT_NODE),on=(i.Node.PROCESSING_INSTRUCTION_NODE,i.Node.ENTITY_REFERENCE_NODE,i.Node.ENTITY_NODE,i.Node.NOTATION_NODE,typeof i.window!="undefined"?i.window:Function("return this;")(),U=rn,function(n){return function(t){return t.dom().nodeType}(n)===U}),g=function(n){if(n==null)throw new Error("Node cannot be null or undefined");return{dom:l(n)}},v={fromHtml:function(n,t){var e=(t||i.document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||1<e.childNodes.length)throw i.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return g(e.childNodes[0])},fromTag:function(n,t){var e=(t||i.document).createElement(n);return g(e)},fromText:function(n,t){var e=(t||i.document).createTextNode(n);return g(e)},fromDom:g,fromPoint:function(n,t,e){var r=n.dom();return Z(r.elementFromPoint(t,e)).map(g)}},h={"\xA0":"nbsp","\xAD":"shy"},d={charMap:h,regExp:A(h),regExpGlobal:A(h,!0),selector:L(h),nbspClass:"mce-nbsp",charMapToRegExp:A,charMapToSelector:L},un=function(n){return'<span data-mce-bogus="1" class="mce-'+d.charMap[n]+'">'+n+"</span>"},q=function(n,t){var e=[],r=function(o,u){for(var c=o.length,f=new Array(c),a=0;a<c;a++){var s=o[a];f[a]=u(s,a)}return f}(n.dom().childNodes,v.fromDom);return b(r,function(o){t(o)&&(e=e.concat([o])),e=e.concat(q(o,t))}),e},p={isMatch:function(n){var t=k(n);return on(n)&&t!==void 0&&d.regExp.test(t)},filterDescendants:q,findParentElm:function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}},replaceWithSpans:function(n){return n.replace(d.regExpGlobal,un)}},cn=B,an=R,F=function(n){var t=n.getBody(),e=n.selection.getBookmark(),r=p.findParentElm(n.selection.getNode(),t);r=r!==void 0?r:t,R(n,r),B(n,r),n.selection.moveToBookmark(e)},G=function(n,t){var e,r=n.getBody(),o=n.selection;t.set(!t.get()),K(n,t.get()),e=o.getBookmark(),t.get()===!0?cn(n,r):an(n,r),o.moveToBookmark(e)},fn=function(n,t){n.addCommand("mceVisualChars",function(){G(n,t)})},sn=tinymce.util.Tools.resolve("tinymce.util.Delay"),ln=function(n,t){var e=sn.debounce(function(){F(n)},300);n.settings.forced_root_block!==!1&&n.on("keydown",function(r){t.get()===!0&&(r.keyCode===13?F(n):e())})},dn=function(n){return n.getParam("visualchars_default_state",!1)},mn=function(n,t){n.on("init",function(){var e=!dn(n);t.set(e),G(n,t)})};(function(){z.add("visualchars",function(t){var e=_(!1);return fn(t,e),function(r,o){r.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:V(r,o)}),r.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:V(r,o)})}(t,e),ln(t,e),mn(t,e),W(e)})})()})(window);
