(function(s){"use strict";function Xn(){}function U(){return q}var z,L=function(n){function e(){return t}var t=n;return{get:e,set:function(o){t=o},clone:function(){return L(e())}}},Wn=tinymce.util.Tools.resolve("tinymce.PluginManager"),k=tinymce.util.Tools.resolve("tinymce.util.Tools"),c=function(n){return function(){return n}},S=c(!1),H=c(!0),q=(z={fold:function(n,e){return n()},is:S,isSome:S,isNone:H,getOr:Z,getOrThunk:Q,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(void 0),or:Z,orThunk:Q,map:U,each:Xn,bind:U,exists:S,forall:H,filter:U,equals:K,equals_:K,toArray:function(){return[]},toString:c("none()")},Object.freeze&&Object.freeze(z),z);function K(n){return n.isNone()}function Q(n){return n()}function Z(n){return n}var $=function(n){function e(){return r}function t(u){return u(n)}var o=c(n),r={fold:function(u,i){return i(n)},is:function(u){return n===u},isSome:H,isNone:S,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:e,orThunk:e,map:function(u){return $(u(n))},each:function(u){u(n)},bind:t,exists:t,forall:t,filter:function(u){return u(n)?r:q},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(u){return u.is(n)},equals_:function(u,i){return u.fold(S,function(a){return i(n,a)})}};return r},v={some:$,none:U,from:function(n){return n==null?q:$(n)}};function j(n,e){return nn(s.document.createElement("canvas"),n,e)}function Gn(n){var e=j(n.width,n.height);return P(e).drawImage(n,0,0),e}function P(n){return n.getContext("2d")}function nn(n,e,t){return n.width=e,n.height=t,n}var en,tn,T=window.Promise?window.Promise:(en=h.immediateFn||typeof window.setImmediate=="function"&&window.setImmediate||function(n){s.setTimeout(n,1)},tn=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"},h.prototype.catch=function(n){return this.then(null,n)},h.prototype.then=function(n,e){var t=this;return new h(function(o,r){rn.call(t,new Yn(n,e,o,r))})},h.all=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Array.prototype.slice.call(n.length===1&&tn(n[0])?n[0]:n);return new h(function(o,r){if(t.length===0)return o([]);var u=t.length;function i(f,l){try{if(l&&(typeof l=="object"||typeof l=="function")){var d=l.then;if(typeof d=="function")return void d.call(l,function(m){i(f,m)},r)}t[f]=l,--u==0&&o(t)}catch(m){r(m)}}for(var a=0;a<t.length;a++)i(a,t[a])})},h.resolve=function(n){return n&&typeof n=="object"&&n.constructor===h?n:new h(function(e){e(n)})},h.reject=function(n){return new h(function(e,t){t(n)})},h.race=function(n){return new h(function(e,t){for(var o=0,r=n;o<r.length;o++)r[o].then(e,t)})},h);function h(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof n!="function")throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],an(n,_(on,this),_(X,this))}function _(n,e){return function(){return n.apply(e,arguments)}}function rn(n){var e=this;this._state!==null?en(function(){var t=e._state?n.onFulfilled:n.onRejected;if(t!==null){var o;try{o=t(e._value)}catch(r){return void n.reject(r)}n.resolve(o)}else(e._state?n.resolve:n.reject)(e._value)}):this._deferreds.push(n)}function on(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&(typeof n=="object"||typeof n=="function")){var e=n.then;if(typeof e=="function")return void an(_(e,n),_(on,this),_(X,this))}this._state=!0,this._value=n,un.call(this)}catch(t){X.call(this,t)}}function X(n){this._state=!1,this._value=n,un.call(this)}function un(){for(var n=0,e=this._deferreds;n<e.length;n++){var t=e[n];rn.call(this,t)}this._deferreds=[]}function Yn(n,e,t,o){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=o}function an(n,e,t){var o=!1;try{n(function(r){o||(o=!0,e(r))},function(r){o||(o=!0,t(r))})}catch(r){if(o)return;o=!0,t(r)}}function Vn(n){var e=n.src;return e.indexOf("data:")===0?sn(e):function(o){return new T(function(r,u){var i=new s.XMLHttpRequest;i.open("GET",o,!0),i.responseType="blob",i.onload=function(){this.status===200&&r(this.response)},i.onerror=function(){var a,f=this;u(this.status===0?((a=new Error("No access to download image")).code=18,a.name="SecurityError",a):new Error("Error "+f.status+" downloading image"))},i.send()})}(e)}function cn(n){return new T(function(e,t){var o=s.URL.createObjectURL(n),r=new s.Image,u=function(){r.removeEventListener("load",i),r.removeEventListener("error",a)};function i(){u(),e(r)}function a(){u(),t("Unable to load data of type "+n.type+": "+o)}r.addEventListener("load",i),r.addEventListener("error",a),r.src=o,r.complete&&i()})}function sn(n){return new T(function(e,t){(function(r){var u=r.split(","),i=/data:([^;]+)/.exec(u[0]);if(!i)return v.none();for(var a=i[1],f=u[1],l=s.atob(f),d=l.length,m=Math.ceil(d/1024),p=new Array(m),w=0;w<m;++w){for(var b=1024*w,I=Math.min(1024+b,d),C=new Array(I-b),D=b,$n=0;D<I;++$n,++D)C[$n]=l[D].charCodeAt(0);p[w]=new Uint8Array(C)}return v.some(new s.Blob(p,{type:a}))})(n).fold(function(){t("uri is not base64: "+n)},e)})}function fn(n,e,t){return e=e||"image/png",s.HTMLCanvasElement.prototype.toBlob?new T(function(o,r){n.toBlob(function(u){u?o(u):r()},e,t)}):sn(n.toDataURL(e,t))}function Jn(n){return cn(n).then(function(e){(function(r){s.URL.revokeObjectURL(r.src)})(e);var t=j(function(r){return r.naturalWidth||r.width}(e),function(r){return r.naturalHeight||r.height}(e));return P(t).drawImage(e,0,0),t})}function ln(n,e,t){var o=e.type;function r(u,i){return n.then(function(a){return function(l,d,m){return d=d||"image/png",l.toDataURL(d,m)}(a,u,i)})}return{getType:c(o),toBlob:function(){return T.resolve(e)},toDataURL:function(){return t},toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(i,a){return n.then(function(f){return fn(f,i,a)})},toAdjustedDataURL:r,toAdjustedBase64:function(i,a){return r(i,a).then(function(f){return f.split(",")[1]})},toCanvas:function(){return n.then(Gn)}}}function Kn(n){return function(t){return new T(function(o){var r=new s.FileReader;r.onloadend=function(){o(r.result)},r.readAsDataURL(t)})}(n).then(function(e){return ln(Jn(n),n,e)})}function dn(n,e){return fn(n,e).then(function(t){return ln(T.resolve(n),t,n.toDataURL())})}function Qn(n,e){return n.toCanvas().then(function(t){return function(r,u,i){var a=j(r.width,r.height),f=P(a),l=0,d=0;return(i=i<0?360+i:i)!==90&&i!==270||nn(a,a.height,a.width),i!==90&&i!==180||(l=a.width),i!==270&&i!==180||(d=a.height),f.translate(l,d),f.rotate(i*Math.PI/180),f.drawImage(r,0,0),dn(a,u)}(t,n.getType(),e)})}function Zn(n,e){return n.toCanvas().then(function(t){return function(r,u,i){var a=j(r.width,r.height),f=P(a);return i==="v"?(f.scale(1,-1),f.drawImage(r,0,-a.height)):(f.scale(-1,1),f.drawImage(r,-a.width,0)),dn(a,u)}(t,n.getType(),e)})}function mn(n){return Kn(n)}var hn=tinymce.util.Tools.resolve("tinymce.util.Delay"),O=tinymce.util.Tools.resolve("tinymce.util.Promise"),W=tinymce.util.Tools.resolve("tinymce.util.URI");function M(n,e){for(var t=0,o=n.length;t<o;t++){var r=n[t];if(e(r,t))return v.some(r)}return v.none()}function gn(n){return n!=null}function ne(n){return"ImageProxy HTTP error: "+M(ce,function(e){return n===e.code}).fold(c("Unknown ImageProxy error"),function(e){return e.message})}function pn(n){var e=ne(n);return O.reject(e)}function ee(n){return M(se,function(e){return e.type===n}).fold(c("Unknown service error"),function(e){return e.message})}function te(n,e){return ue(e).then(function(t){var o=function(r){var u=ae(r),i=ie(u,["error","type"]);return"ImageProxy Service error: "+(i?ee(i):"Invalid JSON in service error message")}(t);return O.reject(o)})}function re(n,e){var t={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e};return wn(function(o,r){var u=o.indexOf("?")===-1?"?":"&";return/[?&]apiKey=/.test(o)||!r?o:o+u+"apiKey="+encodeURIComponent(r)}(n,e),t,!1).then(function(o){return o.status<200||300<=o.status?fe(o.status,o.blob):O.resolve(o.blob)})}var vn,x={getImageSize:function(e){var t,o;function r(u){return/^[0-9\.]+px$/.test(u)}return t=e.style.width,o=e.style.height,t||o?r(t)&&r(o)?{w:parseInt(t,10),h:parseInt(o,10)}:null:(t=e.width,o=e.height,t&&o?{w:parseInt(t,10),h:parseInt(o,10)}:null)},setImageSize:function(e,t){var o,r;t&&(o=e.style.width,r=e.style.height,(o||r)&&(e.style.width=t.w+"px",e.style.height=t.h+"px",e.removeAttribute("data-mce-style")),o=e.width,r=e.height,(o||r)&&(e.setAttribute("width",t.w),e.setAttribute("height",t.h)))},getNaturalImageSize:function(e){return{w:e.naturalWidth,h:e.naturalHeight}}},oe=(vn="function",function(n){return function(e){if(e===null)return"null";var t=typeof e;return t=="object"&&(Array.prototype.isPrototypeOf(e)||e.constructor&&e.constructor.name==="Array")?"array":t=="object"&&(String.prototype.isPrototypeOf(e)||e.constructor&&e.constructor.name==="String")?"string":t}(n)===vn}),je=Array.prototype.slice,ie=(oe(Array.from)&&Array.from,function(n,e){var t;return t=e.reduce(function(o,r){return gn(o)?o[r]:void 0},n),gn(t)?t:null}),ue=function(n){return new O(function(e){var t=new s.FileReader;t.onload=function(o){var r=o.target;e(r.result)},t.readAsText(n)})},wn=function(n,e,t){return new O(function(o){var r;(r=new s.XMLHttpRequest).onreadystatechange=function(){r.readyState===4&&o({status:r.status,blob:this.response})},r.open("GET",n,!0),r.withCredentials=t,k.each(e,function(u,i){r.setRequestHeader(i,u)}),r.responseType="blob",r.send()})},ae=function(n){var e;try{e=JSON.parse(n)}catch(t){}return e},ce=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],se=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],fe=function(n,e){return function(t){return t===400||t===403||t===500}(n)?te(0,e):pn(n)},le=pn;function yn(n,e,t){return e?re(n,e):function(r,u){return wn(r,{},u).then(function(i){return i.status<200||300<=i.status?le(i.status):O.resolve(i.blob)})}(n,t)}function de(n,e,t){return(n.compareDocumentPosition(e)&t)!=0}function me(n,e){var t=function(r,u){for(var i=0;i<r.length;i++){var a=r[i];if(a.test(u))return a}}(n,e);if(!t)return{major:0,minor:0};function o(r){return Number(e.replace(t,"$"+r))}return Y(o(1),o(2))}function N(n,e){return function(){return e===n}}function E(n,e){return function(){return e===n}}function bn(n,e){var t=String(e).toLowerCase();return M(n,function(o){return o.search(t)})}function g(n,e){return n.indexOf(e)!==-1}function y(n){return function(e){return g(e,n)}}function he(n,e){return function(t,o){return M(t.dom().childNodes,function(r){return o(F.fromDom(r))}).map(F.fromDom)}(n,function(t){return function(o,r){var u=o.dom();if(u.nodeType!==Te)return!1;var i=u;if(i.matches!==void 0)return i.matches(r);if(i.msMatchesSelector!==void 0)return i.msMatchesSelector(r);if(i.webkitMatchesSelector!==void 0)return i.webkitMatchesSelector(r);if(i.mozMatchesSelector!==void 0)return i.mozMatchesSelector(r);throw new Error("Browser lacks native selectors")}(t,e)})}function On(n){return he(F.fromDom(n),"img")}function En(n,e){return n.dom.is(e,"figure")}function Tn(n,e){n.notificationManager.open({text:e,type:"error"})}function G(n){var e=n.selection.getNode();return En(n,e)?On(e):v.some(F.fromDom(e))}function ge(n,e){var t,o=e.src;return zn(n,e)?yn(e.src,null,function(r,u){return k.inArray(function(i){return i.getParam("imagetools_credentials_hosts",[],"string[]")}(r),new W(u.src).host)!==-1}(n,e)):Fn(n,e)?function(r){return Vn(r)}(e):(o=function(r){return r.getParam("imagetools_proxy")}(n),o+=(o.indexOf("?")===-1?"?":"&")+"url="+encodeURIComponent(e.src),t=function(r){return r.getParam("api_key",r.getParam("imagetools_api_key","","string"),"string")}(n),yn(o,t,!1))}function pe(n,e){return function(t){return v.from(t.getParam("imagetools_fetch_image",null,"function"))}(n).fold(function(){return ge(n,e)},function(t){return t(e)})}function In(n,e){var t;return(t=n.editorUpload.blobCache.getByUri(e.src))?O.resolve(t.blob()):pe(n,e)}function Nn(n){hn.clearTimeout(n.get())}function Sn(n,e,t,o,r,u){return e.toBlob().then(function(i){var a,f,l,d;return l=n.editorUpload.blobCache,a=r.src,function(m){return m.getParam("images_reuse_filename",!1,"boolean")}(n)&&(f=(d=l.getByUri(a))?(a=d.uri(),d.name()):function(m,p){var w=p.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return w?m.dom.encode(w[1]):null}(n,a)),d=l.create({id:"imagetools"+Ie++,blob:i,base64:e.toBase64(),uri:a,name:f}),l.add(d),n.undoManager.transact(function(){n.$(r).on("load",function m(){n.$(r).off("load",m),n.nodeChanged(),t?n.editorUpload.uploadImagesAuto():(Nn(o),function(p,w){var b=hn.setEditorTimeout(p,function(){p.editorUpload.uploadImagesAuto()},function(I){return I.getParam("images_upload_timeout",3e4,"number")}(p));w.set(b)}(n,o))}),u&&n.$(r).attr({width:u.w,height:u.h}),n.$(r).attr({src:d.blobUri()}).removeAttr("data-mce-src")}),d})}function _n(n,e,t,o){return function(){return G(n).fold(function(){Tn(n,"Could not find selected image")},function(r){return n._scanForImages().then(function(){return In(n,r.dom())}).then(mn).then(t).then(function(u){return Sn(n,u,!1,e,r.dom(),o)},function(u){Tn(n,u)})})}}var Pe=function(n,e){return de(n,e,s.Node.DOCUMENT_POSITION_CONTAINED_BY)},xn=function(){return Y(0,0)},Y=function(n,e){return{major:n,minor:e}},B={nu:Y,detect:function(n,e){var t=String(e).toLowerCase();return n.length===0?xn():me(n,t)},unknown:xn},Rn="Firefox",An=function(n){var e=n.current;return{current:e,version:n.version,isEdge:N("Edge",e),isChrome:N("Chrome",e),isIE:N("IE",e),isOpera:N("Opera",e),isFirefox:N(Rn,e),isSafari:N("Safari",e)}},Cn={unknown:function(){return An({current:void 0,version:B.unknown()})},nu:An,edge:c("Edge"),chrome:c("Chrome"),ie:c("IE"),opera:c("Opera"),firefox:c(Rn),safari:c("Safari")},Dn="Windows",Un="Android",Ln="Solaris",kn="FreeBSD",jn="ChromeOS",Pn=function(n){var e=n.current;return{current:e,version:n.version,isWindows:E(Dn,e),isiOS:E("iOS",e),isAndroid:E(Un,e),isOSX:E("OSX",e),isLinux:E("Linux",e),isSolaris:E(Ln,e),isFreeBSD:E(kn,e),isChromeOS:E(jn,e)}},Mn={unknown:function(){return Pn({current:void 0,version:B.unknown()})},nu:Pn,windows:c(Dn),ios:c("iOS"),android:c(Un),linux:c("Linux"),osx:c("OSX"),solaris:c(Ln),freebsd:c(kn),chromeos:c(jn)},ve=function(n,e){return bn(n,e).map(function(t){var o=B.detect(t.versionRegexes,e);return{current:t.name,version:o}})},we=function(n,e){return bn(n,e).map(function(t){var o=B.detect(t.versionRegexes,e);return{current:t.name,version:o}})},V=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,ye=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return g(n,"edge/")&&g(n,"chrome")&&g(n,"safari")&&g(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,V],search:function(n){return g(n,"chrome")&&!g(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return g(n,"msie")||g(n,"trident")}},{name:"Opera",versionRegexes:[V,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:y("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:y("firefox")},{name:"Safari",versionRegexes:[V,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(g(n,"safari")||g(n,"mobile/"))&&g(n,"applewebkit")}}],be=[{name:"Windows",search:y("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return g(n,"iphone")||g(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:y("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:y("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:y("linux"),versionRegexes:[]},{name:"Solaris",search:y("sunos"),versionRegexes:[]},{name:"FreeBSD",search:y("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:y("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Bn={browsers:c(ye),oses:c(be)},Oe=L(function(n,e){var t=Bn.browsers(),o=Bn.oses(),r=ve(t,n).fold(Cn.unknown,Cn.nu),u=we(o,n).fold(Mn.unknown,Mn.nu);return{browser:r,os:u,deviceType:function(i,a,f,l){var d=i.isiOS()&&/ipad/i.test(f)===!0,m=i.isiOS()&&!d,p=i.isiOS()||i.isAndroid(),w=p||l("(pointer:coarse)"),b=d||!m&&p&&l("(min-device-width:768px)"),I=m||p&&!b,C=a.isSafari()&&i.isiOS()&&/safari/i.test(f)===!1,D=!I&&!b&&!C;return{isiPad:c(d),isiPhone:c(m),isTablet:c(b),isPhone:c(I),isTouch:c(w),isAndroid:i.isAndroid,isiOS:i.isiOS,isWebView:c(C),isDesktop:c(D)}}(u,r,n,e)}}(s.navigator.userAgent,function(n){return s.window.matchMedia(n).matches})),R=function(n){if(n==null)throw new Error("Node cannot be null or undefined");return{dom:c(n)}},F={fromHtml:function(n,e){var t=(e||s.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw s.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return R(t.childNodes[0])},fromTag:function(n,e){var t=(e||s.document).createElement(n);return R(t)},fromText:function(n,e){var t=(e||s.document).createTextNode(n);return R(t)},fromDom:R,fromPoint:function(n,e,t){var o=n.dom();return v.from(o.elementFromPoint(e,t)).map(R)}},Ee=(s.Node.ATTRIBUTE_NODE,s.Node.CDATA_SECTION_NODE,s.Node.COMMENT_NODE,s.Node.DOCUMENT_NODE,s.Node.DOCUMENT_TYPE_NODE,s.Node.DOCUMENT_FRAGMENT_NODE,s.Node.ELEMENT_NODE),Te=(s.Node.TEXT_NODE,s.Node.PROCESSING_INSTRUCTION_NODE,s.Node.ENTITY_REFERENCE_NODE,s.Node.ENTITY_NODE,s.Node.NOTATION_NODE,Ee),Ie=(Oe.get().browser.isIE(),typeof s.window!="undefined"?s.window:Function("return this;")(),0),Fn=function(n,e){var t=e.src;return t.indexOf("data:")===0||t.indexOf("blob:")===0||new W(t).host===n.documentBaseURI.host},zn=function(n,e){return k.inArray(function(t){return t.getParam("imagetools_cors_hosts",[],"string[]")}(n),new W(e.src).host)!==-1},Hn=function(n,e,t){return function(){var o=G(n).fold(function(){return null},function(r){var u=x.getImageSize(r.dom());return u?{w:u.h,h:u.w}:null});return _n(n,e,function(r){return function(u,i){return Qn(u,i)}(r,t)},o)()}},qn=function(n,e,t){return function(){return _n(n,e,function(o){return function(r,u){return Zn(r,u)}(o,t)})()}},A=function(n,e){function t(o){return function(r){return n.dom.is(r,"img:not([data-mce-object],[data-mce-placeholder])")}(o)&&(Fn(n,o)||zn(n,o)||n.settings.imagetools_proxy)}return En(n,e)?On(e).map(function(o){return t(o.dom())?v.some(o.dom()):v.none()}):t(e)?v.some(e):v.none()},Ne=Nn,Se=In,J=G,_e=function(n,e,t,o,r){return new O(function(u){(function(i){return cn(i)})(r).then(function(i){var a=x.getNaturalImageSize(i);return o.w===a.w&&o.h===a.h||x.getImageSize(t)&&x.setImageSize(t,a),s.URL.revokeObjectURL(i.src),r}).then(mn).then(function(i){return Sn(n,i,!0,e,t)},function(){})})},xe=c("save-state"),Re=c("disable"),Ae=c("enable"),Ce=function(n,e){return function(){var t=J(n),o=t.map(function(r){return x.getNaturalImageSize(r.dom())});J(n).each(function(r){A(n,r.dom()).each(function(u){Se(n,r.dom()).then(function(i){var a=function(f){return{blob:f,url:s.URL.createObjectURL(f)}}(i);n.windowManager.open(function(f){return{title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:f}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(l){var d=l.getData().imagetools.blob;t.each(function(m){o.each(function(p){_e(n,e,m.dom(),p,d)})}),l.close()},onCancel:function(){},onAction:function(l,d){switch(d.name){case xe():d.value?l.enable("save"):l.disable("save");break;case Re():l.disable("save"),l.disable("cancel");break;case Ae():l.enable("cancel")}}}}(a))})})})}},De=function(n,e){k.each({mceImageRotateLeft:Hn(n,e,-90),mceImageRotateRight:Hn(n,e,90),mceImageFlipVertical:qn(n,e,"v"),mceImageFlipHorizontal:qn(n,e,"h"),mceEditImage:Ce(n,e)},function(t,o){n.addCommand(o,t)})},Ue=function(n,e,t){n.on("NodeChange",function(o){var r=t.get();r&&r.src!==o.element.src&&(Ne(e),n.editorUpload.uploadImagesAuto(),t.set(null)),A(n,o.element).each(t.set)})},Le=function(n){function e(t){return function(){return n.execCommand(t)}}n.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:e("mceImageRotateLeft")}),n.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:e("mceImageRotateRight")}),n.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:e("mceImageFlipVertical")}),n.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:e("mceImageFlipHorizontal")}),n.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:e("mceEditImage"),onSetup:function(t){function o(){J(n).each(function(r){var u=A(n,r.dom()).isNone();t.setDisabled(u)})}return n.on("NodeChange",o),function(){n.off("NodeChange",o)}}}),n.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image-options",onAction:e("mceImage")}),n.ui.registry.addContextMenu("imagetools",{update:function(t){return A(n,t).fold(function(){return[]},function(o){return[{text:"Edit image",icon:"edit-image",onAction:e("mceEditImage")}]})}})},ke=function(n){n.ui.registry.addContextToolbar("imagetools",{items:function(e){return e.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions")}(n),predicate:function(e){return A(n,e).isSome()},position:"node",scope:"node"})};(function(){Wn.add("imagetools",function(e){var t=L(0),o=L(null);De(e,t),Le(e),ke(e),Ue(e,t,o)})})()})(window);
