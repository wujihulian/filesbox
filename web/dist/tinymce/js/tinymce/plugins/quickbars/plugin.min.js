(function(s){"use strict";function ie(){}function u(e){return function(){return e}}function w(){return k}var y,ue=tinymce.util.Tools.resolve("tinymce.PluginManager"),ce=0,se=function(e,n,r){e.plugins.table?e.plugins.table.insertTable(n,r):function(t,o,i){t.undoManager.transact(function(){var c,a;t.insertContent(function(l,N){var g,p,d;for(d='<table data-mce-id="mce" style="width: 100%">',d+="<tbody>",p=0;p<N;p++){for(d+="<tr>",g=0;g<l;g++)d+="<td><br></td>";d+="</tr>"}return d+="</tbody>",d+="</table>"}(o,i)),(c=function(l){return l.dom.select("*[data-mce-id]")[0]}(t)).removeAttribute("data-mce-id"),a=t.dom.select("td,th",c),t.selection.setCursorLocation(a[0],0)})}(e,n,r)},ae=function(e,n,r){var t,o;o=(t=e.editorUpload.blobCache).create(function(i){var c=new Date().getTime();return i+"_"+Math.floor(1e9*Math.random())+ ++ce+String(c)}("mceu"),r,n),t.add(o),e.insertContent(e.dom.createHTML("img",{src:o.blobUri()}))},M=tinymce.util.Tools.resolve("tinymce.util.Promise"),fe=function(e){return new M(function(n){var r=new s.FileReader;r.onloadend=function(){n(r.result.split(",")[1])},r.readAsDataURL(e)})},de=tinymce.util.Tools.resolve("tinymce.Env"),le=tinymce.util.Tools.resolve("tinymce.util.Delay"),me=function(e){return new M(function(n){var r=s.document.createElement("input");r.type="file",r.style.position="fixed",r.style.left="0",r.style.top="0",r.style.opacity="0.001",s.document.body.appendChild(r),r.addEventListener("change",function(o){n(Array.prototype.slice.call(o.target.files))});var t=function(o){function i(){n([]),r.parentNode.removeChild(r)}de.os.isAndroid()&&o.type!=="remove"?le.setEditorTimeout(e,i,0):i(),e.off("focusin remove",t)};e.on("focusin remove",t),r.click()})},ge=function(e){e.ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:function(){me(e).then(function(n){if(0<n.length){var r=n[0];fe(r).then(function(t){ae(e,t,r)})}})}}),e.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:function(){se(e,2,2)}})},E=u(!1),x=u(!0),k=(y={fold:function(e,n){return e()},is:E,isSome:E,isNone:x,getOr:P,getOrThunk:L,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:P,orThunk:L,map:w,each:ie,bind:w,exists:E,forall:x,filter:w,equals:q,equals_:q,toArray:function(){return[]},toString:u("none()")},Object.freeze&&Object.freeze(y),y);function q(e){return e.isNone()}function L(e){return e()}function P(e){return e}function O(e){return function(n){return function(r){if(r===null)return"null";var t=typeof r;return t=="object"&&(Array.prototype.isPrototypeOf(r)||r.constructor&&r.constructor.name==="Array")?"array":t=="object"&&(String.prototype.isPrototypeOf(r)||r.constructor&&r.constructor.name==="String")?"string":t}(n)===e}}var C=function(e){function n(){return o}function r(i){return i(e)}var t=u(e),o={fold:function(i,c){return c(e)},is:function(i){return e===i},isSome:x,isNone:E,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(i){return C(i(e))},each:function(i){i(e)},bind:r,exists:r,forall:r,filter:function(i){return i(e)?o:k},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(i){return i.is(e)},equals_:function(i,c){return i.fold(E,function(a){return c(e,a)})}};return o},v={some:C,none:w,from:function(e){return e==null?k:C(e)}},T=function(e){if(e==null)throw new Error("Node cannot be null or undefined");return{dom:u(e)}},F={fromHtml:function(e,n){var r=(n||s.document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||1<r.childNodes.length)throw s.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return T(r.childNodes[0])},fromTag:function(e,n){var r=(n||s.document).createElement(e);return T(r)},fromText:function(e,n){var r=(n||s.document).createTextNode(e);return T(r)},fromDom:T,fromPoint:function(e,n,r){var t=e.dom();return v.from(t.elementFromPoint(n,r)).map(T)}},he=(s.Node.ATTRIBUTE_NODE,s.Node.CDATA_SECTION_NODE,s.Node.COMMENT_NODE,s.Node.DOCUMENT_NODE,s.Node.DOCUMENT_TYPE_NODE,s.Node.DOCUMENT_FRAGMENT_NODE,s.Node.ELEMENT_NODE),ve=(s.Node.TEXT_NODE,s.Node.PROCESSING_INSTRUCTION_NODE,s.Node.ENTITY_REFERENCE_NODE,s.Node.ENTITY_NODE,s.Node.NOTATION_NODE,typeof s.window!="undefined"?s.window:Function("return this;")(),O("string")),pe=O("object"),Oe=O("array"),be=O("boolean"),Ne=O("undefined"),D=O("function"),Pe=Array.prototype.slice;D(Array.from)&&Array.from;function U(e,n,r,t,o){return e(r,t)?v.some(r):D(o)&&o(r)?v.none():n(r,t,o)}function Ee(e,n,r){return(e.compareDocumentPosition(n)&r)!=0}function Te(e,n){var r=function(o,i){for(var c=0;c<o.length;c++){var a=o[c];if(a.test(i))return a}}(e,n);if(!r)return{major:0,minor:0};function t(o){return Number(n.replace(r,"$"+o))}return _(t(1),t(2))}function b(e,n){return function(){return n===e}}function h(e,n){return function(){return n===e}}function B(e,n){var r=String(n).toLowerCase();return function(t,o){for(var i=0,c=t.length;i<c;i++){var a=t[i];if(o(a,i))return v.some(a)}return v.none()}(e,function(t){return t.search(r)})}function f(e,n){return e.indexOf(n)!==-1}function m(e){return function(n){return f(n,e)}}function j(e,n){var r=e.dom();if(r.nodeType!==De)return!1;var t=r;if(t.matches!==void 0)return t.matches(n);if(t.msMatchesSelector!==void 0)return t.msMatchesSelector(n);if(t.webkitMatchesSelector!==void 0)return t.webkitMatchesSelector(n);if(t.mozMatchesSelector!==void 0)return t.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")}function H(e,n,r){for(var t=e.dom(),o=D(r)?r:u(!1);t.parentNode;){t=t.parentNode;var i=F.fromDom(t);if(n(i))return v.some(i);if(o(i))break}return v.none()}function we(e,n,r){return H(e,function(t){return j(t,n)},r)}var X,Fe=function(e,n){return Ee(e,n,s.Node.DOCUMENT_POSITION_CONTAINED_BY)},z=function(e){function n(){return r}var r=e;return{get:n,set:function(t){r=t},clone:function(){return z(n())}}},G=function(){return _(0,0)},_=function(e,n){return{major:e,minor:n}},S={nu:_,detect:function(e,n){var r=String(n).toLowerCase();return e.length===0?G():Te(e,r)},unknown:G},W="Firefox",Y=function(e){var n=e.current;return{current:n,version:e.version,isEdge:b("Edge",n),isChrome:b("Chrome",n),isIE:b("IE",n),isOpera:b("Opera",n),isFirefox:b(W,n),isSafari:b("Safari",n)}},$={unknown:function(){return Y({current:void 0,version:S.unknown()})},nu:Y,edge:u("Edge"),chrome:u("Chrome"),ie:u("IE"),opera:u("Opera"),firefox:u(W),safari:u("Safari")},V="Windows",J="Android",K="Solaris",Q="FreeBSD",Z="ChromeOS",ee=function(e){var n=e.current;return{current:n,version:e.version,isWindows:h(V,n),isiOS:h("iOS",n),isAndroid:h(J,n),isOSX:h("OSX",n),isLinux:h("Linux",n),isSolaris:h(K,n),isFreeBSD:h(Q,n),isChromeOS:h(Z,n)}},ne={unknown:function(){return ee({current:void 0,version:S.unknown()})},nu:ee,windows:u(V),ios:u("iOS"),android:u(J),linux:u("Linux"),osx:u("OSX"),solaris:u(K),freebsd:u(Q),chromeos:u(Z)},Se=function(e,n){return B(e,n).map(function(r){var t=S.detect(r.versionRegexes,n);return{current:r.name,version:t}})},ye=function(e,n){return B(e,n).map(function(r){var t=S.detect(r.versionRegexes,n);return{current:r.name,version:t}})},A=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,xe=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return f(e,"edge/")&&f(e,"chrome")&&f(e,"safari")&&f(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,A],search:function(e){return f(e,"chrome")&&!f(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return f(e,"msie")||f(e,"trident")}},{name:"Opera",versionRegexes:[A,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:m("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:m("firefox")},{name:"Safari",versionRegexes:[A,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(f(e,"safari")||f(e,"mobile/"))&&f(e,"applewebkit")}}],ke=[{name:"Windows",search:m("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return f(e,"iphone")||f(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:m("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:m("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:m("linux"),versionRegexes:[]},{name:"Solaris",search:m("sunos"),versionRegexes:[]},{name:"FreeBSD",search:m("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:m("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],re={browsers:u(xe),oses:u(ke)},Ce=z(function(e,n){var r=re.browsers(),t=re.oses(),o=Se(r,e).fold($.unknown,$.nu),i=ye(t,e).fold(ne.unknown,ne.nu);return{browser:o,os:i,deviceType:function(c,a,l,N){var g=c.isiOS()&&/ipad/i.test(l)===!0,p=c.isiOS()&&!g,d=c.isiOS()||c.isAndroid(),qe=d||N("(pointer:coarse)"),I=g||!p&&d&&N("(min-device-width:768px)"),te=p||d&&!I,oe=a.isSafari()&&c.isiOS()&&/safari/i.test(l)===!1,Le=!te&&!I&&!oe;return{isiPad:u(g),isiPhone:u(p),isTablet:u(I),isPhone:u(te),isTouch:u(qe),isAndroid:c.isAndroid,isiOS:c.isiOS,isWebView:u(oe),isDesktop:u(Le)}}(i,o,e,n)}}(s.navigator.userAgent,function(e){return s.window.matchMedia(e).matches})),De=he,R=(Ce.get().browser.isIE(),{getToolbarItemsOr:(X=ve,function(e,n,r){return function(t,o){if(!o(t))throw new Error("Default value doesn't match requested type.")}(r,X),function(t,o){if(Oe(t)||pe(t))throw new Error("expected a string but found: "+t);return Ne(t)?o:be(t)?t===!1?"":o:t}(e.getParam(n,r),r)})}),_e=function(e){return R.getToolbarItemsOr(e,"quickbars_selection_toolbar","bold italic | quicklink h2 h3 blockquote")},Ae=function(e){return R.getToolbarItemsOr(e,"quickbars_insert_toolbar","quickimage quicktable")},Re=function(e){return R.getToolbarItemsOr(e,"quickbars_image_toolbar","alignleft aligncenter alignright")},Ie=function(e){var n=Ae(e);0<n.trim().length&&e.ui.registry.addContextToolbar("quickblock",{predicate:function(r){function t(c){return c.dom()===e.getBody()}var o=F.fromDom(r),i=e.schema.getTextBlockElements();return function(c,a,l){return U(j,we,c,a,l)}(o,"table",t).fold(function(){return function(c,a,l){return U(function(N,g){return g(N)},H,c,a,l)}(o,function(c){return function(a){return a.dom().nodeName.toLowerCase()}(c)in i&&e.dom.isEmpty(c.dom())},t).isSome()},function(){return!1})},items:n,position:"line",scope:"editor"})},Me=function(e){function n(o){return o.nodeName==="IMG"||o.nodeName==="FIGURE"&&/image/i.test(o.className)}var r=Re(e);0<r.trim().length&&e.ui.registry.addContextToolbar("imageselection",{predicate:n,items:r,position:"node"});var t=_e(e);0<t.trim().length&&e.ui.registry.addContextToolbar("textselection",{predicate:function(o){return!n(o)&&!e.selection.isCollapsed()&&function(i){return e.dom.getContentEditableParent(i)!=="false"}(o)},items:t,position:"selection",scope:"editor"})};(function(){ue.add("quickbars",function(n){ge(n),Ie(n),Me(n)})})()})(window);
