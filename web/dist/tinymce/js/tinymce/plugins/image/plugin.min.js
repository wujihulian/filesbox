(function(v){"use strict";function Z(){}function O(e){return function(){return e}}function tt(e){return e}function q(){return ee}var Q,nt=tinymce.util.Tools.resolve("tinymce.PluginManager"),U=O(!1),P=O(!0),ee=(Q={fold:function(e,t){return e()},is:U,isSome:U,isNone:P,getOr:ge,getOrThunk:pe,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:O(null),getOrUndefined:O(void 0),or:ge,orThunk:pe,map:q,each:Z,bind:q,exists:U,forall:P,filter:q,equals:me,equals_:me,toArray:function(){return[]},toString:O("none()")},Object.freeze&&Object.freeze(Q),Q);function me(e){return e.isNone()}function pe(e){return e()}function ge(e){return e}function L(e){return function(t){return function(n){if(n===null)return"null";var r=typeof n;return r=="object"&&(Array.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="Array")?"array":r=="object"&&(String.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="String")?"string":r}(t)===e}}function V(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!rt(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);at.apply(t,e[n])}return t}var X,he,te,k,ne=function(e){function t(){return o}function n(i){return i(e)}var r=O(e),o={fold:function(i,u){return u(e)},is:function(i){return e===i},isSome:P,isNone:U,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(i){return ne(i(e))},each:function(i){i(e)},bind:n,exists:n,forall:n,filter:function(i){return i(e)?o:ee},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(i){return i.is(e)},equals_:function(i,u){return i.fold(U,function(a){return u(e,a)})}};return o},w={some:ne,none:q,from:function(e){return e==null?ee:ne(e)}},_=L("string"),ve=L("object"),rt=L("array"),be=L("boolean"),it=L("function"),ot=L("number"),Ht=Array.prototype.slice,at=Array.prototype.push,H=(it(Array.from)&&Array.from,function(){return(H=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)}),ye={},Te={exports:ye};X=void 0,he=ye,te=Te,k=void 0,function(e){typeof he=="object"&&te!==void 0?te.exports=e():typeof X=="function"&&X.amd?X([],e):(typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this).EphoxContactWrapper=e()}(function(){return function e(t,n,r){function o(a,l){if(!n[a]){if(!t[a]){var m=typeof k=="function"&&k;if(!l&&m)return m(a,!0);if(i)return i(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var s=n[a]={exports:{}};t[a][0].call(s.exports,function(h){return o(t[a][1][h]||h)},s,s.exports,e,t,n,r)}return n[a].exports}for(var i=typeof k=="function"&&k,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){var r,o,i=t.exports={};function u(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(g){if(r===setTimeout)return setTimeout(g,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(g,0);try{return r(g,0)}catch(y){try{return r.call(null,g,0)}catch(A){return r.call(this,g,0)}}}(function(){try{r=typeof setTimeout=="function"?setTimeout:u}catch(g){r=u}try{o=typeof clearTimeout=="function"?clearTimeout:a}catch(g){o=a}})();var m,f=[],s=!1,h=-1;function I(){s&&m&&(s=!1,m.length?f=m.concat(f):h=-1,f.length&&c())}function c(){if(!s){var g=l(I);s=!0;for(var y=f.length;y;){for(m=f,f=[];++h<y;)m&&m[h].run();h=-1,y=f.length}m=null,s=!1,function(b){if(o===clearTimeout)return clearTimeout(b);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(b);try{return o(b)}catch(x){try{return o.call(null,b)}catch(N){return o.call(this,b)}}}(g)}}function d(g,y){this.fun=g,this.array=y}function p(){}i.nextTick=function(g){var y=new Array(arguments.length-1);if(1<arguments.length)for(var A=1;A<arguments.length;A++)y[A-1]=arguments[A];f.push(new d(g,y)),f.length!==1||s||l(c)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(g){return[]},i.binding=function(g){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(g){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(e,t,n){(function(r){function o(){}function i(c){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof c!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(c,this)}function u(c,d){for(;c._state===3;)c=c._value;c._state!==0?(c._handled=!0,i._immediateFn(function(){var p=c._state===1?d.onFulfilled:d.onRejected;if(p!==null){var g;try{g=p(c._value)}catch(y){return void l(d.promise,y)}a(d.promise,g)}else(c._state===1?a:l)(d.promise,c._value)})):c._deferreds.push(d)}function a(c,d){try{if(d===c)throw new TypeError("A promise cannot be resolved with itself.");if(d&&(typeof d=="object"||typeof d=="function")){var p=d.then;if(d instanceof i)return c._state=3,c._value=d,void m(c);if(typeof p=="function")return void s(function(y,A){return function(){y.apply(A,arguments)}}(p,d),c)}c._state=1,c._value=d,m(c)}catch(g){l(c,g)}}function l(c,d){c._state=2,c._value=d,m(c)}function m(c){c._state===2&&c._deferreds.length===0&&i._immediateFn(function(){c._handled||i._unhandledRejectionFn(c._value)});for(var d=0,p=c._deferreds.length;d<p;d++)u(c,c._deferreds[d]);c._deferreds=null}function f(c,d,p){this.onFulfilled=typeof c=="function"?c:null,this.onRejected=typeof d=="function"?d:null,this.promise=p}function s(c,d){var p=!1;try{c(function(g){p||(p=!0,a(d,g))},function(g){p||(p=!0,l(d,g))})}catch(g){if(p)return;p=!0,l(d,g)}}var h,I;h=this,I=setTimeout,i.prototype.catch=function(c){return this.then(null,c)},i.prototype.then=function(c,d){var p=new this.constructor(o);return u(this,new f(c,d,p)),p},i.all=function(c){var d=Array.prototype.slice.call(c);return new i(function(p,g){if(d.length===0)return p([]);var y=d.length;function A(x,N){try{if(N&&(typeof N=="object"||typeof N=="function")){var et=N.then;if(typeof et=="function")return void et.call(N,function(de){A(x,de)},g)}d[x]=N,--y==0&&p(d)}catch(de){g(de)}}for(var b=0;b<d.length;b++)A(b,d[b])})},i.resolve=function(c){return c&&typeof c=="object"&&c.constructor===i?c:new i(function(d){d(c)})},i.reject=function(c){return new i(function(d,p){p(c)})},i.race=function(c){return new i(function(d,p){for(var g=0,y=c.length;g<y;g++)c[g].then(d,p)})},i._immediateFn=typeof r=="function"?function(c){r(c)}:function(c){I(c,0)},i._unhandledRejectionFn=function(c){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",c)},i._setImmediateFn=function(c){i._immediateFn=c},i._setUnhandledRejectionFn=function(c){i._unhandledRejectionFn=c},t!==void 0&&t.exports?t.exports=i:h.Promise||(h.Promise=i)}).call(this,e("timers").setImmediate)},{timers:3}],3:[function(e,t,n){(function(r,o){var i=e("process/browser.js").nextTick,u=Function.prototype.apply,a=Array.prototype.slice,l={},m=0;function f(s,h){this._id=s,this._clearFn=h}n.setTimeout=function(){return new f(u.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new f(u.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(s){s.close()},f.prototype.unref=f.prototype.ref=function(){},f.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(s,h){clearTimeout(s._idleTimeoutId),s._idleTimeout=h},n.unenroll=function(s){clearTimeout(s._idleTimeoutId),s._idleTimeout=-1},n._unrefActive=n.active=function(s){clearTimeout(s._idleTimeoutId);var h=s._idleTimeout;0<=h&&(s._idleTimeoutId=setTimeout(function(){s._onTimeout&&s._onTimeout()},h))},n.setImmediate=typeof r=="function"?r:function(s){var h=m++,I=!(arguments.length<2)&&a.call(arguments,1);return l[h]=!0,i(function(){l[h]&&(I?s.apply(null,I):s.call(null),n.clearImmediate(h))}),h},n.clearImmediate=typeof o=="function"?o:function(s){delete l[s]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(e,t,n){var r=e("promise-polyfill"),o=typeof window!="undefined"?window:Function("return this;")();t.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)});function ut(e){v.setTimeout(function(){throw e},0)}function ct(e){return C(ae(e))}function we(e,t,n){(function(r,o,i){if(!(_(i)||be(i)||ot(i)))throw v.console.error("Invalid call to Attr.set. Key ",o,":: Value ",i,":: Element ",r),new Error("Attribute value was not simple");r.setAttribute(o,i+"")})(e.dom(),t,n)}function _e(e,t){return Math.max(parseInt(e,10),parseInt(t,10))}function De(e){return e.style.marginLeft&&e.style.marginRight&&e.style.marginLeft===e.style.marginRight?S(e.style.marginLeft):""}function Ae(e){return e.style.marginTop&&e.style.marginBottom&&e.style.marginTop===e.style.marginBottom?S(e.style.marginTop):""}function Ee(e){return e.style.borderWidth?S(e.style.borderWidth):""}function R(e,t){return e.hasAttribute(t)?e.getAttribute(t):""}function Ne(e,t){return e.style[t]?e.style[t]:""}function Oe(e){return e.parentNode!==null&&e.parentNode.nodeName==="FIGURE"}function j(e,t,n){e.setAttribute(t,n)}function lt(e){Oe(e)?function(t){var n=t.parentNode;D.insertAfter(t,n),D.remove(n)}(e):function(t){var n=D.create("figure",{class:"image"});D.insertAfter(n,t),n.appendChild(t),n.appendChild(D.create("figcaption",{contentEditable:"true"},"Caption")),n.contentEditable="false"}(e)}function Ue(e,t){var n=e.getAttribute("style"),r=t(n!==null?n:"");0<r.length?(e.setAttribute("style",r),e.setAttribute("data-mce-style",r)):e.removeAttribute("style")}function Ie(e,t){return function(n,r,o){n.style[r]?(n.style[r]=Y(o),Ue(n,t)):j(n,r,o)}}function xe(e,t){return e.style[t]?S(e.style[t]):R(e,t)}function Ce(e,t){var n=Y(t);e.style.marginLeft=n,e.style.marginRight=n}function Se(e,t){var n=Y(t);e.style.marginTop=n,e.style.marginBottom=n}function Pe(e,t){var n=Y(t);e.style.borderWidth=n}function Le(e,t){e.style.borderStyle=t}function re(e){return e.nodeName==="FIGURE"}function Re(e){return D.getAttrib(e,"alt").length===0&&D.getAttrib(e,"role")==="presentation"}function st(e,t){var n=v.document.createElement("img");return j(n,"style",t.style),!De(n)&&t.hspace===""||Ce(n,t.hspace),!Ae(n)&&t.vspace===""||Se(n,t.vspace),!Ee(n)&&t.border===""||Pe(n,t.border),!function(r){return Ne(r,"borderStyle")}(n)&&t.borderStyle===""||Le(n,t.borderStyle),e(n.getAttribute("style"))}function je(e,t){return{src:R(t,"src"),alt:function(n){return Re(n)?"":R(n,"alt")}(t),title:R(t,"title"),width:xe(t,"width"),height:xe(t,"height"),class:R(t,"class"),style:e(R(t,"style")),caption:Oe(t),hspace:De(t),vspace:Ae(t),border:Ee(t),borderStyle:Ne(t,"borderStyle"),isDecorative:Re(t)}}function E(e,t,n,r,o){n[r]!==t[r]&&o(e,r,n[r])}function z(e,t){return function(n,r,o){e(n,o),Ue(n,t)}}function $(e,t){var n=e.dom.styles.parse(t),r=qe(n),o=e.dom.styles.parse(e.dom.styles.serialize(r));return e.dom.styles.serialize(o)}function ie(e){var t=e.selection.getNode(),n=e.dom.getParent(t,"figure.image");return n?e.dom.select("img",n)[0]:t&&(t.nodeName!=="IMG"||Ve(t))?null:t}function Fe(e,t){var n=e.dom,r=n.getParent(t.parentNode,function(o){return!!e.schema.getTextBlockElements()[o.nodeName]},e.getBody());return r?n.split(r,t):t}function ft(e,t,n){var r=function(u,a,l){var m=v.document.createElement("img");if($e(u,H(H({},a),{caption:!1}),m,l),Xe(m,a.alt,a.isDecorative,l),a.caption){var f=D.create("figure",{class:"image"});return f.appendChild(m),f.appendChild(D.create("figcaption",{contentEditable:"true"},"Caption")),f.contentEditable="false",f}return m}(function(u){return $(e,u)},t,n);e.dom.setAttrib(r,"data-mce-id","__mcenew"),e.focus(),e.selection.setContent(r.outerHTML);var o=e.dom.select('*[data-mce-id="__mcenew"]')[0];if(e.dom.setAttrib(o,"data-mce-id",null),re(o)){var i=Fe(e,o);e.selection.select(i)}else e.selection.select(o)}function dt(e,t,n){var r=ie(e);r?t.src?function(o,i,u){var a=ie(o);if($e(function(m){return $(o,m)},i,a,u),function(m,f){m.dom.setAttrib(f,"src",f.getAttribute("src"))}(o,a),re(a.parentNode)){var l=a.parentNode;Fe(o,l),o.selection.select(a.parentNode)}else o.selection.select(a),wt(o,i,a)}(e,t,n):function(o,i){if(i){var u=o.dom.is(i.parentNode,"figure.image")?i.parentNode:i;o.dom.remove(u),o.focus(),o.nodeChanged(),o.dom.isEmpty(o.getBody())&&(o.setContent(""),o.selection.setCursorLocation())}}(e,r):t.src&&ft(e,t,n)}function Me(e){return _(e.value)?e.value:""}function ke(e){return e===void 0&&(e=Me),function(t){return t?w.from(t).map(function(n){return Je(n,e)}):w.none()}}var He,ze=Te.exports.boltExport,oe=function(e){var t=w.none(),n=[],r=function(a){o()?u(a):n.push(a)},o=function(){return t.isSome()},i=function(a){(function(l,m){for(var f=0,s=l.length;f<s;f++)m(l[f],f)})(a,u)},u=function(a){t.each(function(l){v.setTimeout(function(){a(l)},0)})};return e(function(a){t=w.some(a),i(n),n=[]}),{get:r,map:function(a){return oe(function(l){r(function(m){l(a(m))})})},isReady:o}},mt={nu:oe,pure:function(e){return oe(function(t){t(e)})}},F=function(e){function t(n){e().then(n,ut)}return{map:function(n){return F(function(){return e().then(n)})},bind:function(n){return F(function(){return e().then(function(r){return n(r).toPromise()})})},anonBind:function(n){return F(function(){return e().then(function(){return n.toPromise()})})},toLazy:function(){return mt.nu(t)},toCached:function(){var n=null;return F(function(){return n===null&&(n=e()),n})},toPromise:e,get:t}},ae=function(e){return F(function(){return new ze(e)})},pt=function(e){return F(function(){return ze.resolve(e)})},M=function(e){return{is:function(t){return e===t},isValue:P,isError:U,getOr:O(e),getOrThunk:O(e),getOrDie:O(e),or:function(t){return M(e)},orThunk:function(t){return M(e)},fold:function(t,n){return n(e)},map:function(t){return M(t(e))},mapError:function(t){return M(e)},each:function(t){t(e)},bind:function(t){return t(e)},exists:function(t){return t(e)},forall:function(t){return t(e)},toOption:function(){return w.some(e)}}},B=function(e){return{is:U,isValue:U,isError:P,getOr:tt,getOrThunk:function(t){return t()},getOrDie:function(){return function(t){return function(){throw new Error(t)}}(String(e))()},or:function(t){return t},orThunk:function(t){return t()},fold:function(t,n){return t(e)},map:function(t){return B(e)},mapError:function(t){return B(t(e))},each:Z,bind:function(t){return B(e)},exists:U,forall:P,toOption:w.none}},J={value:M,error:B,fromOption:function(e,t){return e.fold(function(){return B(t)},M)}},C=function(e){return H(H({},e),{toCached:function(){return C(e.toCached())},bindFuture:function(t){return C(e.bind(function(n){return n.fold(function(r){return pt(J.error(r))},function(r){return t(r)})}))},bindResult:function(t){return C(e.map(function(n){return n.bind(t)}))},mapResult:function(t){return C(e.map(function(n){return n.map(t)}))},mapError:function(t){return C(e.map(function(n){return n.mapError(t)}))},foldResult:function(t,n){return e.map(function(r){return r.fold(t,n)})},withTimeout:function(t,n){return C(ae(function(r){var o=!1,i=v.setTimeout(function(){o=!0,r(J.error(n()))},t);e.get(function(u){o||(v.clearTimeout(i),r(u))})}))}})},gt=ct,ht=Object.prototype.hasOwnProperty,G=(He=function(e,t){return ve(e)&&ve(t)?G(e,t):t},function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(e.length===0)throw new Error("Can't merge zero objects");for(var n={},r=0;r<e.length;r++){var o=e[r];for(var i in o)ht.call(o,i)&&(n[i]=He(n[i],o[i]))}return n}),W=(v.Node.ATTRIBUTE_NODE,v.Node.CDATA_SECTION_NODE,v.Node.COMMENT_NODE,v.Node.DOCUMENT_NODE,v.Node.DOCUMENT_TYPE_NODE,v.Node.DOCUMENT_FRAGMENT_NODE,v.Node.ELEMENT_NODE,v.Node.TEXT_NODE,v.Node.PROCESSING_INSTRUCTION_NODE,v.Node.ENTITY_REFERENCE_NODE,v.Node.ENTITY_NODE,v.Node.NOTATION_NODE,typeof v.window!="undefined"?v.window:Function("return this;")(),function(e){if(e==null)throw new Error("Node cannot be null or undefined");return{dom:O(e)}}),Be={fromHtml:function(e,t){var n=(t||v.document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||1<n.childNodes.length)throw v.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return W(n.childNodes[0])},fromTag:function(e,t){var n=(t||v.document).createElement(e);return W(n)},fromText:function(e,t){var n=(t||v.document).createTextNode(e);return W(n)},fromDom:W,fromPoint:function(e,t,n){var r=e.dom();return w.from(r.elementFromPoint(t,n)).map(W)}},vt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),ue=tinymce.util.Tools.resolve("tinymce.util.Promise"),bt=tinymce.util.Tools.resolve("tinymce.util.XHR"),Ge=function(e){return e.getParam("images_upload_url","","string")},We=function(e){return e.getParam("images_upload_handler",void 0,"function")},T={hasDimensions:function(e){return e.getParam("image_dimensions",!0,"boolean")},hasUploadTab:function(e){return e.getParam("image_uploadtab",!0,"boolean")},hasAdvTab:function(e){return e.getParam("image_advtab",!1,"boolean")},getPrependUrl:function(e){return e.getParam("image_prepend_url","","string")},getClassList:function(e){return e.getParam("image_class_list")},hasDescription:function(e){return e.getParam("image_description",!0,"boolean")},hasImageTitle:function(e){return e.getParam("image_title",!1,"boolean")},hasImageCaption:function(e){return e.getParam("image_caption",!1,"boolean")},getImageList:function(e){return e.getParam("image_list",!1)},hasUploadUrl:function(e){return!!Ge(e)},hasUploadHandler:function(e){return!!We(e)},getUploadUrl:Ge,getUploadHandler:We,getUploadBasePath:function(e){return e.getParam("images_upload_base_path",void 0,"string")},getUploadCredentials:function(e){return e.getParam("images_upload_credentials",!1,"boolean")},showAccessibilityOptions:function(e){return e.getParam("a11y_advanced_options",!1,"boolean")},isAutomaticUploadsEnabled:function(e){return e.getParam("automatic_uploads",!0,"boolean")}},yt=function(e,t){function n(i){r.parentNode&&r.parentNode.removeChild(r),t(i)}var r=v.document.createElement("img");r.onload=function(){var i={width:_e(r.width,r.clientWidth),height:_e(r.height,r.clientHeight)};n(J.value(i))},r.onerror=function(){n(J.error("Failed to get image dimensions for: "+e))};var o=r.style;o.visibility="hidden",o.position="fixed",o.bottom=o.left="0px",o.width=o.height="auto",v.document.body.appendChild(r),r.src=e},S=function(e){return e=e&&e.replace(/px$/,"")},Y=function(e){return 0<e.length&&/^[0-9]+$/.test(e)&&(e+="px"),e},qe=function(e){if(e.margin){var t=String(e.margin).split(" ");switch(t.length){case 1:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[0],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[0];break;case 2:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[1];break;case 3:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[1];break;case 4:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[3]}delete e.margin}return e},Tt=function(e,t){var n=T.getImageList(e);typeof n=="string"?bt.send({url:n,success:function(r){t(JSON.parse(r))}}):typeof n=="function"?n(t):t(n)},wt=function(e,t,n){function r(){n.onload=n.onerror=null,e.selection&&(e.selection.select(n),e.nodeChanged())}n.onload=function(){t.width||t.height||!T.hasDimensions(e)||e.dom.setAttribs(n,{width:String(n.clientWidth),height:String(n.clientHeight)}),r()},n.onerror=r},_t=function(e){return new ue(function(t,n){var r=new v.FileReader;r.onload=function(){t(r.result)},r.onerror=function(){n(r.error.message)},r.readAsDataURL(e)})},Ve=function(e){return e.nodeName==="IMG"&&(e.hasAttribute("data-mce-object")||e.hasAttribute("data-mce-placeholder"))},D=vt.DOM,Xe=function(e,t,n,r){if(n){D.setAttrib(e,"role","presentation");var o=Be.fromDom(e);we(o,"alt","")}else r.hasAccessibilityOptions?D.setAttrib(e,"alt",t):(o=Be.fromDom(e),we(o,"alt",t)),D.getAttrib(e,"role")==="presentation"&&D.setAttrib(e,"role","")},$e=function(e,t,n,r){var o=je(e,n);E(n,o,t,"caption",function(i,u,a){return lt(i)}),E(n,o,t,"src",j),E(n,o,t,"title",j),E(n,o,t,"width",Ie(0,e)),E(n,o,t,"height",Ie(0,e)),E(n,o,t,"class",j),E(n,o,t,"style",z(function(i,u){return j(i,"style",u)},e)),E(n,o,t,"hspace",z(Ce,e)),E(n,o,t,"vspace",z(Se,e)),E(n,o,t,"border",z(Pe,e)),E(n,o,t,"borderStyle",z(Le,e)),function(i,u,a,l){a.alt===u.alt&&a.isDecorative===u.isDecorative||Xe(i,a.alt,a.isDecorative,l)}(n,o,t,r)},ce=tinymce.util.Tools.resolve("tinymce.util.Tools"),Je=function(e,t){var n=[];return ce.each(e,function(r){var o=_(r.text)?r.text:_(r.title)?r.title:"";if(r.menu!==void 0){var i=Je(r.menu,t);n.push({text:o,items:i})}else{var u=t(r);n.push({text:o,value:u})}}),n},Ye=function(e,t){return function(n,r){for(var o=0;o<n.length;o++){var i=r(n[o],o);if(i.isSome())return i}return w.none()}(e,function(n){return function(r){return Object.prototype.hasOwnProperty.call(r,"items")}(n)?Ye(n.items,t):n.value===t?w.some(n):w.none()})},Dt=ke,At=function(e){return ke(Me)(e)},K=function(e,t){return e.bind(function(n){return Ye(n,t)})};function Et(e){function t(n,r,o,i){var u,a;(u=new v.XMLHttpRequest).open("POST",e.url),u.withCredentials=e.credentials,u.upload.onprogress=function(l){i(l.loaded/l.total*100)},u.onerror=function(){o("Image upload failed due to a XHR Transport error. Code: "+u.status)},u.onload=function(){var l;u.status<200||300<=u.status?o("HTTP Error: "+u.status):(l=JSON.parse(u.responseText))&&typeof l.location=="string"?r(function(m,f){return m?m.replace(/\/$/,"")+"/"+f.replace(/^\//,""):f}(e.basePath,l.location)):o("Invalid JSON: "+u.responseText)},(a=new v.FormData).append("file",n.blob(),n.filename()),u.send(a)}return e=ce.extend({credentials:!1,handler:t},e),{upload:function(n){return!e.url&&function(r){return r===t}(e.handler)?ue.reject("Upload url missing from the settings."):function(r,o){return new ue(function(i,u){try{o(r,i,u,Z)}catch(a){u(a.message)}})}(n,e.handler)}}}function Nt(e){var t=Dt(function(b){return e.convertURL(b.value||b.url,"src")}),n=ae(function(b){Tt(e,function(x){b(t(x).map(function(N){return V([[{text:"None",value:""}],N])}))})}),r=At(T.getClassList(e)),o=T.hasAdvTab(e),i=T.hasUploadTab(e),u=T.hasUploadUrl(e),a=T.hasUploadHandler(e),l=function(b){var x=ie(b);return x?je(function(N){return $(b,N)},x):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1}}(e),m=T.hasDescription(e),f=T.hasImageTitle(e),s=T.hasDimensions(e),h=T.hasImageCaption(e),I=T.showAccessibilityOptions(e),c=T.getUploadUrl(e),d=T.getUploadBasePath(e),p=T.getUploadCredentials(e),g=T.getUploadHandler(e),y=T.isAutomaticUploadsEnabled(e),A=w.some(T.getPrependUrl(e)).filter(function(b){return _(b)&&0<b.length});return n.map(function(b){return{image:l,imageList:b,classList:r,hasAdvTab:o,hasUploadTab:i,hasUploadUrl:u,hasUploadHandler:a,hasDescription:m,hasImageTitle:f,hasDimensions:s,hasImageCaption:h,url:c,basePath:d,credentials:p,handler:g,prependURL:A,hasAccessibilityOptions:I,automaticUploads:y}})}function Ke(e){var t=e.imageList.map(function(o){return{name:"images",type:"selectbox",label:"Image list",items:o}}),n={name:"alt",type:"input",label:"Alternative description",disabled:e.hasAccessibilityOptions&&e.image.isDecorative},r=e.classList.map(function(o){return{name:"classes",type:"selectbox",label:"Class",items:o}});return V([[{name:"src",type:"urlinput",filetype:"image",label:"Source"}],t.toArray(),e.hasAccessibilityOptions&&e.hasDescription?[{type:"label",label:"Accessibility",items:[{name:"isDecorative",type:"checkbox",label:"Image is decorative"}]}]:[],e.hasDescription?[n]:[],e.hasImageTitle?[{name:"title",type:"input",label:"Image title"}]:[],e.hasDimensions?[{name:"dimensions",type:"sizeinput"}]:[],[{type:"grid",columns:2,items:V([r.toArray(),e.hasImageCaption?[{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[]])}]])}function le(e){return{src:{value:e.src,meta:{}},images:e.src,alt:e.alt,title:e.title,dimensions:{width:e.width,height:e.height},classes:e.class,caption:e.caption,style:e.style,vspace:e.vspace,border:e.border,hspace:e.hspace,borderstyle:e.borderStyle,fileinput:[],isDecorative:e.isDecorative}}function Ze(e){return{src:e.src.value,alt:e.alt,title:e.title,width:e.dimensions.width,height:e.dimensions.height,class:e.classes,style:e.style,caption:e.caption,hspace:e.hspace,vspace:e.vspace,border:e.border,borderStyle:e.borderstyle,isDecorative:e.isDecorative}}function Ot(e,t){var n=t.getData();(function(r,o){return/^(?:[a-zA-Z]+:)?\/\//.test(o)?w.none():r.prependURL.bind(function(i){return o.substring(0,i.length)!==i?w.some(i+o):w.none()})})(e,n.src.value).each(function(r){t.setData({src:{value:r,meta:n.src.meta}})})}function Ut(e,t){var n=t.getData(),r=n.src.meta;if(r!==void 0){var o=G({},n);(function(i,u,a){i.hasDescription&&_(a.alt)&&(u.alt=a.alt),i.hasAccessibilityOptions&&(u.isDecorative=a.isDecorative||!1),i.hasImageTitle&&_(a.title)&&(u.title=a.title),i.hasDimensions&&(_(a.width)&&(u.dimensions.width=a.width),_(a.height)&&(u.dimensions.height=a.height)),_(a.class)&&K(i.classList,a.class).each(function(l){u.classes=l.value}),i.hasImageCaption&&be(a.caption)&&(u.caption=a.caption),i.hasAdvTab&&(_(a.style)&&(u.style=a.style),_(a.vspace)&&(u.vspace=a.vspace),_(a.border)&&(u.border=a.border),_(a.hspace)&&(u.hspace=a.hspace),_(a.borderstyle)&&(u.borderstyle=a.borderstyle))})(e,o,r),t.setData(o)}}function se(e,t,n,r){Ot(t,r),Ut(t,r),function(o,i,u,a){var l=a.getData(),m=l.src.value,f=l.src.meta||{};f.width||f.height||!i.hasDimensions||o.imageSize(m).get(function(s){s.each(function(h){u.open&&a.setData({dimensions:h})})})}(e,t,n,r),function(o,i,u){var a=u.getData(),l=K(o.imageList,a.src.value);i.prevImage=l,u.setData({images:l.map(function(m){return m.value}).getOr("")})}(t,n,r)}function It(e,t,n){var r=qe(e(n.style)),o=G({},n);return o.vspace=function(i){return i["margin-top"]&&i["margin-bottom"]&&i["margin-top"]===i["margin-bottom"]?S(String(i["margin-top"])):""}(r),o.hspace=function(i){return i["margin-right"]&&i["margin-left"]&&i["margin-right"]===i["margin-left"]?S(String(i["margin-right"])):""}(r),o.border=function(i){return i["border-width"]?S(String(i["border-width"])):""}(r),o.borderstyle=function(i){return i["border-style"]?String(i["border-style"]):""}(r),o.style=function(i,u,a){return u(i(u(a)))}(e,t,r),o}function xt(e,t,n,r){var o=r.getData();r.block("Uploading image"),function(i){return i.length===0?w.none():w.some(i[0])}(o.fileinput).fold(function(){r.unblock()},function(i){function u(){r.unblock(),v.URL.revokeObjectURL(l)}function a(f){r.setData({src:{value:f,meta:{}}}),r.showTab("general"),se(e,t,n,r)}var l=v.URL.createObjectURL(i),m=Et({url:t.url,basePath:t.basePath,credentials:t.credentials,handler:t.handler});_t(i).then(function(f){var s=e.createBlobCache(i,l,f);t.automaticUploads?m.upload(s).then(function(h){a(h),u()}).catch(function(h){u(),e.alertErr(r,h)}):(e.addToBlobCache(s),a(s.blobUri()),r.unblock())})})}function Ct(e,t,n){return function(r,o){o.name==="src"?se(e,t,n,r):o.name==="images"?function(i,u,a,l){var m=l.getData(),f=K(u.imageList,m.images);f.each(function(s){m.alt===""||a.prevImage.map(function(h){return h.text===m.alt}).getOr(!1)?s.value===""?l.setData({src:s,alt:a.prevAlt}):l.setData({src:s,alt:s.text}):l.setData({src:s})}),a.prevImage=f,se(i,u,a,l)}(e,t,n,r):o.name==="alt"?n.prevAlt=r.getData().alt:o.name==="style"?function(i,u){var a=u.getData(),l=It(i.parseStyle,i.serializeStyle,a);u.setData(l)}(e,r):o.name==="vspace"||o.name==="hspace"||o.name==="border"||o.name==="borderstyle"?function(i,u,a){var l=G(le(u.image),a.getData()),m=st(i.normalizeCss,Ze(l));a.setData({style:m})}(e,t,r):o.name==="fileinput"?xt(e,t,n,r):o.name==="isDecorative"&&(r.getData().isDecorative?r.disable("alt"):r.enable("alt"))}}function St(e){return function(t){var n=function(r){return{prevImage:K(r.imageList,r.image.src),prevAlt:r.image.alt,open:!0}}(t);return{title:"Insert/Edit Image",size:"normal",body:function(r){return r.hasAdvTab||r.hasUploadUrl||r.hasUploadHandler?{type:"tabpanel",tabs:V([[Lt(r)],r.hasAdvTab?[Pt(r)]:[],r.hasUploadTab&&(r.hasUploadUrl||r.hasUploadHandler)?[jt(r)]:[]])}:{type:"panel",items:Rt(r)}}(t),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:le(t.image),onSubmit:e.onSubmit(t),onChange:Ct(e,t,n),onClose:function(r){return function(){r.open=!1}}(n)}}}function fe(e){var t={onSubmit:function(n){return function(r){return function(o){var i=G(le(r.image),o.getData());n.undoManager.transact(function(){dt(n,Ze(i),r)}),n.editorUpload.uploadImagesAuto(),o.close()}}}(e),imageSize:function(n){return function(r){return gt(function(o){yt(n.documentBaseURI.toAbsolute(r),function(i){var u=i.map(function(a){return{width:String(a.width),height:String(a.height)}});o(u)})})}}(e),addToBlobCache:function(n){return function(r){n.editorUpload.blobCache.add(r)}}(e),createBlobCache:function(n){return function(r,o,i){return n.editorUpload.blobCache.create({blob:r,blobUri:o,name:r.name?r.name.replace(/\.[^\.]+$/,""):null,base64:i.split(",")[1]})}}(e),alertErr:function(n){return function(r,o){n.windowManager.alert(o,r.close)}}(e),normalizeCss:function(n){return function(r){return $(n,r)}}(e),parseStyle:function(n){return function(r){return n.dom.parseStyle(r)}}(e),serializeStyle:function(n){return function(r,o){return n.dom.serializeStyle(r,o)}}(e)};return{open:function(){return Nt(e).map(St(t)).get(function(n){e.windowManager.open(n)})}}}function Qe(e){return function(t){for(var n,r=t.length,o=function(u){u.attr("contenteditable",e?"true":null)};r--;){var i=t[r];(n=i.attr("class"))&&/\bimage\b/.test(n)&&(i.attr("contenteditable",e?"false":null),ce.each(i.getAll("figcaption"),o))}}}var Pt=function(e){return{title:"Advanced",name:"advanced",items:[{type:"input",label:"Style",name:"style"},{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"selectbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}},Lt=function(e){return{title:"General",name:"general",items:Ke(e)}},Rt=Ke,jt=function(e){return{title:"Upload",name:"upload",items:[{type:"dropzone",name:"fileinput"}]}},Ft=function(e){e.addCommand("mceImage",fe(e).open)},Mt=function(e){e.on("PreInit",function(){e.parser.addNodeFilter("figure",Qe(!0)),e.serializer.addNodeFilter("figure",Qe(!1))})},kt=function(e){e.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:fe(e).open,onSetup:function(t){return e.selection.selectorChangedWithUnbind("img:not([data-mce-object],[data-mce-placeholder]),figure.image",t.setActive).unbind}}),e.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:fe(e).open}),e.ui.registry.addContextMenu("image",{update:function(t){return re(t)||function(n){return n.nodeName==="IMG"}(t)&&!Ve(t)?["image"]:[]}})};(function(){nt.add("image",function(t){Mt(t),kt(t),Ft(t)})})()})(window);
