(function(){"use strict";function r(n){return function(e){for(var t=0;t<e.length;t++)(o=e[t]).attr("href")||!o.attr("id")&&!o.attr("name")||o.firstChild||e[t].attr("contenteditable",n);var o}}var i=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=function(n){return/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(n)},d=function(n){var e=n.selection.getNode();return e.tagName==="A"&&n.dom.getAttrib(e,"href")===""?e.getAttribute("id")||e.getAttribute("name"):""},u=function(n,e){var t=n.selection.getNode();t.tagName==="A"&&n.dom.getAttrib(t,"href")===""?(t.removeAttribute("name"),t.id=e,n.undoManager.add()):(n.focus(),n.selection.collapse(!0),n.execCommand("mceInsertContent",!1,n.dom.createHTML("a",{id:e})))},l=function(n){var e=d(n);n.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:e},onSubmit:function(t){!function(o,a){return c(a)?(u(o,a),!1):(o.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!0)}(n,t.getData().id)&&t.close()}})},m=function(n){n.addCommand("mceAnchor",function(){l(n)})},s=function(n){n.on("PreInit",function(){n.parser.addNodeFilter("a",r("false")),n.serializer.addNodeFilter("a",r(null))})},f=function(n){n.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return n.execCommand("mceAnchor")},onSetup:function(e){return n.selection.selectorChangedWithUnbind("a:not([href])",e.setActive).unbind}}),n.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return n.execCommand("mceAnchor")}})};(function(){i.add("anchor",function(e){s(e),m(e),f(e)})})()})();
