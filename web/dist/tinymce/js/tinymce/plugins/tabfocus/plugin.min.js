(function(p){"use strict";function b(e){e.keyCode!==m.TAB||e.ctrlKey||e.altKey||e.metaKey||e.preventDefault()}var k=tinymce.util.Tools.resolve("tinymce.PluginManager"),K=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),y=tinymce.util.Tools.resolve("tinymce.EditorManager"),f=tinymce.util.Tools.resolve("tinymce.Env"),w=tinymce.util.Tools.resolve("tinymce.util.Delay"),d=tinymce.util.Tools.resolve("tinymce.util.Tools"),m=tinymce.util.Tools.resolve("tinymce.util.VK"),D=function(e){return e.getParam("tab_focus",function(l){return l.getParam("tabfocus_elements",":prev,:next")}(e))},r=K.DOM,h=function(e){function l(i){var s,t,o,n;if(!(i.keyCode!==m.TAB||i.ctrlKey||i.altKey||i.metaKey||i.isDefaultPrevented())&&((o=d.explode(D(e))).length===1&&(o[1]=o[0],o[0]=":prev"),t=i.shiftKey?o[0]===":prev"?T(-1):r.get(o[0]):o[1]===":next"?T(1):r.get(o[1]))){var v=y.get(t.id||t.name);t.id&&v?v.focus():w.setTimeout(function(){f.webkit||p.window.focus(),t.focus()},10),i.preventDefault()}function T(x){function g(u){return/INPUT|TEXTAREA|BUTTON/.test(u.tagName)&&y.get(i.id)&&u.tabIndex!==-1&&function a(c){return c.nodeName==="BODY"||c.type!=="hidden"&&c.style.display!=="none"&&c.style.visibility!=="hidden"&&a(c.parentNode)}(u)}if(t=r.select(":input:enabled,*[tabindex]:not(iframe)"),d.each(t,function(u,a){if(u.id===e.id)return s=a,!1}),0<x){for(n=s+1;n<t.length;n++)if(g(t[n]))return t[n]}else for(n=s-1;0<=n;n--)if(g(t[n]))return t[n];return null}}e.on("init",function(){e.inline&&r.setAttrib(e.getBody(),"tabIndex",null),e.on("keyup",b),f.gecko?e.on("keypress keydown",l):e.on("keydown",l)})};(function(){k.add("tabfocus",function(l){h(l)})})()})(window);
