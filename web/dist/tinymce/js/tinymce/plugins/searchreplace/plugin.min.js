(function(){"use strict";var j=function(e){function n(){return t}var t=e;return{get:n,set:function(i){t=i},clone:function(){return j(n())}}},ie=tinymce.util.Tools.resolve("tinymce.PluginManager"),T=function(){return(T=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},B=tinymce.util.Tools.resolve("tinymce.util.Tools");function P(e){return e&&e.nodeType===1&&e.contentEditable==="false"}function I(e){var n=e.getAttribute("data-mce-index");return typeof n=="number"?""+n:n}function Q(e){var n=e.parentNode;e.firstChild&&n.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function W(e,n){var t,i=[];if((t=B.toArray(e.getBody().getElementsByTagName("span"))).length)for(var r=0;r<t.length;r++){var a=I(t[r]);a!==null&&a.length&&a===n.toString()&&i.push(t[r])}return i}function z(e,n,t){var i=n.get(),r=i.index,a=e.dom;(t=t!==!1)?r+1===i.count?r=0:r++:r-1==-1?r=i.count-1:r--,a.removeClass(W(e,i.index),"mce-match-marker-selected");var u=W(e,r);return u.length?(a.addClass(W(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(u[0]),r):-1}function X(e,n){var t=n.parentNode;e.remove(n),e.isEmpty(t)&&e.remove(t)}function Y(e,n,t,i,r){var a=function(l,m){var y=l.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n]");return m?"\\b"+y+"\\b":y}(t,r),u=function(l,m,y){var o,c;return(c=l.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",o=l.getBody(),F(l,m,!1),de.findAndReplaceDOMText(y,o,c,!1,l.schema)}(e,n,new RegExp(a,i?"g":"gi"));if(u){var p=z(e,n,!0);n.set({index:p,count:u,text:t,matchCase:i,wholeWord:r})}return u}function D(e,n){var t=z(e,n,!0);n.set(T(T({},n.get()),{index:t}))}function q(e,n){var t=z(e,n,!1);n.set(T(T({},n.get()),{index:t}))}function ce(e){var n=I(e);return n!==null&&0<n.length}function U(e,n,t,i,r){var a,u,p,l,m,y=n.get(),o=y.index,c=o;for(i=i!==!1,p=e.getBody(),u=B.grep(B.toArray(p.getElementsByTagName("span")),ce),a=0;a<u.length;a++){var h=I(u[a]);if(l=m=parseInt(h,10),r||l===y.index){for(t.length?(u[a].firstChild.nodeValue=t,Q(u[a])):X(e.dom,u[a]);u[++a];){if((l=parseInt(I(u[a]),10))!==m){a--;break}X(e.dom,u[a])}i&&c--}else o<m&&u[a].setAttribute("data-mce-index",String(m-1))}return n.set(T(T({},y),{count:r?0:y.count-1,index:c})),i?D(e,n):q(e,n),!r&&0<n.get().count}function ue(){}function k(e){return function(){return e}}function R(){return $}var V,de={findAndReplaceDOMText:function(n,t,i,r,a){var u,p,l,m,y,o,c=[],h=0;function O(g,d){if(d=d||0,!g[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");var x=g.index;if(0<d){var A=g[d];if(!A)throw new Error("Invalid capture group");x+=g[0].indexOf(A),g[0]=A}return[x,x+g[0].length,[g[0]]]}if(l=t.ownerDocument,m=a.getBlockElements(),y=a.getWhiteSpaceElements(),o=a.getShortEndedElements(),p=function g(d){var x;if(d.nodeType===3)return d.data;if(y[d.nodeName]&&!m[d.nodeName])return"";if(x="",P(d))return`
`;if((m[d.nodeName]||o[d.nodeName])&&(x+=`
`),d=d.firstChild)for(;x+=g(d),d=d.nextSibling;);return x}(t)){if(n.global)for(;u=n.exec(p);)c.push(O(u,r));else u=p.match(n),c.push(O(u,r));return c.length&&(h=c.length,function(d,x,A){var f,w,S,N,C=[],b=0,s=d,v=x.shift(),M=0;e:for(;;){if((m[s.nodeName]||o[s.nodeName]||P(s))&&b++,s.nodeType===3&&(!w&&s.length+b>=v[1]?(w=s,N=v[1]-b):f&&C.push(s),!f&&s.length+b>v[0]&&(f=s,S=v[0]-b),b+=s.length),f&&w){if(s=A({startNode:f,startNodeIndex:S,endNode:w,endNodeIndex:N,innerNodes:C,match:v[2],matchIndex:M}),b-=w.length-N,w=f=null,C=[],M++,!(v=x.shift()))break}else if(y[s.nodeName]&&!m[s.nodeName]||!s.firstChild){if(s.nextSibling){s=s.nextSibling;continue}}else if(!P(s)){s=s.firstChild;continue}for(;;){if(s.nextSibling){s=s.nextSibling;break}if(s.parentNode===d)break e;s=s.parentNode}}}(t,c,function(d){var x;if(typeof d!="function"){var A=d.nodeType?d:l.createElement(d);x=function(f,w){var S=A.cloneNode(!1);return S.setAttribute("data-mce-index",w),f&&S.appendChild(l.createTextNode(f)),S}}else x=d;return function(f){var w,S,N,C=f.startNode,b=f.endNode,s=f.matchIndex;if(C===b){var v=C;N=v.parentNode,0<f.startNodeIndex&&(w=l.createTextNode(v.data.substring(0,f.startNodeIndex)),N.insertBefore(w,v));var M=x(f.match[0],s);return N.insertBefore(M,v),f.endNodeIndex<v.length&&(S=l.createTextNode(v.data.substring(f.endNodeIndex)),N.insertBefore(S,v)),v.parentNode.removeChild(v),M}w=l.createTextNode(C.data.substring(0,f.startNodeIndex)),S=l.createTextNode(b.data.substring(f.endNodeIndex));for(var ge=x(C.data.substring(f.startNodeIndex),s),K=0,pe=f.innerNodes.length;K<pe;++K){var L=f.innerNodes[K],he=x(L.data,s);L.parentNode.replaceChild(he,L)}var ae=x(b.data.substring(0,f.endNodeIndex),s);return(N=C.parentNode).insertBefore(w,C),N.insertBefore(ge,C),N.removeChild(C),(N=b.parentNode).insertBefore(ae,b),N.insertBefore(S,b),N.removeChild(b),ae}}(i))),h}}},F=function(e,n,t){var i,r,a,u,p=n.get();for(r=B.toArray(e.getBody().getElementsByTagName("span")),i=0;i<r.length;i++){var l=I(r[i]);l!==null&&l.length&&(l===p.index.toString()&&(a=a||r[i].firstChild,u=r[i].firstChild),Q(r[i]))}if(n.set(T(T({},p),{index:-1,count:0,text:""})),a&&u){var m=e.dom.createRng();return m.setStart(a,0),m.setEnd(u,u.data.length),t!==!1&&e.selection.setRng(m),m}},se=function(e,n){return{done:function(t){return F(e,n,t)},find:function(t,i,r){return Y(e,n,t,i,r)},next:function(){return D(e,n)},prev:function(){return q(e,n)},replace:function(t,i,r){return U(e,n,t,i,r)}}},E=k(!1),_=k(!0),$=(V={fold:function(e,n){return e()},is:E,isSome:E,isNone:_,getOr:ne,getOrThunk:ee,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:k(null),getOrUndefined:k(void 0),or:ne,orThunk:ee,map:R,each:ue,bind:R,exists:E,forall:_,filter:R,equals:Z,equals_:Z,toArray:function(){return[]},toString:k("none()")},Object.freeze&&Object.freeze(V),V);function Z(e){return e.isNone()}function ee(e){return e()}function ne(e){return e}function G(e,n){return function(){oe(e,n)}}var te,H=function(e){function n(){return r}function t(a){return a(e)}var i=k(e),r={fold:function(a,u){return u(e)},is:function(a){return e===a},isSome:_,isNone:E,getOr:i,getOrThunk:i,getOrDie:i,getOrNull:i,getOrUndefined:i,or:n,orThunk:n,map:function(a){return H(a(e))},each:function(a){a(e)},bind:t,exists:t,forall:t,filter:function(a){return a(e)?r:$},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(a){return a.is(e)},equals_:function(a,u){return a.fold(E,function(p){return u(e,p)})}};return r},J={some:H,none:R,from:function(e){return e==null?$:H(e)}},le=(te="function",function(e){return function(n){if(n===null)return"null";var t=typeof n;return t=="object"&&(Array.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="Array")?"array":t=="object"&&(String.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="String")?"string":t}(e)===te}),xe=Array.prototype.slice,re=(le(Array.from)&&Array.from,tinymce.util.Tools.resolve("tinymce.Env")),oe=function(e,n){var t=function(){var o=j(J.none());return{clear:function(){o.set(J.none())},set:function(c){o.set(J.some(c))},isSet:function(){return o.get().isSome()},on:function(c){o.get().each(c)}}}();e.undoManager.add();var i=B.trim(e.selection.getContent({format:"text"}));function r(o){(function(c,h){return 1<h.get().count}(0,n)?o.enable:o.disable)("next"),(function(c,h){return 1<h.get().count}(0,n)?o.enable:o.disable)("prev")}function a(o,c){(function(h,O){for(var g=0,d=h.length;g<d;g++)O(h[g],g)})(["replace","replaceall","prev","next"],c?o.disable:o.enable)}function u(o,c){re.browser.isSafari()&&re.deviceType.isTouch()&&(c==="find"||c==="replace"||c==="replaceall")&&o.focus(c)}function p(o){F(e,n,!1),a(o,!0),r(o)}function l(o){var c=o.getData(),h=n.get();if(c.findtext.length){if(h.text===c.findtext&&h.matchCase===c.matchcase&&h.wholeWord===c.wholewords)D(e,n);else{var O=Y(e,n,c.findtext,c.matchcase,c.wholewords);O<=0&&function(d){e.windowManager.alert("Could not find the specified string.",function(){d.focus("findtext")})}(o),a(o,O===0)}r(o)}else p(o)}var m=n.get(),y={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",disabled:!0,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",disabled:!0,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",disabled:!0},{type:"custom",name:"replaceall",text:"Replace All",disabled:!0}],initialData:{findtext:i,replacetext:"",wholewords:m.wholeWord,matchcase:m.matchCase},onChange:function(o,c){c.name==="findtext"&&0<n.get().count&&p(o)},onAction:function(o,c){var h=o.getData();switch(c.name){case"find":l(o);break;case"replace":U(e,n,h.replacetext)?r(o):p(o);break;case"replaceall":U(e,n,h.replacetext,!0,!0),p(o);break;case"prev":q(e,n),r(o);break;case"next":D(e,n),r(o);break;case"matchcase":case"wholewords":(function(O){var g=O.getData(),d=n.get();n.set(T(T({},d),{matchCase:g.matchcase,wholeWord:g.wholewords}))})(o),p(o)}u(o,c.name)},onSubmit:function(o){l(o),u(o,"find")},onClose:function(){e.focus(),F(e,n),e.undoManager.add()}};t.set(e.windowManager.open(y,{inline:"toolbar"}))},fe=function(e,n){e.addCommand("SearchReplace",function(){oe(e,n)})},me=function(e,n){e.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:G(e,n),icon:"search"}),e.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:G(e,n),icon:"search"}),e.shortcuts.add("Meta+F","",G(e,n))};(function(){ie.add("searchreplace",function(n){var t=j({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1});return fe(n,t),me(n,t),se(n,t)})})()})();
