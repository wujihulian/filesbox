(function(){"use strict";function g(){return"mce-pagebreak"}function c(){return'<img src="'+s.transparentSrc+'" class="mce-pagebreak" data-mce-resize="false" data-mce-placeholder />'}var m=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=tinymce.util.Tools.resolve("tinymce.Env"),l=function(e){return e.getParam("pagebreak_separator","<!-- pagebreak -->")},p=function(e){return e.getParam("pagebreak_split_block",!1)},f=function(e){var n=l(e),P=new RegExp(n.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(a){return"\\"+a}),"gi");e.on("BeforeSetContent",function(a){a.content=a.content.replace(P,c())}),e.on("PreInit",function(){e.serializer.addNodeFilter("img",function(a){for(var t,o,u=a.length;u--;)if((o=(t=a[u]).attr("class"))&&o.indexOf("mce-pagebreak")!==-1){var r=t.parent;if(e.schema.getBlockElements()[r.name]&&p(e)){r.type=3,r.value=n,r.raw=!0,t.remove();continue}t.type=3,t.value=n,t.raw=!0}})})},i=c,k=g,d=function(e){e.addCommand("mcePageBreak",function(){e.settings.pagebreak_split_block?e.insertContent("<p>"+i()+"</p>"):e.insertContent(i())})},b=function(e){e.on("ResolveName",function(n){n.target.nodeName==="IMG"&&e.dom.hasClass(n.target,k())&&(n.name="pagebreak")})},v=function(e){e.ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:function(){return e.execCommand("mcePageBreak")}}),e.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:function(){return e.execCommand("mcePageBreak")}})};(function(){m.add("pagebreak",function(n){d(n),v(n),f(n),b(n)})})()})();
