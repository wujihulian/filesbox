(function(){"use strict";function V(){}function b(e){return function(){return e}}var X=tinymce.util.Tools.resolve("tinymce.PluginManager");function O(e,t){if((e=""+e).length<t)for(var n=0;n<t-e.length;n++)e="0"+e;return e}function I(e,t){return h.each(t,function(n,r){typeof n=="function"&&(n=n(r)),e=e.replace(new RegExp("\\{\\$"+r+"\\}","g"),n)}),e}function k(e,t){var n=e.dom,r=L(e);h.each(n.select("*",t),function(c){h.each(r,function(a,o){n.hasClass(c,o)&&typeof r[o]=="function"&&r[o](c)})})}function w(e,t){return new RegExp("\\b"+t+"\\b","g").test(e.className)}function _(){return N}var A,M=b(!1),D=b(!0),h=tinymce.util.Tools.resolve("tinymce.util.Tools"),J=tinymce.util.Tools.resolve("tinymce.util.XHR"),$=function(e){return e.getParam("template_cdate_classes","cdate")},G=function(e){return e.getParam("template_mdate_classes","mdate")},K=function(e){return e.getParam("template_selected_content_classes","selcontent")},Q=function(e){return e.getParam("template_preview_replace_values")},L=function(e){return e.getParam("template_replace_values")},Z=function(e){return e.templates},ee=function(e){return e.getParam("template_cdate_format",e.translate("%Y-%m-%d"))},Y=function(e){return e.getParam("template_mdate_format",e.translate("%Y-%m-%d"))},C=function(e,t,n){var r="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),c="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),a="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),o="January February March April May June July August September October November December".split(" ");return n=n||new Date,t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+n.getFullYear())).replace("%y",""+n.getYear())).replace("%m",O(n.getMonth()+1,2))).replace("%d",O(n.getDate(),2))).replace("%H",""+O(n.getHours(),2))).replace("%M",""+O(n.getMinutes(),2))).replace("%S",""+O(n.getSeconds(),2))).replace("%I",""+((n.getHours()+11)%12+1))).replace("%p",n.getHours()<12?"AM":"PM")).replace("%B",""+e.translate(o[n.getMonth()]))).replace("%b",""+e.translate(a[n.getMonth()]))).replace("%A",""+e.translate(c[n.getDay()]))).replace("%a",""+e.translate(r[n.getDay()]))).replace("%%","%")},j=function(e,t){return function(){var n=Z(e);typeof n!="function"?typeof n=="string"?J.send({url:n,success:function(r){t(JSON.parse(r))}}):t(n):n(t)}},te=I,ne=k,q=function(e,t,n){var r,c,a=e.dom,o=e.selection.getContent();n=I(n,L(e)),r=a.create("div",null,n),(c=a.select(".mceTmpl",r))&&0<c.length&&(r=a.create("div",null)).appendChild(c[0].cloneNode(!0)),h.each(a.select("*",r),function(u){w(u,$(e).replace(/\s+/g,"|"))&&(u.innerHTML=C(e,ee(e))),w(u,G(e).replace(/\s+/g,"|"))&&(u.innerHTML=C(e,Y(e))),w(u,K(e).replace(/\s+/g,"|"))&&(u.innerHTML=o)}),k(e,r),e.execCommand("mceInsertContent",!1,r.innerHTML),e.addVisual()},re=function(e){e.addCommand("mceInsertTemplate",function(n){for(var r=[],c=1;c<arguments.length;c++)r[c-1]=arguments[c];return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var u=r.concat(a);return n.apply(null,u)}}(q,e))},oe=function(e){e.on("PreProcess",function(t){var n=e.dom,r=Y(e);h.each(n.select("div",t.node),function(c){n.hasClass(c,"mceTmpl")&&(h.each(n.select("*",c),function(a){n.hasClass(a,e.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=C(e,r))}),ne(e,c))})})},N=(A={fold:function(e,t){return e()},is:M,isSome:M,isNone:D,getOr:E,getOrThunk:B,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:b(null),getOrUndefined:b(void 0),or:E,orThunk:B,map:_,each:V,bind:_,exists:M,forall:D,filter:_,equals:F,equals_:F,toArray:function(){return[]},toString:b("none()")},Object.freeze&&Object.freeze(A),A);function F(e){return e.isNone()}function B(e){return e()}function E(e){return e}function ae(e){return e.replace(/["'<>&]/g,function(t){return function(n,r){return le(n,r)?p.from(n[r]):p.none()}(se,t).getOr(t)})}function R(e){return function(t){fe(e,t)}}var z,H=function(e){function t(){return c}function n(a){return a(e)}var r=b(e),c={fold:function(a,o){return o(e)},is:function(a){return e===a},isSome:D,isNone:M,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(a){return H(a(e))},each:function(a){a(e)},bind:n,exists:n,forall:n,filter:function(a){return a(e)?c:N},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(a){return a.is(e)},equals_:function(a,o){return a.fold(M,function(u){return o(e,u)})}};return c},p={some:H,none:_,from:function(e){return e==null?N:H(e)}},ue=(z="function",function(e){return function(t){if(t===null)return"null";var n=typeof t;return n=="object"&&(Array.prototype.isPrototypeOf(t)||t.constructor&&t.constructor.name==="Array")?"array":n=="object"&&(String.prototype.isPrototypeOf(t)||t.constructor&&t.constructor.name==="String")?"string":n}(e)===z}),ge=Array.prototype.slice,ce=(ue(Array.from)&&Array.from,tinymce.util.Tools.resolve("tinymce.util.Promise")),ie=Object.hasOwnProperty,le=function(e,t){return ie.call(e,t)},se={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},fe=function(e,t){function n(o){return function(u,f){for(var s=u.length,i=new Array(s),l=0;l<s;l++){var g=u[l];i[l]=f(g,l)}return i}(o,function(u){return{text:u.text,value:u.text}})}function r(o,u){return function(f,s){for(var i=0,l=f.length;i<l;i++){var g=f[i];if(s(g,i))return p.some(g)}return p.none()}(o,function(f){return f.text===u})}function c(o){e.windowManager.alert("Could not load the specified template.",function(){return o.focus("template")})}function a(o){return new ce(function(u,f){o.value.url.fold(function(){return u(o.value.content.getOr(""))},function(s){return J.send({url:s,success:function(i){u(i)},error:function(i){f(i)}})})})}(function(){if(t&&t.length!==0)return p.from(h.map(t,function(u,f){function s(i){return i.url!==void 0}return{selected:f===0,text:u.title,value:{url:s(u)?p.from(u.url):p.none(),content:s(u)?p.none():p.from(u.content),description:u.description}}}));var o=e.translate("No templates defined.");return e.notificationManager.open({text:o,type:"info"}),p.none()})().each(function(o){function u(l,g){return{title:"Insert Template",size:"large",body:{type:"panel",items:l},initialData:g,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(T){return function(y){var d=y.getData();r(T,d.template).each(function(S){a(S).then(function(m){q(e,!1,m),y.close()}).catch(function(){y.disable("save"),c(y)})})}}(o),onChange:function(T,y){return function(d,S){if(S.name==="template"){var m=d.getData().template;r(T,m).each(function(v){d.block("Loading..."),a(v).then(function(x){y(d,v,x)}).catch(function(){y(d,v,""),d.disable("save"),c(d)})})}}}(o,s)}}var f=n(o),s=function(l,g,T){var y=function(m,v){if(v.indexOf("<html>")===-1){var x="";h.each(m.contentCSS,function(de){x+='<link type="text/css" rel="stylesheet" href="'+m.documentBaseURI.toAbsolute(de)+'">'});var P=m.settings.body_class||"";P.indexOf("=")!==-1&&(P=(P=m.getParam("body_class","","hash"))[m.id]||"");var U=m.dom.encode,W=m.getBody().dir,pe=W?' dir="'+U(W)+'"':"";v="<!DOCTYPE html><html><head>"+x+'</head><body class="'+U(P)+'"'+pe+">"+v+"</body></html>"}return te(v,Q(m))}(e,T),d=[{type:"selectbox",name:"template",label:"Templates",items:f},{type:"htmlpanel",html:'<p aria-live="polite">'+ae(g.value.description)+"</p>"},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1}],S={template:g.text,preview:y};l.unblock(),l.redial(u(d,S)),l.focus("template")},i=e.windowManager.open(u([],{template:"",preview:""}));i.block("Loading..."),a(o[0]).then(function(l){s(i,o[0],l)}).catch(function(){s(i,o[0],""),i.disable("save"),c(i)})})},me=function(e){e.ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onAction:j(e.settings,R(e))}),e.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onAction:j(e.settings,R(e))})};(function(){X.add("template",function(t){me(t),re(t),oe(t)})})()})();
