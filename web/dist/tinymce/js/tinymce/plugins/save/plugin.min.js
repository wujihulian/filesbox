(function(){"use strict";function n(e,t){e.notificationManager.open({text:t,type:"error"})}function o(e){return function(t){function a(){t.setDisabled(i(e)&&!e.isDirty())}return e.on("NodeChange dirty",a),function(){return e.off("NodeChange dirty",a)}}}var c=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),u=tinymce.util.Tools.resolve("tinymce.util.Tools"),i=function(e){return e.getParam("save_enablewhendirty",!0)},l=function(e){return!!e.getParam("save_onsavecallback")},s=function(e){return!!e.getParam("save_oncancelcallback")},d=function(e){var t;if(t=r.DOM.getParent(e.id,"form"),!i(e)||e.isDirty()){if(e.save(),l(e))return e.execCallback("save_onsavecallback",e),void e.nodeChanged();t?(e.setDirty(!1),t.onsubmit&&!t.onsubmit()||(typeof t.submit=="function"?t.submit():n(e,"Error: Form submit field collision.")),e.nodeChanged()):n(e,"Error: No form element found.")}},m=function(e){var t=u.trim(e.startContent);s(e)?e.execCallback("save_oncancelcallback",e):e.resetContent(t)},f=function(e){e.addCommand("mceSave",function(){d(e)}),e.addCommand("mceCancel",function(){m(e)})},v=function(e){e.ui.registry.addButton("save",{icon:"save",tooltip:"Save",disabled:!0,onAction:function(){return e.execCommand("mceSave")},onSetup:o(e)}),e.ui.registry.addButton("cancel",{icon:"cancel",tooltip:"Cancel",disabled:!0,onAction:function(){return e.execCommand("mceCancel")},onSetup:o(e)}),e.addShortcut("Meta+S","","mceSave")};(function(){c.add("save",function(t){v(t),f(t)})})()})();
