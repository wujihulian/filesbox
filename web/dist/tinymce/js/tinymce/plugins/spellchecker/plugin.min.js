(function(F){"use strict";var O=function(e){function t(){return r}var r=e;return{get:t,set:function(a){r=a},clone:function(){return O(t())}}},X=tinymce.util.Tools.resolve("tinymce.PluginManager"),ie=function(e){return!(!/(^|[ ,])tinymcespellchecker([, ]|$)/.test(e.settings.plugins)||!X.get("tinymcespellchecker"))&&(typeof F.window.console!="undefined"&&F.window.console.log&&F.window.console.log("Spell Checker Pro is incompatible with Spell Checker plugin! Remove 'spellchecker' from the 'plugins' option."),!0)},P=tinymce.util.Tools.resolve("tinymce.util.Tools"),ae=tinymce.util.Tools.resolve("tinymce.util.URI"),ce=tinymce.util.Tools.resolve("tinymce.util.XHR"),ue=function(e){return e.fire("SpellcheckStart")},se=function(e){return e.fire("SpellcheckEnd")},le=function(e){return e.getParam("spellchecker_languages","English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv")},de=function(e){var t=e.getParam("language","en");return e.getParam("spellchecker_language",t)},K=function(e){return e.getParam("spellchecker_rpc_url")},fe=function(e){return e.getParam("spellchecker_callback")},Q=function(e){var t=new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\xA7\xA9\xAB\xAE\xB1\xB6\xB7\xB8\xBB\xBC\xBD\xBE\xBF\xD7\xF7\xA4\u201D\u201C\u201E\xA0\u2002\u2003\u2009]+',"g");return e.getParam("spellchecker_wordchar_pattern",t)};function j(e){return e&&e.nodeType===1&&e.contentEditable==="false"}function ge(e,t){var r,a,c,l,s,d=[],m=t.dom;function k(o,n){if(!o[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return{start:o.index,end:o.index+o[0].length,text:o[0],data:n}}function f(o){for(var n=o.parentNode;0<o.childNodes.length;)n.insertBefore(o.childNodes[0],o);n.removeChild(o)}function g(o){var n=e.getElementsByTagName("*"),i=[];o=typeof o=="number"?""+o:null;for(var p=0;p<n.length;p++){var x=n[p],h=x.getAttribute("data-mce-index");h!==null&&h.length&&x.className.indexOf("mce-spellchecker-word")!==-1&&(h!==o&&o!==null||i.push(x))}return i}function S(o){for(var n=d.length;n--;)if(d[n]===o)return n;return-1}function w(o){for(var n=0,i=d.length;n<i&&o(d[n],n)!==!1;n++);return this}function B(o){var n,i=g(o?S(o):null);for(n=i.length;n--;)f(i[n]);return this}function C(o){var n=g(S(o)),i=t.dom.createRng();return i.setStartBefore(n[0]),i.setEndAfter(n[n.length-1]),i}return c=t.schema.getBlockElements(),l=t.schema.getWhiteSpaceElements(),s=t.schema.getShortEndedElements(),{text:a=function o(n){var i;if(n.nodeType===3)return n.data;if(l[n.nodeName]&&!c[n.nodeName])return"";if(j(n))return`
`;if(i="",(c[n.nodeName]||s[n.nodeName])&&(i+=`
`),n=n.firstChild)for(;i+=o(n),n=n.nextSibling;);return i}(e),matches:d,each:w,filter:function(n){var i=[];return w(function(p,x){n(p,x)&&i.push(p)}),d=i,this},reset:function(){return d.splice(0,d.length),B(),this},matchFromElement:function(n){return d[n.getAttribute("data-mce-index")]},elementFromMatch:function(n){return g(S(n))[0]},find:function(n,i){if(a&&n.global)for(;r=n.exec(a);)d.push(k(r,i));return this},add:function(n,i,p){return d.push({start:n,end:n+i,text:a.substr(n,i),data:p}),this},wrap:function(n){return d.length&&function(p,x,h){var b,N,v,T,y,E=[],I=0,u=p,D=0;(x=x.slice(0)).sort(function(H,R){return H.start-R.start}),y=x.shift();e:for(;;){if((c[u.nodeName]||s[u.nodeName]||j(u))&&I++,u.nodeType===3&&(!N&&u.length+I>=y.end?(N=u,T=y.end-I):b&&E.push(u),!b&&u.length+I>y.start&&(b=u,v=y.start-I),I+=u.length),b&&N){if(u=h({startNode:b,startNodeIndex:v,endNode:N,endNodeIndex:T,innerNodes:E,match:y.text,matchIndex:D}),I-=N.length-T,N=b=null,E=[],D++,!(y=x.shift()))break}else if(l[u.nodeName]&&!c[u.nodeName]||!u.firstChild){if(u.nextSibling){u=u.nextSibling;continue}}else if(!j(u)){u=u.firstChild;continue}for(;;){if(u.nextSibling){u=u.nextSibling;break}if(u.parentNode===p)break e;u=u.parentNode}}}(e,d,function(p){function x(h,b){var N=d[b];N.stencil||(N.stencil=p(N));var v=N.stencil.cloneNode(!1);return v.setAttribute("data-mce-index",b),h&&v.appendChild(m.doc.createTextNode(h)),v}return function(h){var b,N,v,T=h.startNode,y=h.endNode,E=h.matchIndex,I=m.doc;if(T===y){var u=T;v=u.parentNode,0<h.startNodeIndex&&(b=I.createTextNode(u.data.substring(0,h.startNodeIndex)),v.insertBefore(b,u));var D=x(h.match,E);return v.insertBefore(D,u),h.endNodeIndex<u.length&&(N=I.createTextNode(u.data.substring(h.endNodeIndex)),v.insertBefore(N,u)),u.parentNode.removeChild(u),D}b=I.createTextNode(T.data.substring(0,h.startNodeIndex)),N=I.createTextNode(y.data.substring(h.endNodeIndex));for(var H=x(T.data.substring(h.startNodeIndex),E),R=0,ye=h.innerNodes.length;R<ye;++R){var L=h.innerNodes[R],be=x(L.data,E);L.parentNode.replaceChild(be,L)}var oe=x(y.data.substring(0,h.endNodeIndex),E);return(v=T.parentNode).insertBefore(b,T),v.insertBefore(H,T),v.removeChild(T),(v=y.parentNode).insertBefore(oe,y),v.insertBefore(N,y),v.removeChild(y),oe}}(n)),this},unwrap:B,replace:function(n,i){var p=C(n);return p.deleteContents(),0<i.length&&p.insertNode(t.dom.doc.createTextNode(i)),p},rangeFromMatch:C,indexOf:S}}function he(){}function _(e){return function(){return e}}function W(){return pe}var z,U=_(!1),V=_(!0),pe=(z={fold:function(e,t){return e()},is:U,isSome:U,isNone:V,getOr:ee,getOrThunk:Z,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:_(null),getOrUndefined:_(void 0),or:ee,orThunk:Z,map:W,each:he,bind:W,exists:U,forall:V,filter:W,equals:Y,equals_:Y,toArray:function(){return[]},toString:_("none()")},Object.freeze&&Object.freeze(z),z);function Y(e){return e.isNone()}function Z(e){return e()}function ee(e){return e}function q(e,t){if(!t.get()){var r=ge(e.getBody(),e);t.set(r)}return t.get()}function ne(e,t,r,a,c,l,s){var d=fe(e);(d||function(m,k,f){return function(g,S,w,B){var C={method:g,lang:f.get()},o="";C[g==="addToDictionary"?"word":"text"]=S,P.each(C,function(n,i){o&&(o+="&"),o+=i+"="+encodeURIComponent(n)}),ce.send({url:new ae(k).toAbsolute(K(m)),type:"post",content_type:"application/x-www-form-urlencoded",data:o,success:function(n){var i=JSON.parse(n);if(i)i.error?B(i.error):w(i);else{var p=m.translate("Server response wasn't proper JSON.");B(p)}},error:function(){var n=m.translate("The spelling service was not found: (")+K(m)+m.translate(")");B(n)}})}}(e,t,r)).call(e.plugins.spellchecker,a,c,l,s)}function J(e,t,r){e.dom.select("span.mce-spellchecker-word").length||$(e,t,r)}function te(e){var t=e.getAttribute("data-mce-index");return typeof t=="number"?""+t:t}var me=Object.hasOwnProperty,$=function(e,t,r){var a=e.selection.getBookmark();if(q(e,r).reset(),e.selection.moveToBookmark(a),r.set(null),t.get())return t.set(!1),se(e),!0},re=function(e,t,r,a,c){var l=!!c.dictionary,s=c.words;if(e.setProgressState(!1),function(k){for(var f in k)if(me.call(k,f))return!1;return!0}(s)){var d=e.translate("No misspellings found.");return e.notificationManager.open({text:d,type:"info"}),void t.set(!1)}a.set({suggestions:s,hasDictionarySupport:l});var m=e.selection.getBookmark();q(e,r).find(Q(e)).filter(function(k){return!!s[k.text]}).wrap(function(k){return e.dom.create("span",{class:"mce-spellchecker-word","aria-invalid":"spelling","data-mce-bogus":1,"data-mce-word":k.text})}),e.selection.moveToBookmark(m),t.set(!0),ue(e)},A={spellcheck:function(e,t,r,a,c,l){$(e,r,a)||(e.setProgressState(!0),ne(e,t,l,"spellcheck",q(e,a).text,function(s){re(e,r,a,c,s)},function(s){e.notificationManager.open({text:s,type:"error"}),e.setProgressState(!1),$(e,r,a)}),e.focus())},checkIfFinished:J,addToDictionary:function(e,t,r,a,c,l,s){e.setProgressState(!0),ne(e,t,c,"addToDictionary",l,function(){e.setProgressState(!1),e.dom.remove(s,!0),J(e,r,a)},function(d){e.notificationManager.open({text:d,type:"error"}),e.setProgressState(!1)})},ignoreWord:function(e,t,r,a,c,l){e.selection.collapse(),l?P.each(e.dom.select("span.mce-spellchecker-word"),function(s){s.getAttribute("data-mce-word")===a&&e.dom.remove(s,!0)}):e.dom.remove(c,!0),J(e,t,r)},findSpansByIndex:function(e,t){var r,a=[];if((r=P.toArray(e.getBody().getElementsByTagName("span"))).length)for(var c=0;c<r.length;c++){var l=te(r[c]);l!==null&&l.length&&l===t.toString()&&a.push(r[c])}return a},getElmIndex:te,markErrors:re},xe=function(e,t,r,a,c,l){return{getTextMatcher:function(){return a.get()},getWordCharPattern:function(){return Q(e)},markErrors:function(s){A.markErrors(e,t,a,r,s)},getLanguage:function(){return c.get()}}},ve=function(e,t,r,a,c,l){e.addCommand("mceSpellCheck",function(){A.spellcheck(e,t,r,a,c,l)})},G=function(){return(G=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var c in t=arguments[r])Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c]);return e}).apply(this,arguments)},M="SpellcheckStart SpellcheckEnd",ke=function(e,t,r,a,c,l){function s(){A.spellcheck(e,t,r,a,l,c)}var d=function(f,g){var S=[];return P.each(g,function(w){S.push({selectable:!0,text:w.name,data:w.value})}),S}(0,function(f){return P.map(le(f).split(","),function(g){return{name:(g=g.split("="))[0],value:g[1]}})}(e)),m={tooltip:"Spellcheck",onAction:s,icon:"spell-check",onSetup:function(f){function g(){f.setActive(r.get())}return e.on(M,g),function(){e.off(M,g)}}},k=G(G({},m),{type:"splitbutton",select:function(f){return f===c.get()},fetch:function(f){f(P.map(d,function(g){return{type:"choiceitem",value:g.data,text:g.text}}))},onItemAction:function(f,g){c.set(g)}});1<d.length?e.ui.registry.addSplitButton("spellchecker",k):e.ui.registry.addToggleButton("spellchecker",m),e.ui.registry.addToggleMenuItem("spellchecker",{text:"Spellcheck",onSetup:function(f){f.setActive(r.get());function g(){f.setActive(r.get())}return e.on(M,g),function(){e.off(M,g)}},onAction:s})},Ne=function(e,t,r,a,c,l){e.ui.registry.addContextMenu("spellchecker",{update:function(s){var d=s;if(d.className!=="mce-spellchecker-word")return[];var m=A.findSpansByIndex(e,A.getElmIndex(d));if(0<m.length){var k=e.dom.createRng();return k.setStartBefore(m[0]),k.setEndAfter(m[m.length-1]),e.selection.setRng(k),function(f,g,S,w,B,C,o,n){var i=[],p=S.get().suggestions[o];return P.each(p,function(x){i.push({text:x,onAction:function(){f.insertContent(f.dom.encode(x)),f.dom.remove(n),A.checkIfFinished(f,w,B)}})}),S.get().hasDictionarySupport&&(i.push({type:"separator"}),i.push({text:"Add to dictionary",onAction:function(){A.addToDictionary(f,g,w,B,C,o,n)}})),i.push.apply(i,[{type:"separator"},{text:"Ignore",onAction:function(){A.ignoreWord(f,w,B,o,n)}},{text:"Ignore all",onAction:function(){A.ignoreWord(f,w,B,o,n,!0)}}]),i}(e,t,r,a,c,l,d.getAttribute("data-mce-word"),m)}}})};(function(){X.add("spellchecker",function(t,r){if(ie(t)===!1){var a=O(!1),c=O(de(t)),l=O(null),s=O(null);return ke(t,r,a,l,c,s),Ne(t,r,s,a,l,c),ve(t,r,a,l,s,c),xe(t,a,s,l,c,r)}})})()})(window);
