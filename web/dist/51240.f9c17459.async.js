(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[51240],{39398:function(L){L.exports={docmodalbox:"docmodalbox___3KxyK"}},51837:function(L,z,d){"use strict";d.r(z),d.d(z,{default:function(){return J}});var Y=d(20228),K=d(11382),W=d(34895),A=d(28216),F=d(67294),N=d(43583),j=d.n(N),V=d(39398),b=d.n(V),k=d(37406),i=d(85893),R,S,J=(R=(0,A.$j)(Z=>{var a=Z.common;return{common:a}}),R(S=class extends F.PureComponent{constructor(){super(...arguments);this.state={modelZindex:100,fullScreen:!1,current:1,total:0,target:{},getInfoLoading:!0,viewUrl:"",taskId:(0,k.fW)(),psddom:""},this.getvideoinfo=a=>{var e=this,n=this.props,f=n.dispatch,I=n.sourceID,x=n.isyz,C=n.iframeUrl,U=C===void 0?"":C,m=n.common,h=n.path,u=h===void 0?"":h,O=n.yzViewData,g=n.f,_=n.fileType,s=_===void 0?"":_,c=n.zipData,w=c===void 0?{}:c,M=n.isZipModal,T=M===void 0?0:M,E=n.password,l=E===void 0?"":E,D=m.shareCode,P=e.state.taskId;if(T){s=="psd"&&e.setState({getInfoLoading:!1}),f({type:"common/getunzipList",payload:{sourceID:w.sourceID,fullName:w.fileName,index:w.index,password:l},callback:o=>{if(o.success){var r=o.data||"";this.setState({fileInfo:{pptPreviewUrl:r,fileType:s,downloadUrl:r},viewUrl:r||""},()=>{s=="psd"&&j().fromURL(r).then(function(v){document.getElementById("img"+P).appendChild(v.image.toPng())})})}}});return}if(U)return!1;s=="psd"?(e.setState({getInfoLoading:!1}),f({type:"common/getFilePreview",payload:{busType:"cloud",sourceID:I,shareCode:D||void 0,view:D?1:void 0,path:u||void 0,f:g},callback:o=>{var r=o.data||{};this.setState({fileInfo:r,viewUrl:""},()=>{s=="psd"&&j().fromURL(r.downloadUrl).then(function(v){document.getElementById("img"+P).appendChild(v.image.toPng())})})}})):f({type:"common/getFilePreview",payload:{busType:"cloud",sourceID:I,shareCode:D||void 0,view:D?1:void 0,path:u||void 0,preview:a,f:g},callback:o=>{var r=o.data||{},v=r.yzViewData||"",p=v?JSON.parse(v):{};p.viewUrl&&a!==0?$.ajax({url:p.viewUrl,method:"get",headers:{},success:t=>{if((t==null?void 0:t.errorcode)==41)e.getvideoinfo(0);else{var B=t||"";B.indexOf("\u6C38\u4E2D\u6587\u6863\u8F6C\u6362\u670D\u52A1-404")>-1?e.getvideoinfo(0):e.setState({fileInfo:r,viewUrl:p.viewUrl})}},error:t=>{}}):this.setState({fileInfo:r,viewUrl:p.viewUrl||""})}})}}componentDidMount(){var a=this;a.getvideoinfo()}componentWillUnmount(){var a=this,e=this.props,n=e.dispatch,f=e.sourceID,I=e.isyz,x=e.iframeUrl,C=x===void 0?"":x,U=e.common,m=e.path,h=m===void 0?"":m,u=e.yzViewData,O=U.shareCode;if(I&&h){var g={method:3,params:{fileId:f+""}};$.ajax({url:"https://demo.filesbox.cn/plugin/yzwo/api.do",data:{jsonParams:encodeURIComponent(JSON.stringify(g))},type:"POST",dataType:"json",general:!1,async:!1,success:_=>{_&&_.errorCode==="0"}})}}render(){var a=this,e=a.props,n=e.dispatch,f=e.common,I=e.open,x=e.setOpenModel,C=e.videoOption,U=e.isyz,m=e.iframeUrl,h=e.iframeName,u=h===void 0?"":h,O=e.issmall,g=e.path,_=e.name,s=e.fileType,c=e.isZipModal,w=e.showIndex,M=e.isedit,T=f.sourceID,E=f.shareCode,l=this.state,D=l.modelZindex,P=l.fileInfo,o=P===void 0?{}:P,r=l.fullScreen,v=l.getInfoLoading,p=l.viewUrl,t=l.taskId,B=l.psddom,G=y=>{a.setState({modelZindex:y})},q=(y,H)=>{var Q=y.current,X=y.total;a.setState({current:Q,total:X,target:H})},ee=o.size&&o.size<1024*1024*4?o.size/2-1:"";return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(W.Z,{open:I,issmall:O,modelZindex:D,setOpenModel:x,setModelZindex:G,type:"doc",showIndex:w,isFull:!!m,title:u||_||o.name,children:(0,i.jsx)("div",{className:b().docmodalbox,children:(0,i.jsxs)(K.Z,{spinning:v,children:[s=="psd"&&(0,i.jsx)("div",{id:"img"+t,className:"imgbox"}),s=="xmind"||s=="smm"||s=="mind"||s=="km"||s=="epub"||c&&(o.fileType=="xmind"||o.fileType=="smm"||o.fileType=="mind"||o.fileType=="km"||o.fileType=="epub")?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("iframe",{id:"iframe"+t,onLoad:()=>{a.setState({getInfoLoading:!1}),$("#iframe"+t).focus()},src:c?o.fileType=="epub"?"/reader/index.html?fileUrl=".concat(encodeURIComponent(o.downloadUrl)):"/newmindMap/index.html?sourceID=".concat(T,"&action=").concat(M?"edit":"","&fileType=").concat(s,"&mindUrl=")+encodeURIComponent(o.downloadUrl):s=="epub"?"/reader/index.html?fileUrl=".concat(encodeURIComponent(o.downloadUrl)):"/newmindMap/index.html?sourceID=".concat(o.sourceID,"&action=").concat(M?"edit":"","&fileType=").concat(s,"&mindUrl=")+encodeURIComponent(o.downloadUrl)})}):(0,i.jsxs)(i.Fragment,{children:[" ",m?(0,i.jsx)("iframe",{id:"iframe"+t,onLoad:y=>{a.setState({getInfoLoading:!1}),$("#iframe"+t).focus()},src:m+(E?"&shareCode="+E:"")}):(0,i.jsx)(i.Fragment,{children:(U?p?p+"&showFooter=0":"":o.pptPreviewUrl)&&!g?(0,i.jsx)("iframe",{id:"iframe"+t,onLoad:y=>{a.setState({getInfoLoading:!1}),$("#iframe"+t).focus()},src:c?o.pptPreviewUrl+(c?"":"&draw=1"):U?p?p+"&showFooter=0":"":o.pptPreviewUrl+(c?"":"&draw=1")}):(0,i.jsx)("iframe",{id:"iframe"+t,onLoad:()=>{a.setState({getInfoLoading:!1}),$("#iframe"+t).focus()},src:o.yzEditData})})]})]})})})})}})||S)},77927:function(){}}]);
