(function(){var l={init:function(){var n=this,a=$(".module[data-type=loginBox]");n.unlogin(a),a.each(function(t){n.bindEvent(a.eq(t))}),n.listenState(a)},listenState:function(n){var a=this;window.loginUserResponse&&(a.onlogin(n),clearInterval(t));var t=setInterval(function(){window.loginUserResponse&&(a.onlogin(n),clearInterval(t))},200)},onlogin:function(n){var r;var a=this,t=((r=window.loginUserResponse)==null?void 0:r.data)||{},e=(t==null?void 0:t.user)||{};n.attr("data-islogin","1"),$(".onlogin .head").attr("src",(window.cdnPath||"")+e.headPortrait),$(".onlogin .realName").text(e.nickname||e.name),$(".onlogin .loginname").text(e.name),$(".onlogin .lastLogin").text(a.getTimeZhCN(e.lastLogin,window.loginUserResponse.timeStamp))},bindEvent:function(n){var a=this,t=n.find(".submit");t.on("click",function(){var e=n.find(".account").val(),r=n.find(".password").val();if($(this).find(".tip").remove(),!e)return $(this).append('<span class="tip" >\u8BF7\u8F93\u5165\u8D26\u53F7</span>'),!1;if(!r)return $(this).append('<span class="tip" >\u8BF7\u8F93\u5165\u5BC6\u7801</span>'),!1;window.user.login(e,r,function(o){if(o.success)window.mainHome.getLoginUser(!0);else{var i=o.message;switch(parseInt(o.code)){case 200:i="\u5BC6\u7801\u6216\u8D26\u53F7\u4E0D\u6B63\u786E\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165";break;case 400:i="\u8BE5\u7F51\u6821\u9700\u8981\u4F7F\u7528\u9501\u5C4F\u6D4F\u89C8\u5668\u767B\u5F55";break;case 403:i="\u8D26\u53F7\u7C7B\u578B\u4E0D\u6B63\u786E";break;case 503:i="\u5DF2\u88AB\u9650\u5236\u767B\u5F55";break;case 707:i="\u60A8\u5DF2\u88AB\u7981\u6B62\u767B\u5F55";break}if(o.success){var s=o.data;if(s){var c=s.errCode;c=="4012"?i="\u8D85\u8FC7\u9650\u5236\u6B21\u6570"+s.limitCount+"\u6B21\uFF0C\u8BF7"+s.denyTime/60+"\u5206\u949F\u540E\u91CD\u8BD5":i="\u5BC6\u7801\u6216\u8D26\u53F7\u4E0D\u6B63\u786E\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}else i="\u5BC6\u7801\u6216\u8D26\u53F7\u4E0D\u6B63\u786E\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}t.append('<span class="tip" >'+i+"</span>")}})}),n.find(".quitBtn").on("click",function(){window.user.loginout(function(e){if(e.success){localStorage.ap="";try{myextension.delphicallback(1401,"")}catch(r){console.log("\u975E\u65E0\u6781\u6D4F\u89C8\u5668")}window.location.reload()}})}),n.find(".going").on("click",function(){$(this).text("\u6B63\u5728\u8FDB\u5165"),window.location.href=window.loginUserResponse.data.userTypeExact=="STUDENT"?"/myroom/#/":"/aroom/#/"})},unlogin:function(n){n.attr("data-islogin","0")},getTimeZhCN:function(n,a){if(new Date(parseInt(n))=="Invalid Date"&&new Date(parseInt(n)*1e3)=="Invalid Date")return"--";new Date(parseInt(a))=="Invalid Date"&&new Date(parseInt(a)*1e3)=="Invalid Date"&&(a=Date.parse(new Date));var t=a-n;if(t<0)return"\u521A\u521A";if(t<6e4)return parseInt(t/1e3,10)+" \u79D2\u524D";if(t<3600*1e3)return parseInt(t/1e3/60,10)+" \u5206\u949F\u524D";if(t<24*3600*1e3)return parseInt(t/1e3/3600,10)+" \u5C0F\u65F6\u524D";if(t<30*24*3600*1e3)return parseInt(t/1e3/3600/24,10)+" \u5929\u524D";var e=new Date(parseInt(n)),r=parseInt(e.getMonth()+1)<10?"0"+(e.getMonth()+1):e.getMonth()+1,o=parseInt(e.getDate())<10?"0"+e.getDate():e.getDate(),i=parseInt(e.getHours())<10?"0"+e.getHours():e.getHours(),s=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes();return e.getFullYear()+"-"+r+"-"+o+" "+i+":"+s}};l.init()})();
