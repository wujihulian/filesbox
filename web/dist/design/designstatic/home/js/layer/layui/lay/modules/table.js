layui.define(["laytpl","laypage","layer","form","util"],function(G){"use strict";var d=layui.$,R=layui.laytpl,$=layui.laypage,A=layui.layer,q=layui.form,z=(layui.util,layui.hint()),j=layui.device(),g={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+1e4:0,set:function(t){var e=this;return e.config=d.extend({},e.config,t),e},on:function(t,e){return layui.onevent.call(this,W,t,e)}},E=function(){var t=this,e=t.config,a=e.id;return a&&(E.config[a]=e),{reload:function(c){t.reload.call(t,c)},setColsWidth:function(){t.setColsWidth.call(t)},config:e}},W="table",U=".layui-table",I="layui-hide",F="layui-none",Y="layui-table-view",V=".layui-table-tool",J=".layui-table-box",Q=".layui-table-init",K=".layui-table-header",D=".layui-table-body",Z=".layui-table-main",ee=".layui-table-fixed",te=".layui-table-fixed-l",ie=".layui-table-fixed-r",ae=".layui-table-total",le=".layui-table-page",_=".layui-table-sort",H="layui-table-edit",X="layui-table-hover",O=function(t){var e='{{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}}';return t=t||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return t.fixed&&t.fixed!=="right"?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':t.fixed==="right"?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# var isSort = !(item2.colspan > 1) && item2.sort; }}",'<th data-field="{{ item2.field||i2 }}" {{# if(item2.minWidth){ }}data-minwidth="{{item2.minWidth}}"{{# } }} '+e+' {{# if(item2.unresize){ }}data-unresize="true"{{# } }} {{# if(isSort){ }}class="layui-unselect"{{# } }}>','<div class="layui-table-cell laytable-cell-',"{{# if(item2.colspan > 1){ }}","group","{{# } else { }}","{{d.index}}-{{item2.field || i2}}",'{{# if(item2.type !== "normal"){ }}'," laytable-cell-{{ item2.type }}","{{# } }}","{{# } }}",'" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','{{# if(item2.type === "checkbox"){ }}','<input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}>',"{{# } else { }}",'<span>{{item2.title||""}}</span>',"{{# if(isSort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc" title="\u5347\u5E8F"></i><i class="layui-edge layui-table-sort-desc" title="\u964D\u5E8F"></i></span>',"{{# } }}","{{# } }}","</div>","</th>",t.fixed?"{{# }; }}":"","{{# }); }}","</tr>","{{# }); }}","</thead>","</table>"].join("")},B=['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<tbody></tbody>","</table>"].join(""),ne=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# if(d.data.toolbar){ }}",'<div class="layui-table-tool">','<div class="layui-table-tool-temp"></div>','<div class="layui-table-tool-self"></div>',"</div>","{{# } }}",'<div class="layui-table-box">','<div class="layui-table-init" style="background-color: #fff;">','<i class="layui-icon layui-icon-loading layui-icon"></i>',"</div>","{{# var left, right; }}",'<div class="layui-table-header">',O(),"</div>",'<div class="layui-table-body layui-table-main">',B,"</div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',O({fixed:!0}),"</div>",'<div class="layui-table-body">',B,"</div>","</div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',O({fixed:"right"}),'<div class="layui-table-mend"></div>',"</div>",'<div class="layui-table-body">',B,"</div>","</div>","{{# }; }}","</div>","{{# if(d.data.totalRow){ }}",'<div class="layui-table-total">','<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>','<tbody><tr><td><div class="layui-table-cell" style="visibility: hidden;">Total</div></td></tr></tbody>',"</table>","</div>","{{# } }}","{{# if(d.data.page){ }}",'<div class="layui-table-page">','<div id="layui-table-page{{d.index}}"></div>',"</div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{item2.field||i2}}{ ","{{# if(item2.width){ }}","width: {{item2.width}}px;","{{# } }}"," }","{{# });","}); }}","</style>","</div>"].join(""),P=d(window),M=d(document),k=function(t){var e=this;e.index=++g.index,e.config=d.extend({},e.config,g.config,t),e.render()};k.prototype.config={limit:10,loading:!0,cellMinWidth:60,defaultToolbar:["filter","exports","print"],text:{none:"\u65E0\u6570\u636E"}},k.prototype.render=function(){var t=this,e=t.config;if(e.elem=d(e.elem),e.where=e.where||{},e.id=e.id||e.elem.attr("id")||e.index,e.request=d.extend({pageName:"page",limitName:"limit"},e.request),e.response=d.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},e.response),typeof e.page=="object"&&(e.limit=e.page.limit||e.limit,e.limits=e.page.limits||e.limits,t.page=e.page.curr=e.page.curr||1,delete e.page.elem,delete e.page.jump),!e.elem[0])return t;e.height&&/^full-\d+$/.test(e.height)&&(t.fullHeightGap=e.height.split("-")[1],e.height=P.height()-t.fullHeightGap),e.height&&e.height<248&&(e.height=248),t.setInit();var a=e.elem,c=a.next("."+Y),i=t.elem=d(R(ne).render({VIEW_CLASS:Y,data:e,index:t.index}));if(e.index=t.index,c[0]&&c.remove(),a.after(i),t.layTool=i.find(V),t.layBox=i.find(J),t.layHeader=i.find(K),t.layMain=i.find(Z),t.layBody=i.find(D),t.layFixed=i.find(ee),t.layFixLeft=i.find(te),t.layFixRight=i.find(ie),t.layTotal=i.find(ae),t.layPage=i.find(le),t.renderToolbar(),t.fullSize(),e.cols.length>1){var r=t.layFixed.find(K).find("th");r.height(t.layHeader.height()-1-parseFloat(r.css("padding-top"))-parseFloat(r.css("padding-bottom")))}t.pullData(t.page),t.events()},k.prototype.initOpts=function(t){var e=this,a=(e.config,{checkbox:48,radio:48,space:15,numbers:40});t.checkbox&&(t.type="checkbox"),t.space&&(t.type="space"),t.type||(t.type="normal"),t.type!=="normal"&&(t.unresize=!0,t.width=t.width||a[t.type])},k.prototype.setInit=function(t){var e=this,a=e.config;return a.clientWidth=a.width||function(){var c=function(i){var r,o;i=i||a.elem.parent(),r=i.width();try{o=i.css("display")==="none"}catch(p){}return!i[0]||r&&!o?r:c(i.parent())};return c()}(),t==="width"?a.clientWidth:void layui.each(a.cols,function(c,i){layui.each(i,function(r,o){return o.minWidth||a.cellMinWidth,o?void e.initOpts(o):void i.splice(r,1)})})},k.prototype.renderToolbar=function(){var t=this,e=t.config,a=['<div class="layui-inline" lay-event="add"><i class="layui-icon layui-icon-add-1"></i></div>','<div class="layui-inline" lay-event="update"><i class="layui-icon layui-icon-edit"></i></div>','<div class="layui-inline" lay-event="delete"><i class="layui-icon layui-icon-delete"></i></div>'].join(""),c=t.layTool.find(".layui-table-tool-temp");if(e.toolbar==="default")c.html(a);else if(e.toolbar){var i=d(e.toolbar).html()||"";i&&c.html(R(i).render(e))}var r={filter:{title:"\u7B5B\u9009\u5217",layEvent:"LAYTABLE_COLS",icon:"layui-icon-cols"},exports:{title:"\u5BFC\u51FA",layEvent:"LAYTABLE_EXPORT",icon:"layui-icon-export"},print:{title:"\u6253\u5370",layEvent:"LAYTABLE_PRINT",icon:"layui-icon-print"}},o=[];typeof e.defaultToolbar=="object"&&layui.each(e.defaultToolbar,function(p,f){var u=r[f];u&&o.push('<div class="layui-inline" title="'+u.title+'" lay-event="'+u.layEvent+'"><i class="layui-icon '+u.icon+'"></i></div>')}),t.layTool.find(".layui-table-tool-self").html(o.join(""))},k.prototype.setColsWidth=function(){var t=this,e=t.config,a=0,c=0,i=0,r=0,o=t.setInit("width");t.eachCols(function(l,n){n.hide||a++}),o=o-function(){return e.skin==="line"||e.skin==="nob"?2:a+1}()-t.getScrollWidth(t.layMain[0])-1;var p=function(l){layui.each(e.cols,function(n,s){layui.each(s,function(h,m){var x=0,T=m.minWidth||e.cellMinWidth;return m?void(m.colspan>1||(l?i&&i<T&&(c--,x=T):(x=m.width||0,/\d+%$/.test(x)?(x=Math.floor(parseFloat(x)/100*o),x<T&&(x=T)):x||(m.width=x=0,c++)),m.hide&&(x=0),r+=x)):void s.splice(h,1)})}),o>r&&c&&(i=(o-r)/c)};p(),p(!0),t.autoColNums=c,t.eachCols(function(l,n){var s=n.minWidth||e.cellMinWidth,h=n.field||l;n.colspan>1||(n.width===0?t.getCssRule(h,function(m){m.style.width=Math.floor(i>=s?i:s)+"px"}):/\d+%$/.test(n.width)&&t.getCssRule(h,function(m){m.style.width=Math.floor(parseFloat(n.width)/100*o)+"px"}))});var f=t.layMain.width()-t.getScrollWidth(t.layMain[0])-t.layMain.children("table").outerWidth();if(t.autoColNums&&f>=-a&&f<=a){var u=function(l){var n;return l=l||t.layHeader.eq(0).find("thead th:last-child"),n=l.data("field"),!n&&l.prev()[0]?u(l.prev()):l},v=u(),b=v.data("field");t.getCssRule(b,function(l){var n=l.style.width||v.outerWidth();l.style.width=parseFloat(n)+f+"px",t.layMain.height()-t.layMain.prop("clientHeight")>0&&(l.style.width=parseFloat(l.style.width)-1+"px")})}t.loading(!0)},k.prototype.reload=function(t){var e=this;e.config.data&&e.config.data.constructor===Array&&delete e.config.data,e.config=d.extend({},e.config,t),e.render()},k.prototype.page=1,k.prototype.pullData=function(t){var e=this,a=e.config,c=a.request,i=a.response,r=function(){typeof a.initSort=="object"&&e.sort(a.initSort.field,a.initSort.type)};if(e.startTime=new Date().getTime(),a.url){var o={};o[c.pageName]=t,o[c.limitName]=a.limit;var p=d.extend(o,a.where);a.contentType&&a.contentType.indexOf("application/json")==0&&(p=JSON.stringify(p)),d.ajax({type:a.method||"get",url:a.url,contentType:a.contentType,data:p,dataType:"json",headers:a.headers||{},success:function(v){typeof a.parseData=="function"&&(v=a.parseData(v)||v),v[i.statusName]!=i.statusCode?(e.renderForm(),e.layMain.html('<div class="'+F+'">'+(v[i.msgName]||"\u8FD4\u56DE\u7684\u6570\u636E\u4E0D\u7B26\u5408\u89C4\u8303\uFF0C\u6B63\u786E\u7684\u6210\u529F\u72B6\u6001\u7801 ("+i.statusName+") \u5E94\u4E3A\uFF1A"+i.statusCode)+"</div>")):(e.renderData(v,t,v[i.countName]),r(),a.time=new Date().getTime()-e.startTime+" ms"),e.setColsWidth(),typeof a.done=="function"&&a.done(v,t,v[i.countName])},error:function(v,b){e.layMain.html('<div class="'+F+'">\u6570\u636E\u63A5\u53E3\u8BF7\u6C42\u5F02\u5E38\uFF1A'+b+"</div>"),e.renderForm(),e.setColsWidth()}})}else if(a.data&&a.data.constructor===Array){var f={},u=t*a.limit-a.limit;f[i.dataName]=a.data.concat().splice(u,a.limit),f[i.countName]=a.data.length,e.renderData(f,t,a.data.length),r(),e.setColsWidth(),typeof a.done=="function"&&a.done(f,t,f[i.countName])}},k.prototype.eachCols=function(t){var e=this;return g.eachCols(null,t,e.config.cols),e},k.prototype.renderData=function(t,e,a,c){var i=this,r=i.config,o=t[r.response.dataName]||[],p=[],f=[],u=[],v=function(){var b;return!c&&i.sortKey?i.sort(i.sortKey.field,i.sortKey.sort,!0):(layui.each(o,function(l,n){var s=[],h=[],m=[],x=l+r.limit*(e-1)+1;n.length!==0&&(c||(n[g.config.indexName]=l),i.eachCols(function(T,y){var L=y.field||T,w=n[L];if(w!=null||(w=""),!(y.colspan>1||y.hide)){var N=['<td data-field="'+L+'" '+function(){var C=[];return y.edit&&C.push('data-edit="'+y.edit+'"'),y.align&&C.push('align="'+y.align+'"'),y.templet&&C.push('data-content="'+w+'"'),y.toolbar&&C.push('data-off="true"'),y.event&&C.push('lay-event="'+y.event+'"'),y.style&&C.push('style="'+y.style+'"'),y.minWidth&&C.push('data-minwidth="'+y.minWidth+'"'),C.join(" ")}()+">",'<div class="layui-table-cell laytable-cell-'+function(){var C=r.index+"-"+L;return y.type==="normal"?C:C+" laytable-cell-"+y.type}()+'">'+function(){var C=d.extend(!0,{LAY_INDEX:x},n),S=g.config.checkName;switch(y.type){case"checkbox":return'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){return y[S]?(n[S]=y[S],y[S]?"checked":""):C[S]?"checked":""}()+">";case"radio":return C[S]&&(b=l),'<input type="radio" name="layTableRadio_'+r.index+'" '+(C[S]?"checked":"")+' lay-type="layTableRadio">';case"numbers":return x}return y.toolbar?R(d(y.toolbar).html()||"").render(C):y.templet?function(){return typeof y.templet=="function"?y.templet(C):R(d(y.templet).html()||String(w)).render(C)}():w}(),"</div></td>"].join("");s.push(N),y.fixed&&y.fixed!=="right"&&h.push(N),y.fixed==="right"&&m.push(N)}}),p.push('<tr data-index="'+l+'">'+s.join("")+"</tr>"),f.push('<tr data-index="'+l+'">'+h.join("")+"</tr>"),u.push('<tr data-index="'+l+'">'+m.join("")+"</tr>"))}),i.layBody.scrollTop(0),i.layMain.find("."+F).remove(),i.layMain.find("tbody").html(p.join("")),i.layFixLeft.find("tbody").html(f.join("")),i.layFixRight.find("tbody").html(u.join("")),i.renderForm(),typeof b=="number"&&i.setThisRowChecked(b),i.syncCheckAll(),i.haveInit?i.scrollPatch():setTimeout(function(){i.scrollPatch()},50),i.haveInit=!0,void A.close(i.tipsIndex))};return i.key=r.id||r.index,g.cache[i.key]=o,i.layPage[a==0||o.length===0&&e==1?"addClass":"removeClass"](I),c?v():o.length===0?(i.renderForm(),i.layFixed.remove(),i.layMain.find("tbody").html(""),i.layMain.find("."+F).remove(),i.layMain.append('<div class="'+F+'">'+r.text.none+"</div>")):(v(),i.renderTotal(o),void(r.page&&(r.page=d.extend({elem:"layui-table-page"+r.index,count:a,limit:r.limit,limits:r.limits||[10,20,30,40,50,60,70,80,90],groups:3,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;</i>',next:'<i class="layui-icon">&#xe602;</i>',jump:function(b,l){l||(i.page=b.curr,r.limit=b.limit,i.loading(),i.pullData(b.curr))}},r.page),r.page.count=a,$.render(r.page))))},k.prototype.renderTotal=function(t){var e=this,a=e.config,c={};if(a.totalRow){layui.each(t,function(r,o){o.length!==0&&e.eachCols(function(p,f){var u=f.field||p,v=o[u];f.totalRow&&(c[u]=(c[u]||0)+parseFloat(v))})});var i=[];e.eachCols(function(r,o){var p=o.field||r;if(!o.hide){var f=['<td data-field="'+p+'" '+function(){var u=[];return o.align&&u.push('align="'+o.align+'"'),o.style&&u.push('style="'+o.style+'"'),o.minWidth&&u.push('data-minwidth="'+o.minWidth+'"'),u.join(" ")}()+">",'<div class="layui-table-cell laytable-cell-'+function(){var u=a.index+"-"+p;return o.type==="normal"?u:u+" laytable-cell-"+o.type}()+'">'+function(){var u=o.totalRowText||"";return o.totalRow&&c[p]||u}(),"</div></td>"].join("");i.push(f)}}),e.layTotal.find("tbody").html("<tr>"+i.join("")+"</tr>")}},k.prototype.getColElem=function(t,e){var a=this,c=a.config;return t.eq(0).find(".laytable-cell-"+(c.index+"-"+e)+":eq(0)")},k.prototype.renderForm=function(t){q.render(t,"LAY-table-"+this.index)},k.prototype.setThisRowChecked=function(t){var e=this,a=(e.config,"layui-table-click"),c=e.layBody.find('tr[data-index="'+t+'"]');c.addClass(a).siblings("tr").removeClass(a)},k.prototype.sort=function(t,e,a,c){var i,r,o=this,p={},f=o.config,u=f.elem.attr("lay-filter"),v=g.cache[o.key];typeof t=="string"&&o.layHeader.find("th").each(function(l,n){var s=d(this),h=s.data("field");if(h===t)return t=s,i=h,!1});try{var i=i||t.data("field");if(o.sortKey&&!a&&i===o.sortKey.field&&e===o.sortKey.sort)return;var b=o.layHeader.find("th .laytable-cell-"+f.index+"-"+i).find(_);o.layHeader.find("th").find(_).removeAttr("lay-sort"),b.attr("lay-sort",e||null),o.layFixed.find("th")}catch(l){return z.error("Table modules: Did not match to field")}o.sortKey={field:i,sort:e},e==="asc"?r=layui.sort(v,i):e==="desc"?r=layui.sort(v,i,!0):(r=layui.sort(v,g.config.indexName),delete o.sortKey),p[f.response.dataName]=r,o.renderData(p,o.page,o.count,!0),c&&layui.event.call(t,W,"sort("+u+")",{field:i,type:e})},k.prototype.loading=function(t){var e=this,a=e.config;a.loading&&(t?(e.layInit&&e.layInit.remove(),delete e.layInit,e.layBox.find(Q).remove()):(e.layInit=d(['<div class="layui-table-init">','<i class="layui-icon layui-icon-loading layui-icon"></i>',"</div>"].join("")),e.layBox.append(e.layInit)))},k.prototype.setCheckData=function(t,e){var a=this,c=a.config,i=g.cache[a.key];i[t]&&i[t].constructor!==Array&&(i[t][c.checkName]=e)},k.prototype.syncCheckAll=function(){var t=this,e=t.config,a=t.layHeader.find('input[name="layTableCheckbox"]'),c=function(i){return t.eachCols(function(r,o){o.type==="checkbox"&&(o[e.checkName]=i)}),i};a[0]&&(g.checkStatus(t.key).isAll?(a[0].checked||(a.prop("checked",!0),t.renderForm("checkbox")),c(!0)):(a[0].checked&&(a.prop("checked",!1),t.renderForm("checkbox")),c(!1)))},k.prototype.getCssRule=function(t,e){var a=this,c=a.elem.find("style")[0],i=c.sheet||c.styleSheet||{},r=i.cssRules||i.rules;layui.each(r,function(o,p){if(p.selectorText===".laytable-cell-"+a.index+"-"+t)return e(p),!0})},k.prototype.fullSize=function(){var t,e=this,a=e.config,c=a.height;e.fullHeightGap&&(c=P.height()-e.fullHeightGap,c<135&&(c=135),e.elem.css("height",c)),c&&(t=parseFloat(c)-(e.layHeader.outerHeight()||38),a.toolbar&&(t-=e.layTool.outerHeight()||50),a.totalRow&&(t-=e.layTotal.outerHeight()||40),a.page&&(t=t-(e.layPage.outerHeight()||41)-2),e.layMain.css("height",t))},k.prototype.getScrollWidth=function(t){var e=0;return t?e=t.offsetWidth-t.clientWidth:(t=document.createElement("div"),t.style.width="100px",t.style.height="100px",t.style.overflowY="scroll",document.body.appendChild(t),e=t.offsetWidth-t.clientWidth,document.body.removeChild(t)),e},k.prototype.scrollPatch=function(){var t=this,e=t.layMain.children("table"),a=t.layMain.width()-t.layMain.prop("clientWidth"),c=t.layMain.height()-t.layMain.prop("clientHeight"),i=(t.getScrollWidth(t.layMain[0]),e.outerWidth()-t.layMain.width()),r=function(f){if(a&&c){if(f=f.eq(0),!f.find(".layui-table-patch")[0]){var u=d('<th class="layui-table-patch"><div class="layui-table-cell"></div></th>');u.find("div").css({width:a}),f.find("tr").append(u)}}else f.find(".layui-table-patch").remove()};r(t.layHeader),r(t.layTotal);var o=t.layMain.height(),p=o-c;t.layFixed.find(D).css("height",e.height()>p?p:"auto"),t.layFixRight[i>0?"removeClass":"addClass"](I),t.layFixRight.css("right",a-1)},k.prototype.events=function(){var t,e=this,a=e.config,c=d("body"),i={},r=e.layHeader.find("th"),o=".layui-table-cell",p=a.elem.attr("lay-filter");e.layTool.on("click","*[lay-event]",function(l){var n=d(this),s=n.attr("lay-event"),h=function(y){var L=d(y.list),w=d('<ul class="layui-table-tool-panel"></ul>');w.html(L),n.find(".layui-table-tool-panel")[0]||n.append(w),e.renderForm(),w.on("click",function(N){layui.stope(N)}),y.done&&y.done(w,L)};switch(layui.stope(l),M.trigger("table.tool.panel.remove"),A.close(e.tipsIndex),s){case"LAYTABLE_COLS":h({list:function(){var y=[];return e.eachCols(function(L,w){w.field&&w.type=="normal"&&y.push('<li><input type="checkbox" name="'+w.field+'" lay-skin="primary" '+(w.hide?"":"checked")+' title="'+w.title+'" lay-filter="LAY_TABLE_TOOL_COLS"></li>')}),y.join("")}(),done:function(){q.on("checkbox(LAY_TABLE_TOOL_COLS)",function(y){layui.each(a.cols,function(L,w){layui.each(w,function(N,C){C.field===y.elem.name&&(C.hide=!y.elem.checked,e.elem.find('*[data-field="'+y.elem.name+'"]')[y.elem.checked?"removeClass":"addClass"](I),e.fullSize(),e.scrollPatch(),e.setColsWidth())})})})}});break;case"LAYTABLE_EXPORT":j.ie?A.tips("\u5BFC\u51FA\u529F\u80FD\u4E0D\u652F\u6301 IE\uFF0C\u8BF7\u7528 Chrome \u7B49\u9AD8\u7EA7\u6D4F\u89C8\u5668\u5BFC\u51FA",this,{tips:3}):h({list:function(){return['<li data-type="csv">\u5BFC\u51FA\u5230 Csv \u6587\u4EF6</li>','<li data-type="xls">\u5BFC\u51FA\u5230 Excel \u6587\u4EF6</li>'].join("")}(),done:function(y,L){L.on("click",function(){var w=d(this).data("type");g.exportFile(a.id,null,w)})}});break;case"LAYTABLE_PRINT":var m=window.open("\u6253\u5370\u7A97\u53E3","_blank"),x=["<style>","body{font-size: 12px; color: #666;}","table{width: 100%; border-collapse: collapse; border-spacing: 0;}","th,td{line-height: 20px; padding: 9px 15px; border: 1px solid #ccc; text-align: left; font-size: 12px; color: #666;}","*.layui-hide{display: none}","</style>"].join(""),T=d(e.layHeader.html());T.find("th.layui-table-patch").remove(),T.append(e.layMain.find("table").html()),m.document.write(x+T.prop("outerHTML")),m.document.close(),m.print(),m.close()}layui.event.call(this,W,"toolbar("+p+")",d.extend({event:s,config:a},{}))}),r.on("mousemove",function(l){var n=d(this),s=n.offset().left,h=l.clientX-s;n.attr("colspan")>1||n.data("unresize")||i.resizeStart||(i.allowResize=n.width()-h<=10,c.css("cursor",i.allowResize?"col-resize":""))}).on("mouseleave",function(){d(this),i.resizeStart||c.css("cursor","")}).on("mousedown",function(l){var n=d(this);if(i.allowResize){var s=n.data("field");l.preventDefault(),i.resizeStart=!0,i.offset=[l.clientX,l.clientY],e.getCssRule(s,function(h){var m=h.style.width||n.outerWidth();i.rule=h,i.ruleWidth=parseFloat(m),i.minWidth=n.data("minwidth")||a.cellMinWidth})}}),M.on("mousemove",function(l){if(i.resizeStart){if(l.preventDefault(),i.rule){var n=i.ruleWidth+l.clientX-i.offset[0];n<i.minWidth&&(n=i.minWidth),i.rule.style.width=n+"px",A.close(e.tipsIndex)}t=1}}).on("mouseup",function(l){i.resizeStart&&(i={},c.css("cursor",""),e.scrollPatch()),t===2&&(t=null)}),r.on("click",function(l){var n,s=d(this),h=s.find(_),m=h.attr("lay-sort");return h[0]&&t!==1?(n=m==="asc"?"desc":m==="desc"?null:"asc",void e.sort(s,n,null,!0)):t=2}).find(_+" .layui-edge ").on("click",function(l){var n=d(this),s=n.index(),h=n.parents("th").eq(0).data("field");layui.stope(l),s===0?e.sort(h,"asc",null,!0):e.sort(h,"desc",null,!0)});var f=function(l){var n=d(this),s=n.parents("tr").eq(0).data("index"),h=e.layBody.find('tr[data-index="'+s+'"]'),m=g.cache[e.key][s];return d.extend({tr:h,data:g.clearCacheKey(m),del:function(){g.cache[e.key][s]=[],h.remove(),e.scrollPatch()},update:function(x){x=x||{},layui.each(x,function(T,y){if(T in m){var L,w=h.children('td[data-field="'+T+'"]');m[T]=y,e.eachCols(function(N,C){C.field==T&&C.templet&&(L=C.templet)}),w.children(o).html(function(){return L?function(){return typeof L=="function"?L(m):R(d(L).html()||y).render(m)}():y}()),w.data("content",y)}})}},l)};e.elem.on("click",'input[name="layTableCheckbox"]+',function(){var l=d(this).prev(),n=e.layBody.find('input[name="layTableCheckbox"]'),s=l.parents("tr").eq(0).data("index"),h=l[0].checked,m=l.attr("lay-filter")==="layTableAllChoose";m?(n.each(function(x,T){T.checked=h,e.setCheckData(x,h)}),e.syncCheckAll(),e.renderForm("checkbox")):(e.setCheckData(s,h),e.syncCheckAll()),layui.event.call(this,W,"checkbox("+p+")",f.call(this,{checked:h,type:m?"all":"one"}))}),e.elem.on("click",'input[lay-type="layTableRadio"]+',function(){var l=d(this).prev(),n=l[0].checked,s=g.cache[e.key],h=l.parents("tr").eq(0).data("index");layui.each(s,function(m,x){h===m?x.LAY_CHECKED=!0:delete x.LAY_CHECKED}),e.setThisRowChecked(h),layui.event.call(this,W,"radio("+p+")",f.call(this,{checked:n}))}),e.layBody.on("mouseenter","tr",function(){var l=d(this),n=l.index();e.layBody.find("tr:eq("+n+")").addClass(X)}).on("mouseleave","tr",function(){var l=d(this),n=l.index();e.layBody.find("tr:eq("+n+")").removeClass(X)}).on("click","tr",function(){u.call(this,"row")}).on("dblclick","tr",function(){u.call(this,"rowDouble")});var u=function(l){var n=d(this);layui.event.call(this,W,l+"("+p+")",f.call(n.children("td")[0]))};e.layBody.on("change","."+H,function(){var l=d(this),n=this.value,s=l.parent().data("field"),h=l.parents("tr").eq(0).data("index"),m=g.cache[e.key][h];m[s]=n,layui.event.call(this,W,"edit("+p+")",f.call(this,{value:n,field:s}))}).on("blur","."+H,function(){var l,n=d(this),s=n.parent().data("field"),h=n.parents("tr").eq(0).data("index"),m=g.cache[e.key][h];e.eachCols(function(x,T){T.field==s&&T.templet&&(l=T.templet)}),n.siblings(o).html(function(x){return l?function(){return typeof l=="function"?l(m):R(d(l).html()||this.value).render(m)}():x}(this.value)),n.parent().data("content",this.value),n.remove()}),e.layBody.on("click","td",function(){var l=d(this),n=(l.data("field"),l.data("edit")),s=l.children(o);if(!l.data("off")&&n){var h=d('<input class="layui-input '+H+'">');return h[0].value=l.data("content")||s.text(),l.find("."+H)[0]||l.append(h),void h.focus()}}).on("mouseenter","td",function(){b.call(this)}).on("mouseleave","td",function(){b.call(this,"hide")});var v="layui-table-grid-down",b=function(l){var n=d(this),s=n.children(o);if(l)n.find(".layui-table-grid-down").remove();else if(s.prop("scrollWidth")>s.outerWidth()){if(s.find("."+v)[0])return;n.append('<div class="'+v+'"><i class="layui-icon layui-icon-down"></i></div>')}};e.layBody.on("click","."+v,function(){var l=d(this),n=l.parent(),s=n.children(o);e.tipsIndex=A.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(s.height()+16)+"px;"+function(){return a.size==="sm"?"padding: 4px 15px; font-size: 12px;":a.size==="lg"?"padding: 14px 15px;":""}()+'">',s.html(),"</div>",'<i class="layui-icon layui-table-tips-c layui-icon-close"></i>'].join(""),s[0],{tips:[3,""],time:-1,anim:-1,maxWidth:j.ios||j.android?300:e.elem.width()/2,isOutAnim:!1,skin:"layui-table-tips",success:function(h,m){h.find(".layui-table-tips-c").on("click",function(){A.close(m)})}})}),e.layBody.on("click","*[lay-event]",function(){var l=d(this),n=l.parents("tr").eq(0).data("index");layui.event.call(this,W,"tool("+p+")",f.call(this,{event:l.attr("lay-event")})),e.setThisRowChecked(n)}),e.layMain.on("scroll",function(){var l=d(this),n=l.scrollLeft(),s=l.scrollTop();e.layHeader.scrollLeft(n),e.layTotal.scrollLeft(n),e.layFixed.find(D).scrollTop(s),A.close(e.tipsIndex)}),M.on("click",function(){M.trigger("table.remove.tool.panel")}),M.on("table.remove.tool.panel",function(){d(".layui-table-tool-panel").remove()}),P.on("resize",function(){e.fullSize(),e.scrollPatch(),e.setColsWidth()})},g.init=function(t,e){e=e||{};var a=this,c=d(t?'table[lay-filter="'+t+'"]':U+"[lay-data]"),i="Table element property lay-data configuration item has a syntax error: ";return c.each(function(){var r=d(this),o=r.attr("lay-data");try{o=new Function("return "+o)()}catch(u){z.error(i+o)}var p=[],f=d.extend({elem:this,cols:[],data:[],skin:r.attr("lay-skin"),size:r.attr("lay-size"),even:typeof r.attr("lay-even")=="string"},g.config,e,o);t&&r.hide(),r.find("thead>tr").each(function(u){f.cols[u]=[],d(this).children().each(function(v){var b=d(this),l=b.attr("lay-data");try{l=new Function("return "+l)()}catch(s){return z.error(i+l)}var n=d.extend({title:b.text(),colspan:b.attr("colspan")||0,rowspan:b.attr("rowspan")||0},l);n.colspan<2&&p.push(n),f.cols[u].push(n)})}),r.find("tbody>tr").each(function(u){var v=d(this),b={};v.children("td").each(function(l,n){var s=d(this),h=s.data("field");if(h)return b[h]=s.html()}),layui.each(p,function(l,n){var s=v.children("td").eq(l);b[n.field]=s.html()}),f.data[u]=b}),g.render(f)}),a},E.config={},g.eachCols=function(t,e,a){var c=E.config[t]||{},i=[],r=0;a=d.extend(!0,[],a||c.cols),layui.each(a,function(p,f){layui.each(f,function(u,v){if(v.colspan>1){var b=0;r++,v.CHILD_COLS=[],layui.each(a[p+1],function(l,n){n.PARENT_COL||b==v.colspan||(n.PARENT_COL=r,v.CHILD_COLS.push(n),b+=n.colspan>1?n.colspan:1)})}v.PARENT_COL||i.push(v)})});var o=function(p){layui.each(p||i,function(f,u){return u.CHILD_COLS?o(u.CHILD_COLS):void e(f,u)})};o()},g.checkStatus=function(t){var e=0,a=0,c=[],i=g.cache[t]||[];return layui.each(i,function(r,o){return o.constructor===Array?void a++:void(o[g.config.checkName]&&(e++,c.push(g.clearCacheKey(o))))}),{data:c,isAll:!!i.length&&e===i.length-a}},g.exportFile=function(t,e,a){e=e||g.clearCacheKey(g.cache[t]),a=a||"csv";var c=E.config[t]||{},i={csv:"text/csv",xls:"application/vnd.ms-excel"}[a],r=document.createElement("a");return j.ie?z.error("IE_NOT_SUPPORT_EXPORTS"):(r.href="data:"+i+";charset=utf-8,\uFEFF"+encodeURIComponent(function(){var o=[],p=[];return layui.each(e,function(f,u){var v=[];typeof t=="object"?(layui.each(t,function(b,l){f==0&&o.push(l||"")}),layui.each(g.clearCacheKey(u),function(b,l){v.push(l)})):g.eachCols(t,function(b,l){l.field&&l.type=="normal"&&!l.hide&&(f==0&&o.push(l.title||""),v.push(u[l.field]))}),p.push(v.join(","))}),o.join(",")+`\r
`+p.join(`\r
`)}()),r.download=(c.title||"table_"+(c.index||""))+"."+a,document.body.appendChild(r),r.click(),void document.body.removeChild(r))},g.reload=function(t,e){var a=E.config[t];return e=e||{},a?(e.data&&e.data.constructor===Array&&delete a.data,g.render(d.extend(!0,{},a,e))):z.error("The ID option was not found in the table instance")},g.render=function(t){var e=new k(t);return E.call(e)},g.clearCacheKey=function(t){return t=d.extend({},t),delete t[g.config.checkName],delete t[g.config.indexName],t},g.init(),G(W,g)});
