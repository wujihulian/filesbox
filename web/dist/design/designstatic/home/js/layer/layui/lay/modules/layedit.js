layui.define(["layer","form"],function(N){"use strict";var c=layui.$,d=layui.layer,x=layui.form,k=(layui.hint(),layui.device()),j="layedit",P="layui-show",L="layui-disabled",v=function(){var t=this;t.index=0,t.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};v.prototype.set=function(t){var e=this;return c.extend(!0,e.config,t),e},v.prototype.on=function(t,e){return layui.onevent(j,t,e)},v.prototype.build=function(t,e){e=e||{};var i=this,a=i.config,o="layui-layedit",n=c(typeof t=="string"?"#"+t:t),l="LAY_layedit_"+ ++i.index,u=n.next("."+o),p=c.extend({},a,e),r=function(){var f=[],y={};return layui.each(p.hideTool,function(m,b){y[b]=!0}),layui.each(p.tool,function(m,b){M[b]&&!y[b]&&f.push(M[b])}),f.join("")}(),s=c(['<div class="'+o+'">','<div class="layui-unselect layui-layedit-tool">'+r+"</div>",'<div class="layui-layedit-iframe">','<iframe id="'+l+'" name="'+l+'" textarea="'+t+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));return k.ie&&k.ie<8?n.removeClass("layui-hide").addClass(P):(u[0]&&u.remove(),R.call(i,s,n[0],p),n.addClass("layui-hide").after(s),i.index)},v.prototype.getContent=function(t){var e=g(t);if(e[0])return _(e[0].document.body.innerHTML)},v.prototype.getText=function(t){var e=g(t);if(e[0])return c(e[0].document.body).text()},v.prototype.setContent=function(t,e,i){var a=g(t);a[0]&&(i?c(a[0].document.body).append(e):c(a[0].document.body).html(e),layedit.sync(t))},v.prototype.sync=function(t){var e=g(t);if(e[0]){var i=c("#"+e[1].attr("textarea"));i.val(_(e[0].document.body.innerHTML))}},v.prototype.getSelection=function(t){var e=g(t);if(e[0]){var i=C(e[0].document);return document.selection?i.text:i.toString()}};var R=function(t,e,i){var a=this,o=t.find("iframe");o.css({height:i.height}).on("load",function(){var n=o.contents(),l=o.prop("contentWindow"),u=n.find("head"),p=c(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),r=n.find("body");u.append(p),r.attr("contenteditable","true").css({"min-height":i.height}).html(e.value||""),z.apply(a,[l,o,e,i]),B.call(a,l,t,i)})},g=function(t){var e=c("#LAY_layedit_"+t),i=e.prop("contentWindow");return[i,e]},_=function(t){return k.ie==8&&(t=t.replace(/<.+>/g,function(e){return e.toLowerCase()})),t},z=function(t,e,i,a){var o=t.document,n=c(o.body);n.on("keydown",function(l){var u=l.keyCode;if(u===13){var p=C(o),r=T(p),s=r.parentNode;if(s.tagName.toLowerCase()==="pre")return l.shiftKey?void 0:(d.msg("\u8BF7\u6682\u65F6\u7528shift+enter"),!1);o.execCommand("formatBlock",!1,"<p>")}}),c(i).parents("form").on("submit",function(){var l=n.html();k.ie==8&&(l=l.replace(/<.+>/g,function(u){return u.toLowerCase()})),i.value=l}),n.on("paste",function(l){o.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){Y.call(t,n),i.value=n.html()},100)})},Y=function(t){var e=this;e.document,t.find("*[style]").each(function(){var i=this.style.textAlign;this.removeAttribute("style"),c(this).css({"text-align":i||""})}),t.find("table").addClass("layui-table"),t.find("script,link").remove()},C=function(t){return t.selection?t.selection.createRange():t.getSelection().getRangeAt(0)},T=function(t){return t.endContainer||t.parentElement().childNodes[0]},w=function(t,e,i){var a=this.document,o=document.createElement(t);for(var n in e)o.setAttribute(n,e[n]);if(o.removeAttribute("text"),a.selection){var l=i.text||e.text;if(t==="a"&&!l)return;l&&(o.innerHTML=l),i.pasteHTML(c(o).prop("outerHTML")),i.select()}else{var l=i.toString()||e.text;if(t==="a"&&!l)return;l&&(o.innerHTML=l),i.deleteContents(),i.insertNode(o)}},S=function(t,e){var i=this.document,a="layedit-tool-active",o=T(C(i)),n=function(l){return t.find(".layedit-tool-"+l)};e&&e[e.hasClass(a)?"removeClass":"addClass"](a),t.find(">i").removeClass(a),n("unlink").addClass(L),c(o).parents().each(function(){var l=this.tagName.toLowerCase(),u=this.style.textAlign;l!=="b"&&l!=="strong"||n("b").addClass(a),l!=="i"&&l!=="em"||n("i").addClass(a),l==="u"&&n("u").addClass(a),l==="strike"&&n("d").addClass(a),l==="p"&&(u==="center"?n("center").addClass(a):u==="right"?n("right").addClass(a):n("left").addClass(a)),l==="a"&&(n("link").addClass(a),n("unlink").removeClass(L))})},B=function(t,e,i){var a=t.document,o=c(a.body),n={link:function(r){var s=T(r),f=c(s).parent();A.call(o,{href:f.attr("href"),target:f.attr("target")},function(y){var m=f[0];m.tagName==="A"?m.href=y.url:w.call(t,"a",{target:y.target,href:y.url,text:y.url},r)})},unlink:function(r){a.execCommand("unlink")},face:function(r){h.call(this,function(s){w.call(t,"img",{src:s.src,alt:s.alt},r)})},image:function(r){var s=this;layui.use("upload",function(f){var y=i.uploadImage||{};f.render({url:y.url,method:y.type,elem:c(s).find("input")[0],done:function(m){m.code==0?(m.data=m.data||{},w.call(t,"img",{src:m.data.src,alt:m.data.title},r)):d.msg(m.msg||"\u4E0A\u4F20\u5931\u8D25")}})})},code:function(r){H.call(o,function(s){w.call(t,"pre",{text:s.code,"lay-lang":s.lang},r)})},help:function(){d.open({type:2,title:"\u5E2E\u52A9",area:["600px","380px"],shadeClose:!0,shade:.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},l=e.find(".layui-layedit-tool"),u=function(){var r=c(this),s=r.attr("layedit-event"),f=r.attr("lay-command");if(!r.hasClass(L)){o.focus();var y=C(a);y.commonAncestorContainer,f?(a.execCommand(f),/justifyLeft|justifyCenter|justifyRight/.test(f)&&a.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){o.focus()},10)):n[s]&&n[s].call(this,y),S.call(t,l,r)}},p=/image/;l.find(">i").on("mousedown",function(){var r=c(this),s=r.attr("layedit-event");p.test(s)||u.call(this)}).on("click",function(){var r=c(this),s=r.attr("layedit-event");p.test(s)&&u.call(this)}),o.on("click",function(){S.call(t,l),d.close(h.index)})},A=function(t,e){var i=this,a=d.open({type:1,id:"LAY_layedit_link",area:"350px",shade:.05,shadeClose:!0,moveType:1,title:"\u8D85\u94FE\u63A5",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL</label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(t.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"</div>","</li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">\u6253\u5F00\u65B9\u5F0F</label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="\u5F53\u524D\u7A97\u53E3"'+(t.target!=="_self"&&t.target?"":"checked")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="\u65B0\u7A97\u53E3" '+(t.target==="_blank"?"checked":"")+">","</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> \u786E\u5B9A </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> \u53D6\u6D88 </button>',"</li>","</ul>"].join(""),success:function(o,n){var l="submit(layedit-link-yes)";x.render("radio"),o.find(".layui-btn-primary").on("click",function(){d.close(n),i.focus()}),x.on(l,function(u){d.close(A.index),e&&e(u.field)})}});A.index=a},h=function(t){var e=function(){var i=["[\u5FAE\u7B11]","[\u563B\u563B]","[\u54C8\u54C8]","[\u53EF\u7231]","[\u53EF\u601C]","[\u6316\u9F3B]","[\u5403\u60CA]","[\u5BB3\u7F9E]","[\u6324\u773C]","[\u95ED\u5634]","[\u9119\u89C6]","[\u7231\u4F60]","[\u6CEA]","[\u5077\u7B11]","[\u4EB2\u4EB2]","[\u751F\u75C5]","[\u592A\u5F00\u5FC3]","[\u767D\u773C]","[\u53F3\u54FC\u54FC]","[\u5DE6\u54FC\u54FC]","[\u5618]","[\u8870]","[\u59D4\u5C48]","[\u5410]","[\u54C8\u6B20]","[\u62B1\u62B1]","[\u6012]","[\u7591\u95EE]","[\u998B\u5634]","[\u62DC\u62DC]","[\u601D\u8003]","[\u6C57]","[\u56F0]","[\u7761]","[\u94B1]","[\u5931\u671B]","[\u9177]","[\u8272]","[\u54FC]","[\u9F13\u638C]","[\u6655]","[\u60B2\u4F24]","[\u6293\u72C2]","[\u9ED1\u7EBF]","[\u9634\u9669]","[\u6012\u9A82]","[\u4E92\u7C89]","[\u5FC3]","[\u4F24\u5FC3]","[\u732A\u5934]","[\u718A\u732B]","[\u5154\u5B50]","[ok]","[\u8036]","[good]","[NO]","[\u8D5E]","[\u6765]","[\u5F31]","[\u8349\u6CE5\u9A6C]","[\u795E\u9A6C]","[\u56E7]","[\u6D6E\u4E91]","[\u7ED9\u529B]","[\u56F4\u89C2]","[\u5A01\u6B66]","[\u5965\u7279\u66FC]","[\u793C\u7269]","[\u949F]","[\u8BDD\u7B52]","[\u8721\u70DB]","[\u86CB\u7CD5]"],a={};return layui.each(i,function(o,n){a[n]=layui.cache.dir+"images/face/"+o+".gif"}),a}();return h.hide=h.hide||function(i){c(i.target).attr("layedit-event")!=="face"&&d.close(h.index)},h.index=d.tips(function(){var i=[];return layui.each(e,function(a,o){i.push('<li title="'+a+'"><img src="'+o+'" alt="'+a+'"></li>')}),'<ul class="layui-clear">'+i.join("")+"</ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(i,a){i.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){t&&t({src:e[this.title],alt:this.title}),d.close(a)}),c(document).off("click",h.hide).on("click",h.hide)}})},H=function(t){var e=this,i=d.open({type:1,id:"LAY_layedit_code",area:"550px",shade:.05,shadeClose:!0,moveType:1,title:"\u63D2\u5165\u4EE3\u7801",skin:"layui-layer-msg",content:['<ul class="layui-form layui-form-pane" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label">\u8BF7\u9009\u62E9\u8BED\u8A00</label>','<div class="layui-input-block">','<select name="lang">','<option value="JavaScript">JavaScript</option>','<option value="HTML">HTML</option>','<option value="CSS">CSS</option>','<option value="Java">Java</option>','<option value="PHP">PHP</option>','<option value="C#">C#</option>','<option value="Python">Python</option>','<option value="Ruby">Ruby</option>','<option value="Go">Go</option>',"</select>","</div>","</li>",'<li class="layui-form-item layui-form-text">','<label class="layui-form-label">\u4EE3\u7801</label>','<div class="layui-input-block">','<textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"></textarea>',"</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> \u786E\u5B9A </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> \u53D6\u6D88 </button>',"</li>","</ul>"].join(""),success:function(a,o){var n="submit(layedit-code-yes)";x.render("select"),a.find(".layui-btn-primary").on("click",function(){d.close(o),e.focus()}),x.on(n,function(l){d.close(H.index),t&&t(l.field)})}});H.index=i},M={html:'<i class="layui-icon layedit-tool-html" title="HTML\u6E90\u4EE3\u7801" lay-command="html" layedit-event="html"">&#xe64b;</i><span class="layedit-tool-mid"></span>',strong:'<i class="layui-icon layedit-tool-b" title="\u52A0\u7C97" lay-command="Bold" layedit-event="b"">&#xe62b;</i>',italic:'<i class="layui-icon layedit-tool-i" title="\u659C\u4F53" lay-command="italic" layedit-event="i"">&#xe644;</i>',underline:'<i class="layui-icon layedit-tool-u" title="\u4E0B\u5212\u7EBF" lay-command="underline" layedit-event="u"">&#xe646;</i>',del:'<i class="layui-icon layedit-tool-d" title="\u5220\u9664\u7EBF" lay-command="strikeThrough" layedit-event="d"">&#xe64f;</i>',"|":'<span class="layedit-tool-mid"></span>',left:'<i class="layui-icon layedit-tool-left" title="\u5DE6\u5BF9\u9F50" lay-command="justifyLeft" layedit-event="left"">&#xe649;</i>',center:'<i class="layui-icon layedit-tool-center" title="\u5C45\u4E2D\u5BF9\u9F50" lay-command="justifyCenter" layedit-event="center"">&#xe647;</i>',right:'<i class="layui-icon layedit-tool-right" title="\u53F3\u5BF9\u9F50" lay-command="justifyRight" layedit-event="right"">&#xe648;</i>',link:'<i class="layui-icon layedit-tool-link" title="\u63D2\u5165\u94FE\u63A5" layedit-event="link"">&#xe64c;</i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="\u6E05\u9664\u94FE\u63A5" lay-command="unlink" layedit-event="unlink"">&#xe64d;</i>',face:'<i class="layui-icon layedit-tool-face" title="\u8868\u60C5" layedit-event="face"">&#xe650;</i>',image:'<i class="layui-icon layedit-tool-image" title="\u56FE\u7247" layedit-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="layui-icon layedit-tool-code" title="\u63D2\u5165\u4EE3\u7801" layedit-event="code">&#xe64e;</i>',help:'<i class="layui-icon layedit-tool-help" title="\u5E2E\u52A9" layedit-event="help">&#xe607;</i>'},F=new v;N(j,F)});
