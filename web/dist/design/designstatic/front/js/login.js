var wapurl=window.location.origin+"/pages/wap/logins.html"+window.location.search;/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&(window.location.href=wapurl);var isLoginwindowRegister,tabs=1;$.ajax({type:"GET",headers:{token:getCookie("token")},url:"/api/school/getSchoolorPlatformInfoByHostName?projectid=12",contentType:"application/json",dataType:"json",data:{},async:!1,success:function(o){isLoginwindowRegister=o.data.isLoginwindowRegister}}),$(".go_register").click(function(){isLoginwindowRegister?layer.alert("\u8BE5\u7F51\u6821\u5DF2\u7981\u6B62\u6CE8\u518C\uFF0C\u8BF7\u8054\u7CFB\u8BE5\u7F51\u6821\u7BA1\u7406\u5458\uFF01"):window.location.href="/pages/register.html"}),$(".switch_tab li").click(function(){$(".switch_tab li").removeClass("current"),$(this).addClass("current");var o=$(this).attr("tab");$(".switch_pwd_con").hide();for(var i=0;i<$(".switch_pwd_con").length;i++)$(".switch_pwd_con").eq(i).attr("tab")==o&&$(".switch_pwd_con").eq(i).show()}),$(".submit").eq(0).on("click",function(){login()}),$("body").on("keypress",function(o){o.keyCode==13&&login()}),$(".get_code").on("click",function(){validate()}),$(".submit").eq(1).on("click",function(){tellogin(function(o){})});function login(){var o=$("#login_account").val(),i=$("#login_pwd").val();if(o=="")$(".account").show().text("\u8D26\u6237\u4E0D\u80FD\u4E3A\u7A7A"),$("#login_account").focus();else if($(".account").hide(),i=="")$(".pwd").show().text("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"),$("#login_pwd").focus();else{var t={},n=navigator.userAgent.toLowerCase(),e;(e=n.match(/msie/))?t.msie=e[0]:(e=n.match(/trident/))?t.trident=e[0]:(e=n.match(/edge/))?t.chrome=e[0]:(e=n.match(/firefox/))?t.firefox=e[0]:(e=n.match(/360/))||(e=n.match(/metasr/))||(e=n.match(/ubrowser/))||(e=n.match(/qqbrowser/))||(e=n.match(/chrome/))?t.chrome=e[0]:(e=n.match(/safari/))&&(t.safari=e[0]);try{myextension&&(e[0]="xxBrowser")}catch(r){}e||(e=["otherBrowser"]),e[0]=="trident"||e[0]=="msie"?e[0]="Internet Explorer":e[0]=="edge"?e[0]="Microsoft Edge":e[0]=="metasr"?e[0]="metasr":e[0]=="chrome"?e[0]="Chrome":e[0]=="firefox"?e[0]="Firefox":e[0]=="safari"?e[0]="Safari":e[0]=="ubrowser"&&(e[0]="Uc"),$.ajax({headers:{resolution:window.screen.width+"*"+window.screen.height,browsername:e[0]},type:"post",url:"/api/jwt/login?projectid=45",contentType:"application/json;charset=utf-8",data:JSON.stringify({encrypted:!0,username:o,password:encrypt(i)}),async:!0,success:function(r){if(r.code==200)if(r.success==!0)$(".pwd").hide(),getPar("rute")?window.location.href=window.location.origin+getPar("rute"):window.location.href=window.location.origin;else{var a=res.data,c="";if(a){var s=a.errCode;s=="4012"?c="\u8D85\u8FC7\u9650\u5236\u6B21\u6570"+a.limitCount+"\u6B21\uFF0C\u8BF7"+a.denyTime/60+"\u5206\u949F\u540E\u91CD\u8BD5":c="\u5BC6\u7801\u6216\u8D26\u53F7\u4E0D\u6B63\u786E"}else c="\u5BC6\u7801\u6216\u8D26\u53F7\u4E0D\u6B63\u786E";$(".account").show().text(c),$("#login_account").focus()}else r.code==707?($(".pwd").show().text("\u60A8\u5DF2\u88AB\u7981\u6B62\u767B\u5F55"),$("#login_pwd").focus()):r.code==602?($(".pwd").show().text("\u975E\u7F51\u6821\u7528\u6237\u7981\u6B62\u767B\u5F55"),$("#login_pwd").focus()):r.code==403?($(".pwd").show().text("\u8D26\u53F7\u7C7B\u578B\u4E0D\u6B63\u786E"),$("#login_pwd").focus()):r.code==400?($(".pwd").show().text("\u8BE5\u7F51\u6821\u9700\u8981\u4F7F\u7528\u9501\u5C4F\u6D4F\u89C8\u5668\u767B\u5F55"),$("#login_pwd").focus()):r.code==503?($(".pwd").show().text("\u5DF2\u88AB\u9650\u5236\u767B\u5F55"),$("#login_pwd").focus()):(r.message="\u975E\u7F51\u6821\u7528\u6237\u4E0D\u80FD\u8FDB\u5165")?($(".pwd").show().text("\u975E\u7F51\u6821\u7528\u6237\u4E0D\u80FD\u8FDB\u5165"),$("#login_pwd").focus()):($(".pwd").show().text("\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),$("#login_pwd").focus())}})}}function setCookie(o,i){var t=o+"="+i+";path=/";document.cookie=t}function tellogin(o){var i=$("#login_tel").val(),t=$("#login_code").val();i==""?($(".message").show().text("\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"),$("#login_tel").focus()):/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(i)?($(".message").hide(),t==""?($(".ma").show().text("\u9A8C\u8BC1\u7801\u4E0D\u80FD\u4E3A\u7A7A"),$("#login_code").focus()):$.ajax({type:"GET",headers:{token:getCookie("token")},url:"/api/user/phone/check?projectid=10",contentType:"application/json",dataType:"json",data:{mobilePhone:i},async:!0,success:function(n){if(n.data==!1&&isLoginwindowRegister)layer.open({content:"\u8BE5\u7F51\u6821\u5DF2\u7981\u6B62\u6CE8\u518C\uFF0C\u8BF7\u8054\u7CFB\u8BE5\u7F51\u6821\u7BA1\u7406\u5458\uFF01",btn:"\u786E\u5B9A"});else{var e=getregisterchannel();e.mobile=i,e.smsCode=t,e.clueSourceType=e.sourceType,delete e.sourceType,$.ajax({type:"GET",headers:{token:getCookie("token")},url:"/api/user/mobileLogin?projectid=45",contentType:"application/json",dataType:"json",data:e,async:!0,success:function(r){r.code==200?(setCookie("token",r.data.token),$(".ma").hide(),o(r),getPar("rute")?window.location.href=window.location.origin+getPar("rute"):window.location.href=window.location.origin):r.code==602?($(".message").show().text("\u8D26\u53F7\u88AB\u9501\u5B9A"),$("#login_tel").focus()):($(".ma").show().text(r.message||"\u9A8C\u8BC1\u7801\u4E0D\u6B63\u786E"),$("#login_code").focus())}})}}})):($(".message").show().text("\u624B\u673A\u53F7\u7801\u4E0D\u6B63\u786E"),$("#login_tel").focus())}function validate(){var o=$("#login_tel").val(),i=$("#login_code").val();o==""?($(".message").show().text("\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"),$("#login_tel").focus()):/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(o)?($(".message").hide(),$.ajax({type:"POST",headers:{token:getCookie("token")},url:"/api/school/sendRegisterOrLogin?projectid=45",contentType:"application/json",dataType:"json",data:JSON.stringify({mobilePhone:o}),async:!0,success:function(t){if(t.code==200){let a=function(c){if(n==1){c.attr("disabled",!1),c.show(),$(".disableds").hide(),n=60;return}else $(".disableds").attr("disabled",!0),c.hide(),$(".disableds").show().val("\u91CD\u65B0\u53D1\u9001("+n+")"),n--;setTimeout(function(){a(c)},1e3)};var r=a,n=60,e=$(".get_code");a(e)}else(!t.success&&t.code==601||!t.success&&t.code==400)&&$(".ma").show().text("\u53D1\u9001\u9A8C\u8BC1\u7801\u5931\u8D25,\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\uFF01")}})):($(".message").show().text("\u624B\u673A\u53F7\u7801\u4E0D\u6B63\u786E"),$("#login_tel").focus())}$("#login-qq").on("click",function(){var o=getregisterchannel();o.clueSourceType=o.sourceType,delete o.sourceType,$.ajax({type:"GET",headers:{token:getCookie("token")},url:"/api/user/qqlogin?projectid=45",contentType:"application/json",dataType:"json",data:o,async:!0,success:function(i){window.location.href=i.url}})});var appid,redirectUri,state;$.ajax({type:"GET",headers:{token:getCookie("token")},url:"/api/user/wechat/qrcode?projectid=38",contentType:"application/json",dataType:"json",async:!1,success:function(o){appid=o.data.appid,redirectUri=o.data.redirectUri,state=o.data.state}});function getregisterchannel(){var o=sessionStorage.getItem("cluechannel")?JSON.parse(sessionStorage.getItem("cluechannel")):{},i=sessionStorage.getItem("sourceip");return o.ip=i||"",o.uvcid=localStorage.uvcid||"",o.pvid=sessionStorage.getItem("pvid")||"",o}function getCookie(o){for(var i=document.cookie,t=i.split("; "),n=0;n<t.length;n++){var e=t[n].split("=");if(e[0]==o)return e[1]}return""}function encrypt(o){var i=CryptoJS.enc.Utf8.parse("njsdearr8h239ay3"),t=CryptoJS.enc.Utf8.parse(o),n=CryptoJS.AES.encrypt(t,i,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return n.toString()}function decrypt(o){var i=CryptoJS.enc.Utf8.parse("njsdearr8h239ay3"),t=CryptoJS.AES.decrypt(o,i,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return CryptoJS.enc.Utf8.stringify(t).toString()}function getPar(o){var i=document.location.href,t=i.indexOf(o+"=");if(t==-1)return!1;var n=i.slice(o.length+t+1),e=n.indexOf("&");return e!=-1&&(n=n.slice(0,e)),n}$(".switch_wq_con").hover(function(){$(".qr_code_hover").css("opacity","1"),$(".qr_code").css("left","-15%"),$(".qr_code").css("margin-left","0")},function(){$(".qr_code_hover").css("opacity","0"),$(".qr_code").css("left","35%"),$(".qr_code").css("margin-left","-90px")}),$(document).ready(function(){var o=new WxLogin({id:"login_container",appid,scope:"snsapi_login",redirect_uri:redirectUri,state,style:"black",href:"/static/front/css/wechat-qrcode.css"})});
