var wapurl=window.location.origin+"/pages/wap/register.html"+window.location.search;/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&(window.location.href=wapurl),$(".next").on("click",function(){register()}),$(".get_code").on("click",function(){validate()});function register(){var e=$("#register_tel").val(),a=$("#register_code").val(),i=$("#register_pwd_one").val(),r=$("#register_pwd_two").val(),t=!0,n=!0,d=!0,o=!0;if(e==""?($("#register_tel").parent().find(".tips").addClass("show").text("\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"),$("#register_tel").focus(),t=!1):/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(e)?$.ajax({type:"GET",url:"/api/user/phone/check?projectid=10",contentType:"application/json;charset=utf-8",dataType:"json",data:{mobilePhone:e},success:function(l){l.data==!1?(t=!0,$("#register_tel").parent().find(".tips").removeClass("show")):(t=!1,$("#register_tel").parent().find(".tips").addClass("show").text("\u8BE5\u624B\u673A\u53F7\u7801\u5DF2\u88AB\u6CE8\u518C!"),$("#register_tel").focus())}}):($("#register_tel").parent().find(".tips").addClass("show").text("\u624B\u673A\u53F7\u7801\u4E0D\u6B63\u786E"),$("#register_tel").focus(),t=!1),a==""?($("#register_code").parent().find(".tips").addClass("show").text("\u9A8C\u8BC1\u7801\u4E0D\u80FD\u4E3A\u7A7A"),$("#register_code").focus(),o=!1):($("#register_code").parent().find(".tips").removeClass("show"),o=!0),i==""?($("#register_pwd_one").parent().find(".tips").addClass("show").text("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"),$("#register_pwd_one").focus(),n=!1):/^.*(?=.{8,20})(?=.*\d)(?=.*[a-zA-Z!@#$%^&*? ]).*$/.test(i)?($("#register_pwd_one").parent().find(".tips").removeClass("show"),n=!0):($("#register_pwd_one").parent().find(".tips").addClass("show").text("\u5BC6\u7801\u7531\u5B57\u6BCD\u52A0\u6570\u5B57\u81F3\u5C11\u4E24\u79CD\u4EE5\u4E0A\u5B57\u7B26\u7EC4\u6210\u76848-20\u4F4D\u5B57\u7B26"),$("#register_pwd_one").focus(),n=!1),r==""?($("#register_pwd_two").parent().find(".tips").addClass("show").text("\u786E\u8BA4\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"),$("#register_pwd_two").focus(),d=!1):r==i?($("#register_pwd_two").parent().find(".tips").removeClass("show"),d=!0):($("#register_pwd_two").parent().find(".tips").addClass("show").text("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"),$("#register_pwd_two").focus(),d=!1),t&&n&&d&&o){var s=getregisterchannel();s.mobilePhone=e,s.password=i,s.smsCode=a,s.clueSourceType=s.sourceType,delete s.sourceType,$.ajax({type:"POST",headers:{token:getCookie("token")},url:"/api/user/registerUser?projectid=45",contentType:"application/json",dataType:"json",data:JSON.stringify(s),async:!0,success:function(l){l.code==200?(layer.confirm("\u6CE8\u518C\u6210\u529F\uFF01",{btn:["\u786E\u5B9A"]},function(){alertFunc()}),setTimeout(alertFunc,2e3)):l.code==600?($("#register_code").parent().find(".tips").addClass("show").text("\u9A8C\u8BC1\u7801\u4E0D\u6B63\u786E"),$("#register_code").focus()):layer.alert("\u6CE8\u518C\u5931\u8D25,\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\uFF01")}})}}function validate(){var e=$("#register_tel").val(),a=$("#register_code").val();e==""?($("#register_tel").parent().find(".tips").addClass("show").text("\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"),$("#register_tel").focus()):/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(e)?$.ajax({type:"GET",url:"/api/user/phone/check?projectid=10",contentType:"application/json;charset=utf-8",dataType:"json",data:{mobilePhone:e},success:function(i){i.data==!1?($("#register_tel").parent().find(".tips").removeClass("show"),$.ajax({type:"POST",headers:{token:getCookie("token")},url:"/api/school/sendRegisterVerify?projectid=45",contentType:"application/json",dataType:"json",data:JSON.stringify({mobilePhone:e}),async:!0,success:function(r){if(r.code==200){let o=function(s){if(t==1){s.attr("disabled",!1),s.show(),$(".disableds").hide(),t=60;return}else $(".disableds").attr("disabled",!0),s.hide(),$(".disableds").show().val("\u91CD\u65B0\u53D1\u9001("+t+")"),t--;setTimeout(function(){o(s)},1e3)};var d=o,t=60,n=$(".get_code");o(n)}else r.code==601&&($("#register_tel").parent().find(".tips").addClass("show").text("\u53D1\u9001\u9A8C\u8BC1\u7801\u5931\u8D25,\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\uFF01"),$("#register_tel").focus())}})):($("#register_tel").parent().find(".tips").addClass("show").text("\u8BE5\u624B\u673A\u53F7\u7801\u5DF2\u88AB\u6CE8\u518C!"),$("#register_tel").focus())}}):($("#register_tel").parent().find(".tips").addClass("show").text("\u624B\u673A\u53F7\u7801\u4E0D\u6B63\u786E"),$("#register_tel").focus())}function getregisterchannel(){var e=sessionStorage.getItem("cluechannel")?JSON.parse(sessionStorage.getItem("cluechannel")):{},a=sessionStorage.getItem("sourceip");return e.ip=a||"",e.uvcid=localStorage.uvcid||"",e.pvid=sessionStorage.getItem("pvid")||"",e}function alertFunc(){window.location.href=window.location.origin}function getCookie(e){for(var a=document.cookie,i=a.split("; "),r=0;r<i.length;r++){var t=i[r].split("=");if(t[0]==e)return t[1]}return""}
