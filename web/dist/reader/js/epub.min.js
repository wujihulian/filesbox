(function(Z,Y){typeof exports=="object"&&typeof module=="object"?module.exports=Y(require("xmldom"),function(){try{return require("jszip")}catch(J){}}()):typeof define=="function"&&define.amd?define(["xmldom","jszip"],Y):typeof exports=="object"?exports.ePub=Y(require("xmldom"),function(){try{return require("jszip")}catch(J){}}()):Z.ePub=Y(Z.xmldom,Z.jszip)})(this,function(Z,Y){var J=String.prototype,G=Math.ceil,H=Math.round,$=Math.max,K=Math.floor;return function(N){function b(k){if(w[k])return w[k].exports;var T=w[k]={i:k,l:!1,exports:{}};return N[k].call(T.exports,T,T.exports,b),T.l=!0,T.exports}var w={};return b.m=N,b.c=w,b.d=function(k,T,x){b.o(k,T)||Object.defineProperty(k,T,{configurable:!1,enumerable:!0,get:x})},b.n=function(k){var T=k&&k.__esModule?function(){return k.default}:function(){return k};return b.d(T,"a",T),T},b.o=function(k,T){return Object.prototype.hasOwnProperty.call(k,T)},b.p="/dist/",b(b.s=25)}([function(N,b,w){"use strict";function k(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function T(){var e=new Date().getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var g=0|(e+16*Math.random())%16;return e=K(e/16),(o=="x"?g:8|7&g).toString(16)});return r}function x(e){return!isNaN(parseFloat(e))&&isFinite(e)}function v(e,r,o,g,m){var E=g||0,C=m||r.length,O=parseInt(E+(C-E)/2),L;return o||(o=function(I,A){return I>A?1:I<A?-1:I==A?0:void 0}),0>=C-E?O:(L=o(r[O],e),C-E==1?0<=L?O:O+1:L===0?O:L===-1?v(e,r,o,O,C):v(e,r,o,E,O))}function y(e,r,o,g,m){var E=g||0,C=m||r.length,O=parseInt(E+(C-E)/2),L;return o||(o=function(I,A){return I>A?1:I<A?-1:I==A?0:void 0}),0>=C-E?-1:(L=o(r[O],e),C-E==1?L===0?O:-1:L===0?O:L===-1?y(e,r,o,O,C):y(e,r,o,E,O))}function d(e,r){for(var o=e.parentNode,g=o.childNodes,m=-1,E=0,C;E<g.length&&(C=g[E],C.nodeType===r&&m++,C!=e);E++);return m}function u(e,r){return new Blob([e],{type:r})}function s(e,r){return typeof e.querySelector=="undefined"?e.getElementsByTagName(r):e.querySelectorAll(r)}function t(e,r,o){for(var g=document.createTreeWalker(e,o,null,!1),m;m=g.nextNode();)r(m)}function i(e,r){if(r(e))return!0;if(e=e.firstChild,e)do{var o=i(e,r);if(o)return!0;e=e.nextSibling}while(e)}function a(e){for(var r=[e];e;e=e.parentNode)r.unshift(e);return r}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function e(r,o){for(var g=0,m;g<o.length;g++)m=o[g],m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(r,m.key,m)}return function(r,o,g){return o&&e(r.prototype,o),g&&e(r,g),r}}();b.uuid=T,b.documentHeight=function(){return $(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},b.isElement=function(e){return!!(e&&e.nodeType==1)},b.isNumber=x,b.isFloat=function(e){var r=parseFloat(e);return r===e&&x(e)&&K(r)!==e},b.prefixed=function(e){var r=["Webkit","webkit","Moz","O","ms"],o=["-webkit-","-webkit-","-moz-","-o-","-ms-"],g=e[0].toUpperCase()+e.slice(1),m=r.length;if(typeof document=="undefined"||typeof document.body.style[e]!="undefined")return e;for(var E=0;E<m;E++)if(typeof document.body.style[r[E]+g]!="undefined")return o[E]+e;return e},b.defaults=function(e){for(var r=1,o=arguments.length,g;r<o;r++)for(var m in g=arguments[r],g)e[m]===void 0&&(e[m]=g[m]);return e},b.extend=function(e){var r=[].slice.call(arguments,1);return r.forEach(function(o){o&&Object.getOwnPropertyNames(o).forEach(function(g){Object.defineProperty(e,g,Object.getOwnPropertyDescriptor(o,g))})}),e},b.insert=function(e,r,o){var g=v(e,r,o);return r.splice(g,0,e),g},b.locationOf=v,b.indexOfSorted=y,b.bounds=function(e){var r=window.getComputedStyle(e),o=0,g=0;return["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach(function(m){o+=parseFloat(r[m])||0}),["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach(function(m){g+=parseFloat(r[m])||0}),{height:g,width:o}},b.borders=function(e){var r=window.getComputedStyle(e),o=0,g=0;return["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach(function(m){o+=parseFloat(r[m])||0}),["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach(function(m){g+=parseFloat(r[m])||0}),{height:g,width:o}},b.windowBounds=function(){var e=window.innerWidth,r=window.innerHeight;return{top:0,left:0,right:e,bottom:r,width:e,height:r}},b.indexOfNode=d,b.indexOfTextNode=function(e){return d(e,l)},b.indexOfElementNode=function(e){return d(e,f)},b.isXml=function(e){return-1<["xml","opf","ncx"].indexOf(e)},b.createBlob=u,b.createBlobUrl=function(e,r){var o=u(e,r),g;return g=p.createObjectURL(o),g},b.revokeBlobUrl=function(e){return p.revokeObjectURL(e)},b.createBase64Url=function(e,r){var o,g;if(typeof e=="string")return o=btoa(encodeURIComponent(e)),g="data:"+r+";base64,"+o,g},b.type=function(e){return Object.prototype.toString.call(e).slice(8,-1)},b.parse=function(e,r,o){var g,m;return m=typeof DOMParser=="undefined"||o?w(16).DOMParser:DOMParser,e.charCodeAt(0)===65279&&(e=e.slice(1)),g=new m().parseFromString(e,r),g},b.qs=function(e,r){var o;if(!e)throw new Error("No Element Provided");return typeof e.querySelector=="undefined"?(o=e.getElementsByTagName(r),o.length?o[0]:void 0):e.querySelector(r)},b.qsa=s,b.qsp=function(e,r,o){var g,m;if(typeof e.querySelector!="undefined"){for(var E in r+="[",o)r+=E+"~='"+o[E]+"'";return r+="]",e.querySelector(r)}return g=e.getElementsByTagName(r),m=Array.prototype.slice.call(g,0).filter(function(C){for(var O in o)if(C.getAttribute(O)===o[O])return!0;return!1}),m?m[0]:void 0},b.sprint=function(e,r){var o=e.ownerDocument||e;typeof o.createTreeWalker=="undefined"?i(e,function(g){g&&g.nodeType===3&&r(g)},!0):t(e,r,NodeFilter.SHOW_TEXT)},b.treeWalker=t,b.walk=i,b.blob2base64=function(e){return new Promise(function(r){var o=new FileReader;o.readAsDataURL(e),o.onloadend=function(){r(o.result)}})},b.defer=function(){var e=this;this.resolve=null,this.reject=null,this.id=T(),this.promise=new Promise(function(r,o){e.resolve=r,e.reject=o}),Object.freeze(this)},b.querySelectorByType=function(e,r,o){var g;if(typeof e.querySelector!="undefined"&&(g=e.querySelector(r+'[*|type="'+o+'"]')),!g||g.length===0){g=s(e,r);for(var m=0;m<g.length;m++)if(g[m].getAttributeNS("http://www.idpf.org/2007/ops","type")===o||g[m].getAttribute("epub:type")===o)return g[m]}else return g},b.findChildren=function(e){for(var r=[],o=e.childNodes,g=0,m;g<o.length;g++)m=o[g],m.nodeType===1&&r.push(m);return r},b.parents=a,b.filterChildren=function(e,r,o){for(var g=[],m=e.childNodes,E=0,C;E<m.length;E++)if(C=m[E],C.nodeType===1&&C.nodeName.toLowerCase()===r){if(o)return C;g.push(C)}if(!o)return g},b.getParentByTagName=function(e,r){var o;if(e!==null&&r!=="")for(o=e.parentNode;o.nodeType===1;){if(o.tagName.toLowerCase()===r)return o;o=o.parentNode}};var c=b.requestAnimationFrame=typeof window!="undefined"&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),f=1,l=3,p=typeof URL=="undefined"?typeof window=="undefined"?void 0:window.URL||window.webkitURL||window.mozURL:URL,n=b.RangeObject=function(){function e(){k(this,e),this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}return h(e,[{key:"setStart",value:function(r,o){this.startContainer=r,this.startOffset=o,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}},{key:"setEnd",value:function(r,o){this.endContainer=r,this.endOffset=o,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}},{key:"collapse",value:function(r){this.collapsed=!0,r?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}},{key:"selectNode",value:function(r){var o=r.parentNode,g=Array.prototype.indexOf.call(o.childNodes,r);this.setStart(o,g),this.setEnd(o,g+1)}},{key:"selectNodeContents",value:function(r){var o=r.childNodes[r.childNodes-1],g=r.nodeType===3?r.textContent.length:parent.childNodes.length;this.setStart(r,0),this.setEnd(r,g)}},{key:"_commonAncestorContainer",value:function(r,o){var g=a(r||this.startContainer),m=a(o||this.endContainer);if(g[0]==m[0]){for(var E=0;E<g.length;E++)if(g[E]!=m[E])return g[E-1]}}},{key:"_checkCollapsed",value:function(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}},{key:"toString",value:function(){}}]),e}()},function(N,b,w){"use strict";function k(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},x=function(){function s(t,i){for(var a=0,h;a<i.length;a++)h=i[a],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}return function(t,i,a){return i&&s(t.prototype,i),a&&s(t,a),t}}(),v=w(0),y=1,d=3,u=function(){function s(t,i,a){k(this,s);var h;if(this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof s))return new s(t,i,a);if(typeof i=="string"?this.base=this.parseComponent(i):(typeof i=="undefined"?"undefined":T(i))==="object"&&i.steps&&(this.base=i),h=this.checkType(t),h==="string")return this.str=t,(0,v.extend)(this,this.parse(t));if(h==="range")return(0,v.extend)(this,this.fromRange(t,this.base,a));if(h==="node")return(0,v.extend)(this,this.fromNode(t,this.base,a));if(h==="EpubCFI"&&t.path)return t;if(!t)return this;throw new TypeError("not a valid argument for EpubCFI")}return x(s,[{key:"checkType",value:function(t){return this.isCfiString(t)?"string":(typeof t=="undefined"?"undefined":T(t))==="object"&&((0,v.type)(t)==="Range"||typeof t.startContainer!="undefined")?"range":(typeof t=="undefined"?"undefined":T(t))==="object"&&typeof t.nodeType!="undefined"?"node":(typeof t=="undefined"?"undefined":T(t))==="object"&&t instanceof s&&"EpubCFI"}},{key:"parse",value:function(t){var i={spinePos:-1,range:!1,base:{},path:{},start:null,end:null},a,h,c;return typeof t=="string"?(t.indexOf("epubcfi(")===0&&t[t.length-1]===")"&&(t=t.slice(8,t.length-1)),a=this.getChapterComponent(t),a?(i.base=this.parseComponent(a),h=this.getPathComponent(t),i.path=this.parseComponent(h),c=this.getRange(t),c&&(i.range=!0,i.start=this.parseComponent(c[0]),i.end=this.parseComponent(c[1])),i.spinePos=i.base.steps[1].index,i):{spinePos:-1}):{spinePos:-1}}},{key:"parseComponent",value:function(t){var i={steps:[],terminal:{offset:null,assertion:null}},a=t.split(":"),h=a[0].split("/"),c;return 1<a.length&&(c=a[1],i.terminal=this.parseTerminal(c)),h[0]===""&&h.shift(),i.steps=h.map(function(f){return this.parseStep(f)}.bind(this)),i}},{key:"parseStep",value:function(t){var i,a,h,c,f;if(c=t.match(/\[(.*)\]/),c&&c[1]&&(f=c[1]),a=parseInt(t),!isNaN(a))return a%2==0?(i="element",h=a/2-1):(i="text",h=(a-1)/2),{type:i,index:h,id:f||null}}},{key:"parseTerminal",value:function(t){var i=t.match(/\[(.*)\]/),a,h;return i&&i[1]?(a=parseInt(t.split("[")[0]),h=i[1]):a=parseInt(t),(0,v.isNumber)(a)||(a=null),{offset:a,assertion:h}}},{key:"getChapterComponent",value:function(t){var i=t.split("!");return i[0]}},{key:"getPathComponent",value:function(t){var i=t.split("!");if(i[1]){var a=i[1].split(",");return a[0]}}},{key:"getRange",value:function(t){var i=t.split(",");return i.length===3&&[i[1],i[2]]}},{key:"getCharecterOffsetComponent",value:function(t){var i=t.split(":");return i[1]||""}},{key:"joinSteps",value:function(t){return t?t.map(function(i){var a="";return i.type==="element"&&(a+=2*(i.index+1)),i.type==="text"&&(a+=1+2*i.index),i.id&&(a+="["+i.id+"]"),a}).join("/"):""}},{key:"segmentString",value:function(t){var i="/";return i+=this.joinSteps(t.steps),t.terminal&&t.terminal.offset!=null&&(i+=":"+t.terminal.offset),t.terminal&&t.terminal.assertion!=null&&(i+="["+t.terminal.assertion+"]"),i}},{key:"toString",value:function(){var t="epubcfi(";return t+=this.segmentString(this.base),t+="!",t+=this.segmentString(this.path),this.range&&this.start&&(t+=",",t+=this.segmentString(this.start)),this.range&&this.end&&(t+=",",t+=this.segmentString(this.end)),t+=")",t}},{key:"compare",value:function(t,i){var a,h,c,f,l,l;if(typeof t=="string"&&(t=new s(t)),typeof i=="string"&&(i=new s(i)),t.spinePos>i.spinePos)return 1;if(t.spinePos<i.spinePos)return-1;t.range?(a=t.path.steps.concat(t.start.steps),c=t.start.terminal):(a=t.path.steps,c=t.path.terminal),i.range?(h=i.path.steps.concat(i.start.steps),f=i.start.terminal):(h=i.path.steps,f=i.path.terminal);for(var p=0;p<a.length;p++){if(!a[p])return-1;if(!h[p]||a[p].index>h[p].index)return 1;if(a[p].index<h[p].index)return-1}return a.length<h.length||c.offset>f.offset?1:c.offset<f.offset?-1:0}},{key:"step",value:function(t){var i=t.nodeType===d?"text":"element";return{id:t.id,tagName:t.tagName,type:i,index:this.position(t)}}},{key:"filteredStep",value:function(t,i){var a=this.filter(t,i),h;if(a)return h=a.nodeType===d?"text":"element",{id:a.id,tagName:a.tagName,type:h,index:this.filteredPosition(a,i)}}},{key:"pathTo",value:function(t,i,a){for(var h={steps:[],terminal:{offset:null,assertion:null}},c=t,f;c&&c.parentNode&&c.parentNode.nodeType!=9;)f=a?this.filteredStep(c,a):this.step(c),f&&h.steps.unshift(f),c=c.parentNode;return i!=null&&0<=i&&(h.terminal.offset=i,h.steps[h.steps.length-1].type!="text"&&h.steps.push({type:"text",index:0})),h}},{key:"equalStep",value:function(t,i){return t&&i&&t.index===i.index&&t.id===i.id&&t.type===i.type}},{key:"fromRange",value:function(t,i,a){var h={range:!1,base:{},path:{},start:null,end:null},c=t.startContainer,f=t.endContainer,l=t.startOffset,p=t.endOffset,n=!1;if(a&&(n=c.ownerDocument.querySelector("."+a)!=null),typeof i=="string"?(h.base=this.parseComponent(i),h.spinePos=h.base.steps[1].index):(typeof i=="undefined"?"undefined":T(i))==="object"&&(h.base=i),t.collapsed)n&&(l=this.patchOffset(c,l,a)),h.path=this.pathTo(c,l,a);else{h.range=!0,n&&(l=this.patchOffset(c,l,a)),h.start=this.pathTo(c,l,a),n&&(p=this.patchOffset(f,p,a)),h.end=this.pathTo(f,p,a),h.path={steps:[],terminal:null};var e=h.start.steps.length,r;for(r=0;r<e&&this.equalStep(h.start.steps[r],h.end.steps[r]);r++)r===e-1?h.start.terminal===h.end.terminal&&(h.path.steps.push(h.start.steps[r]),h.range=!1):h.path.steps.push(h.start.steps[r]);h.start.steps=h.start.steps.slice(h.path.steps.length),h.end.steps=h.end.steps.slice(h.path.steps.length)}return h}},{key:"fromNode",value:function(t,i,a){var h={range:!1,base:{},path:{},start:null,end:null};return typeof i=="string"?(h.base=this.parseComponent(i),h.spinePos=h.base.steps[1].index):(typeof i=="undefined"?"undefined":T(i))==="object"&&(h.base=i),h.path=this.pathTo(t,null,a),h}},{key:"filter",value:function(t,i){var a=!1,h,c,f,l,p;return t.nodeType===d?(a=!0,f=t.parentNode,h=t.parentNode.classList.contains(i)):(a=!1,h=t.classList.contains(i)),h&&a?(l=f.previousSibling,p=f.nextSibling,l&&l.nodeType===d?c=l:p&&p.nodeType===d&&(c=p),c||t):h&&!a?!1:t}},{key:"patchOffset",value:function(t,i,a){if(t.nodeType!=d)throw new Error("Anchor must be a text node");var h=t,c=i;for(t.parentNode.classList.contains(a)&&(h=t.parentNode);h.previousSibling;){if(h.previousSibling.nodeType!==y)c+=h.previousSibling.textContent.length;else if(h.previousSibling.classList.contains(a))c+=h.previousSibling.textContent.length;else break;h=h.previousSibling}return c}},{key:"normalizedMap",value:function(t,i,a){var h={},c=-1,f=t.length,l,p,n;for(l=0;l<f;l++)p=t[l].nodeType,p===y&&t[l].classList.contains(a)&&(p=d),0<l&&p===d&&n===d?h[l]=c:i===p&&(++c,h[l]=c),n=p;return h}},{key:"position",value:function(t){var i,a;return t.nodeType===y?(i=t.parentNode.children,!i&&(i=(0,v.findChildren)(t.parentNode)),a=Array.prototype.indexOf.call(i,t)):(i=this.textNodes(t.parentNode),a=i.indexOf(t)),a}},{key:"filteredPosition",value:function(t,i){var a,h,c;return t.nodeType===y?(a=t.parentNode.children,c=this.normalizedMap(a,y,i)):(a=t.parentNode.childNodes,t.parentNode.classList.contains(i)&&(t=t.parentNode,a=t.parentNode.childNodes),c=this.normalizedMap(a,d,i)),h=Array.prototype.indexOf.call(a,t),c[h]}},{key:"stepsToXpath",value:function(t){var i=[".","*"];return t.forEach(function(a){var h=a.index+1;a.id?i.push("*[position()="+h+" and @id='"+a.id+"']"):a.type==="text"?i.push("text()["+h+"]"):i.push("*["+h+"]")}),i.join("/")}},{key:"stepsToQuerySelector",value:function(t){var i=["html"];return t.forEach(function(a){var h=a.index+1;a.id?i.push("#"+a.id):a.type==="text"||i.push("*:nth-child("+h+")")}),i.join(">")}},{key:"textNodes",value:function(t,i){return Array.prototype.slice.call(t.childNodes).filter(function(a){return a.nodeType===d||i&&a.classList.contains(i)})}},{key:"walkToNode",value:function(t,i,a){var h=i||document,c=h.documentElement,f=t.length,l,p,n;for(n=0;n<f&&(p=t[n],p.type==="element"?p.id?c=h.getElementById(p.id):(l=c.children||(0,v.findChildren)(c),c=l[p.index]):p.type==="text"&&(c=this.textNodes(c,a)[p.index]),!!c);n++);return c}},{key:"findNode",value:function(t,i,a){var h=i||document,c,f;return a||typeof h.evaluate=="undefined"?a?c=this.walkToNode(t,h,a):c=this.walkToNode(t,h):(f=this.stepsToXpath(t),c=h.evaluate(f,h,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),c}},{key:"fixMiss",value:function(t,i,a,h){var c=this.findNode(t.slice(0,-1),a,h),f=c.childNodes,l=this.normalizedMap(f,d,h),p=t[t.length-1].index,n,e;for(var r in l){if(!l.hasOwnProperty(r))return;if(l[r]===p)if(n=f[r],e=n.textContent.length,i>e)i-=e;else{c=n.nodeType===y?n.childNodes[0]:n;break}}return{container:c,offset:i}}},{key:"toRange",value:function(t,i){var a=t||document,h=this,c=!!i&&a.querySelector("."+i)!=null,f,l,p,n,e,r,o,g;if(f=typeof a.createRange=="undefined"?new v.RangeObject:a.createRange(),h.range?(l=h.start,r=h.path.steps.concat(l.steps),n=this.findNode(r,a,c?i:null),p=h.end,o=h.path.steps.concat(p.steps),e=this.findNode(o,a,c?i:null)):(l=h.path,r=h.path.steps,n=this.findNode(h.path.steps,a,c?i:null)),n)try{l.terminal.offset==null?f.setStart(n,0):f.setStart(n,l.terminal.offset)}catch(m){g=this.fixMiss(r,l.terminal.offset,a,c?i:null),f.setStart(g.container,g.offset)}else return console.log("No startContainer found for",this.toString()),null;if(e)try{p.terminal.offset==null?f.setEnd(e,0):f.setEnd(e,p.terminal.offset)}catch(m){g=this.fixMiss(o,h.end.terminal.offset,a,c?i:null),f.setEnd(g.container,g.offset)}return f}},{key:"isCfiString",value:function(t){return typeof t=="string"&&t.indexOf("epubcfi(")===0&&t[t.length-1]===")"}},{key:"generateChapterComponent",value:function(t,i,a){var h=parseInt(i),c="/"+2*(t+1)+"/";return c+=2*(h+1),a&&(c+="["+a+"]"),c}},{key:"collapse",value:function(t){this.range&&(this.range=!1,t?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}]),s}();b.default=u,N.exports=b.default},function(N,b,w){"use strict";var k=w(27),T=w(41),x=Function.prototype.apply,v=Function.prototype.call,y=Object.create,d=Object.defineProperty,u=Object.defineProperties,s=Object.prototype.hasOwnProperty,t={configurable:!0,enumerable:!1,writable:!0},i,a,h,c,f,l,p;i=function(n,e){var r;return T(e),s.call(this,"__ee__")?r=this.__ee__:(r=t.value=y(null),d(this,"__ee__",t),t.value=null),r[n]?typeof r[n]=="object"?r[n].push(e):r[n]=[r[n],e]:r[n]=e,this},a=function(n,e){var r,o;return T(e),o=this,i.call(this,n,r=function(){h.call(o,n,r),x.call(e,this,arguments)}),r.__eeOnceListener__=e,this},h=function(n,e){var r,o,g,m;if(T(e),!s.call(this,"__ee__"))return this;if(r=this.__ee__,!r[n])return this;if(o=r[n],typeof o=="object")for(m=0;g=o[m];++m)(g===e||g.__eeOnceListener__===e)&&(o.length===2?r[n]=o[m?0:1]:o.splice(m,1));else(o===e||o.__eeOnceListener__===e)&&delete r[n];return this},c=function(n){var e,r,o,g,m;if(s.call(this,"__ee__")&&(g=this.__ee__[n],!!g))if(typeof g=="object"){for(r=arguments.length,m=Array(r-1),e=1;e<r;++e)m[e-1]=arguments[e];for(g=g.slice(),e=0;o=g[e];++e)x.call(o,this,m)}else switch(arguments.length){case 1:v.call(g,this);break;case 2:v.call(g,this,arguments[1]);break;case 3:v.call(g,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,m=Array(r-1),e=1;e<r;++e)m[e-1]=arguments[e];x.call(g,this,m)}},f={on:i,once:a,off:h,emit:c},l={on:k(i),once:k(a),off:k(h),emit:k(c)},p=u({},l),N.exports=b=function(n){return n==null?y(p):u(Object(n),l)},b.methods=f},function(N,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var w=b.DOM_EVENTS=["keydown","keyup","keypressed","mouseup","mousedown","click","touchend","touchstart"],k=b.EVENTS={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled"},VIEWS:{AXIS:"axis",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"}}},function(N,b,w){"use strict";function k(d,u){if(!(d instanceof u))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function d(u,s){for(var t=0,i;t<s.length;t++)i=s[t],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(u,i.key,i)}return function(u,s,t){return s&&d(u.prototype,s),t&&d(u,t),u}}(),x=w(6),v=function(d){return d&&d.__esModule?d:{default:d}}(x),y=function(){function d(u){k(this,d);var s,t;s=u.indexOf("://"),-1<s&&(u=new URL(u).pathname),t=this.parse(u),this.path=u,this.directory=this.isDirectory(u)?u:t.dir+"/",this.filename=t.base,this.extension=t.ext.slice(1)}return T(d,[{key:"parse",value:function(u){return v.default.parse(u)}},{key:"isAbsolute",value:function(u){return v.default.isAbsolute(u||this.path)}},{key:"isDirectory",value:function(u){return u.charAt(u.length-1)==="/"}},{key:"resolve",value:function(u){return v.default.resolve(this.directory,u)}},{key:"relative",value:function(u){return v.default.relative(this.directory,u)}},{key:"splitPath",value:function(u){return this.splitPathRe.exec(u).slice(1)}},{key:"toString",value:function(){return this.path}}]),d}();b.default=y,N.exports=b.default},function(N,b,w){"use strict";function k(t){return t&&t.__esModule?t:{default:t}}function T(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function t(i,a){for(var h=0,c;h<a.length;h++)c=a[h],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(i,c.key,c)}return function(i,a,h){return a&&t(i.prototype,a),h&&t(i,h),i}}(),v=w(4),y=k(v),d=w(6),u=k(d),s=function(){function t(i,a){T(this,t);var h=-1<i.indexOf("://"),c=i,f;if(this.Url=void 0,this.href=i,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=a,!h&&a!==!1&&typeof a!="string"&&window&&window.location&&(this.base=window.location.href),h||this.base)try{this.Url=this.base?new URL(i,this.base):new URL(i),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,c=this.Url.pathname}catch(l){this.Url=void 0,this.base&&(f=new y.default(this.base),c=f.resolve(c))}this.Path=new y.default(c),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return x(t,[{key:"path",value:function(){return this.Path}},{key:"resolve",value:function(i){var a=-1<i.indexOf("://"),h;return a?i:(h=u.default.resolve(this.directory,i),this.origin+h)}},{key:"relative",value:function(i){return u.default.relative(i,this.directory)}},{key:"toString",value:function(){return this.href}}]),t}();b.default=s,N.exports=b.default},function(N){"use strict";function b(v){if(typeof v!="string")throw new TypeError("Path must be a string. Received "+v)}function w(v,y){for(var d="",u=-1,s=0,t=0,i;t<=v.length;++t){if(t<v.length)i=v.charCodeAt(t);else{if(i===47)break;i=47}if(i===47){if(!(u==t-1||s==1))if(u!=t-1&&s==2){if(2>d.length||d.charCodeAt(d.length-1)!==46||d.charCodeAt(d.length-2)!==46){if(2<d.length){for(var a=d.length-1,h=a;0<=h&&d.charCodeAt(h)!==47;--h);if(h!=a){d=h==-1?"":d.slice(0,h),u=t,s=0;continue}}else if(d.length===2||d.length===1){d="",u=t,s=0;continue}}y&&(0<d.length?d+="/..":d="..")}else 0<d.length?d+="/"+v.slice(u+1,t):d=v.slice(u+1,t);u=t,s=0}else i===46&&s!=-1?++s:s=-1}return d}function k(v,y){var d=y.dir||y.root,u=y.base||(y.name||"")+(y.ext||"");return d?d===y.root?d+u:d+v+u:u}if(!T)var T={cwd:function(){return"/"}};var x={resolve:function(){for(var v="",y=!1,d=arguments.length-1,u;-1<=d&&!y;d--){var s;0<=d?s=arguments[d]:(u==null&&(u=T.cwd()),s=u),b(s),s.length!==0&&(v=s+"/"+v,y=s.charCodeAt(0)===47)}return v=w(v,!y),y?0<v.length?"/"+v:"/":0<v.length?v:"."},normalize:function(v){if(b(v),v.length===0)return".";var y=v.charCodeAt(0)===47,d=v.charCodeAt(v.length-1)===47;return v=w(v,!y),v.length!==0||y||(v="."),0<v.length&&d&&(v+="/"),y?"/"+v:v},isAbsolute:function(v){return b(v),0<v.length&&v.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var v=0,y,d;v<arguments.length;++v)d=arguments[v],b(d),0<d.length&&(y==null?y=d:y+="/"+d);return y===void 0?".":x.normalize(y)},relative:function(v,y){if(b(v),b(y),v===y||(v=x.resolve(v),y=x.resolve(y),v===y))return"";for(var d=1;d<v.length&&v.charCodeAt(d)===47;++d);for(var u=v.length,s=u-d,t=1;t<y.length&&y.charCodeAt(t)===47;++t);for(var i=y.length,a=i-t,h=s<a?s:a,c=-1,f=0;f<=h;++f){if(f==h){if(a>h){if(y.charCodeAt(t+f)===47)return y.slice(t+f+1);if(f==0)return y.slice(t+f)}else s>h&&(v.charCodeAt(d+f)===47?c=f:f==0&&(c=0));break}var l=v.charCodeAt(d+f),p=y.charCodeAt(t+f);if(l!==p)break;l===47&&(c=f)}var n="";for(f=d+c+1;f<=u;++f)(f===u||v.charCodeAt(f)===47)&&(n+=n.length===0?"..":"/..");return 0<n.length?n+y.slice(t+c):(t+=c,y.charCodeAt(t)===47&&++t,y.slice(t))},_makeLong:function(v){return v},dirname:function(v){if(b(v),v.length===0)return".";for(var y=v.charCodeAt(0),d=y===47,u=-1,s=!0,t=v.length-1;1<=t;--t)if(y=v.charCodeAt(t),y!==47)s=!1;else if(!s){u=t;break}return u===-1?d?"/":".":d&&u===1?"//":v.slice(0,u)},basename:function(v,y){if(y!==void 0&&typeof y!="string")throw new TypeError('"ext" argument must be a string');b(v);var d=0,u=-1,s=!0,t;if(y!==void 0&&0<y.length&&y.length<=v.length){if(y.length===v.length&&y===v)return"";var i=y.length-1,a=-1;for(t=v.length-1;0<=t;--t){var h=v.charCodeAt(t);if(h!==47)a==-1&&(s=!1,a=t+1),0<=i&&(h===y.charCodeAt(i)?--i==-1&&(u=t):(i=-1,u=a));else if(!s){d=t+1;break}}return d===u?u=a:u===-1&&(u=v.length),v.slice(d,u)}for(t=v.length-1;0<=t;--t)if(v.charCodeAt(t)!==47)u==-1&&(s=!1,u=t+1);else if(!s){d=t+1;break}return u===-1?"":v.slice(d,u)},extname:function(v){b(v);for(var y=-1,d=0,u=-1,s=!0,t=0,i=v.length-1,a;0<=i;--i){if(a=v.charCodeAt(i),a===47){if(!s){d=i+1;break}continue}u==-1&&(s=!1,u=i+1),a===46?y==-1?y=i:t!=1&&(t=1):y!==-1&&(t=-1)}return y===-1||u===-1||t==0||t==1&&y===u-1&&y===d+1?"":v.slice(y,u)},format:function(v){if(v===null||typeof v!="object")throw new TypeError('Parameter "pathObject" must be an object, not '+typeof v);return k("/",v)},parse:function(v){b(v);var y={root:"",dir:"",base:"",ext:"",name:""};if(v.length===0)return y;var d=v.charCodeAt(0),u=d===47,s;u?(y.root="/",s=1):s=0;for(var t=-1,i=0,a=-1,h=!0,c=v.length-1,f=0;c>=s;--c){if(d=v.charCodeAt(c),d===47){if(!h){i=c+1;break}continue}a==-1&&(h=!1,a=c+1),d===46?t==-1?t=c:f!=1&&(f=1):t!=-1&&(f=-1)}return t==-1||a==-1||f==0||f==1&&t==a-1&&t==i+1?a!=-1&&(i==0&&u?y.base=y.name=v.slice(1,a):y.base=y.name=v.slice(i,a)):(i==0&&u?(y.name=v.slice(1,t),y.base=v.slice(1,a)):(y.name=v.slice(i,t),y.base=v.slice(i,a)),y.ext=v.slice(t,a)),0<i?y.dir=v.slice(0,i-1):u&&(y.dir="/"),y},sep:"/",delimiter:":",posix:null};N.exports=x},function(N,b,w){"use strict";function k(u){return u&&u.__esModule?u:{default:u}}Object.defineProperty(b,"__esModule",{value:!0}),b.replaceBase=function(u,s){var t=s.url,i=-1<t.indexOf("://"),a,h;u&&(h=(0,T.qs)(u,"head"),a=(0,T.qs)(h,"base"),!a&&(a=u.createElement("base"),h.insertBefore(a,h.firstChild)),!i&&window&&window.location&&(t=window.location.origin+t),a.setAttribute("href",t))},b.replaceCanonical=function(u,s){var t=s.canonical,i,a;u&&(i=(0,T.qs)(u,"head"),a=(0,T.qs)(i,"link[rel='canonical']"),a?a.setAttribute("href",t):(a=u.createElement("link"),a.setAttribute("rel","canonical"),a.setAttribute("href",t),i.appendChild(a)))},b.replaceMeta=function(u,s){var t=s.idref,i,a;u&&(i=(0,T.qs)(u,"head"),a=(0,T.qs)(i,"link[property='dc.identifier']"),a?a.setAttribute("content",t):(a=u.createElement("meta"),a.setAttribute("name","dc.identifier"),a.setAttribute("content",t),i.appendChild(a)))},b.replaceLinks=function(u,s){var t=u.querySelectorAll("a[href]");if(t.length)for(var i=(0,T.qs)(u.ownerDocument,"base"),a=i?i.getAttribute("href"):void 0,h=function(f){var l=f.getAttribute("href");if(l.indexOf("mailto:")!==0){var p=-1<l.indexOf("://"),n=new v.default(l,a);p?f.setAttribute("target","_blank"):f.onclick=function(){return n&&n.hash?s(n.Path.path+n.hash):s(n?n.Path.path:l),!1}}}.bind(this),c=0;c<t.length;c++)h(t[c])},b.substitute=function(u,s,t){return s.forEach(function(i,a){i&&t[a]&&(u=u.replace(new RegExp(i,"g"),t[a]))}),u};var T=w(0),x=w(5),v=k(x),y=w(4),d=k(y)},function(N){var b=function(){return this}();try{b=b||Function("return this")()||(0,eval)("this")}catch(w){typeof window=="object"&&(b=window)}N.exports=b},function(N,b,w){"use strict";var k=w(34)();N.exports=function(T){return T!==k&&T!==null}},function(N,b){"use strict";function w(x,v){if(!(x instanceof v))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var k=function(){function x(v,y){for(var d=0,u;d<y.length;d++)u=y[d],u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(v,u.key,u)}return function(v,y,d){return y&&x(v.prototype,y),d&&x(v,d),v}}(),T=function(){function x(v){w(this,x),this.context=v||this,this.hooks=[]}return k(x,[{key:"register",value:function(){for(var v=0;v<arguments.length;++v)if(typeof arguments[v]=="function")this.hooks.push(arguments[v]);else for(var y=0;y<arguments[v].length;++y)this.hooks.push(arguments[v][y])}},{key:"trigger",value:function(){var v=arguments,y=this.context,d=[];return this.hooks.forEach(function(u){var s=u.apply(y,v);s&&typeof s.then=="function"&&d.push(s)}),Promise.all(d)}},{key:"list",value:function(){return this.hooks}},{key:"clear",value:function(){return this.hooks=[]}}]),x}();b.default=T,N.exports=b.default},function(N,b,w){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var k=w(0),T=w(4),x=function(v){return v&&v.__esModule?v:{default:v}}(T);b.default=function(v,y,d,u){function s(p){h.reject(p)}function t(){if(this.readyState===XMLHttpRequest.DONE){var p=!1;if((this.responseType===""||this.responseType==="document")&&(p=this.responseXML),this.status===200||p){var n;if(!this.response&&!p)return h.reject({status:this.status,message:"Empty Response",stack:new Error().stack}),h.promise;if(this.status===403)return h.reject({status:this.status,response:this.response,message:"Forbidden",stack:new Error().stack}),h.promise;n=p?this.responseXML:(0,k.isXml)(y)?(0,k.parse)(this.response,"text/xml"):y=="xhtml"?(0,k.parse)(this.response,"application/xhtml+xml"):y=="html"||y=="htm"?(0,k.parse)(this.response,"text/html"):y=="json"?JSON.parse(this.response):y=="blob"?i?this.response:new Blob([this.response]):this.response,h.resolve(n)}else h.reject({status:this.status,message:this.response,stack:new Error().stack})}}var i=typeof window!="undefined"&&window.URL,a=i?"blob":"arraybuffer",h=new k.defer,c=new XMLHttpRequest,f=XMLHttpRequest.prototype,l;for(l in"overrideMimeType"in f||Object.defineProperty(f,"overrideMimeType",{value:function(){}}),d&&(c.withCredentials=!0),c.onreadystatechange=t,c.onerror=s,c.open("GET",v,!0),u)c.setRequestHeader(l,u[l]);return y=="json"&&c.setRequestHeader("Accept","application/json"),y||(y=new x.default(v).extension),y=="blob"&&(c.responseType=a),(0,k.isXml)(y)&&c.overrideMimeType("text/xml"),y=="xhtml",y!="html"&&y!="htm",y=="binary"&&(c.responseType="arraybuffer"),c.send(),h.promise},N.exports=b.default},function(N,b,w){"use strict";function k(y,d){if(!(y instanceof d))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.Task=void 0;var T=function(){function y(d,u){for(var s=0,t;s<u.length;s++)t=u[s],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}return function(d,u,s){return u&&y(d.prototype,u),s&&y(d,s),d}}(),x=w(0),v=function(){function y(d){k(this,y),this._q=[],this.context=d,this.tick=x.requestAnimationFrame,this.running=!1,this.paused=!1}return T(y,[{key:"enqueue",value:function(){var d=[].shift.call(arguments),u=arguments,s,t,i;if(!d)throw new Error("No Task Provided");return typeof d=="function"?(s=new x.defer,t=s.promise,i={task:d,args:u,deferred:s,promise:t}):i={promise:d},this._q.push(i),this.paused!=!1||this.running||this.run(),i.promise}},{key:"dequeue",value:function(){var d,u,s;if(this._q.length&&!this.paused){if(d=this._q.shift(),u=d.task,u)return s=u.apply(this.context,d.args),s&&typeof s.then=="function"?s.then(function(){d.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){d.deferred.reject.apply(this.context,arguments)}.bind(this)):(d.deferred.resolve.apply(this.context,s),d.promise);if(d.promise)return d.promise}else return d=new x.defer,d.deferred.resolve(),d.promise}},{key:"dump",value:function(){for(;this._q.length;)this.dequeue()}},{key:"run",value:function(){var d=this;return this.running||(this.running=!0,this.defered=new x.defer),this.tick.call(window,function(){d._q.length?d.dequeue().then(function(){this.run()}.bind(d)):(d.defered.resolve(),d.running=void 0)}),this.paused==!0&&(this.paused=!1),this.defered.promise}},{key:"flush",value:function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}},{key:"clear",value:function(){this._q=[]}},{key:"length",value:function(){return this._q.length}},{key:"pause",value:function(){this.paused=!0}},{key:"stop",value:function(){this._q=[],this.running=!1,this.paused=!0}}]),y}();b.default=v,b.Task=function y(d,u,s){return k(this,y),function(){var t=this,i=arguments||[];return new Promise(function(a,h){i.push(function(c,f){!c&&f?h(f):a(c)}),d.apply(s||t,i)})}}},function(N,b,w){"use strict";function k(p){return p&&p.__esModule?p:{default:p}}function T(p,n){if(!(p instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function p(n,e){for(var r=0,o;r<e.length;r++)o=e[r],o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}return function(n,e,r){return e&&p(n.prototype,e),r&&p(n,r),n}}(),v=w(2),y=k(v),d=w(0),u=w(1),s=k(u),t=w(19),i=k(t),a=w(7),h=w(3),c=/Chrome/.test(navigator.userAgent),f=!c&&/AppleWebKit/.test(navigator.userAgent),l=function(){function p(n,e,r,o){T(this,p),this.epubcfi=new s.default,this.document=n,this.documentElement=this.document.documentElement,this.content=e||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=o||0,this.cfiBase=r||"",this.epubReadingSystem("epub.js",ePub.VERSION),this.listeners()}return x(p,[{key:"width",value:function(n){var e=this.content;return n&&(0,d.isNumber)(n)&&(n+="px"),n&&(e.style.width=n),this.window.getComputedStyle(e).width}},{key:"height",value:function(n){var e=this.content;return n&&(0,d.isNumber)(n)&&(n+="px"),n&&(e.style.height=n),this.window.getComputedStyle(e).height}},{key:"contentWidth",value:function(n){var e=this.content||this.document.body;return n&&(0,d.isNumber)(n)&&(n+="px"),n&&(e.style.width=n),this.window.getComputedStyle(e).width}},{key:"contentHeight",value:function(n){var e=this.content||this.document.body;return n&&(0,d.isNumber)(n)&&(n+="px"),n&&(e.style.height=n),this.window.getComputedStyle(e).height}},{key:"textWidth",value:function(){var n=this.document.createRange(),e=this.content||this.document.body,r=(0,d.borders)(e),o;return n.selectNodeContents(e),o=n.getBoundingClientRect().width,r&&r.width&&(o+=r.width),H(o)}},{key:"textHeight",value:function(){var n=this.document.createRange(),e=this.content||this.document.body,r=(0,d.borders)(e),o;return n.selectNodeContents(e),o=n.getBoundingClientRect().height,o&&r.height&&(o+=r.height),H(o)}},{key:"scrollWidth",value:function(){var n=this.documentElement.scrollWidth;return n}},{key:"scrollHeight",value:function(){var n=this.documentElement.scrollHeight;return n}},{key:"overflow",value:function(n){return n&&(this.documentElement.style.overflow=n),this.window.getComputedStyle(this.documentElement).overflow}},{key:"overflowX",value:function(n){return n&&(this.documentElement.style.overflowX=n),this.window.getComputedStyle(this.documentElement).overflowX}},{key:"overflowY",value:function(n){return n&&(this.documentElement.style.overflowY=n),this.window.getComputedStyle(this.documentElement).overflowY}},{key:"css",value:function(n,e,r){var o=this.content||this.document.body;return e&&o.style.setProperty(n,e,r?"important":""),this.window.getComputedStyle(o)[n]}},{key:"viewport",value:function(n){var e=this.document.querySelector("meta[name='viewport']"),r={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},o=[],g={};if(e&&e.hasAttribute("content")){var m=e.getAttribute("content"),E=m.match(/width\s*=\s*([^,]*)/),C=m.match(/height\s*=\s*([^,]*)/),O=m.match(/initial-scale\s*=\s*([^,]*)/),L=m.match(/minimum-scale\s*=\s*([^,]*)/),I=m.match(/maximum-scale\s*=\s*([^,]*)/),A=m.match(/user-scalable\s*=\s*([^,]*)/);E&&E.length&&typeof E[1]!="undefined"&&(r.width=E[1]),C&&C.length&&typeof C[1]!="undefined"&&(r.height=C[1]),O&&O.length&&typeof O[1]!="undefined"&&(r.scale=O[1]),L&&L.length&&typeof L[1]!="undefined"&&(r.minimum=L[1]),I&&I.length&&typeof I[1]!="undefined"&&(r.maximum=I[1]),A&&A.length&&typeof A[1]!="undefined"&&(r.scalable=A[1])}return g=(0,d.defaults)(n||{},r),n&&(g.width&&o.push("width="+g.width),g.height&&o.push("height="+g.height),g.scale&&o.push("initial-scale="+g.scale),g.scalable==="no"?(o.push("minimum-scale="+g.scale),o.push("maximum-scale="+g.scale),o.push("user-scalable="+g.scalable)):(g.scalable&&o.push("user-scalable="+g.scalable),g.minimum&&o.push("minimum-scale="+g.minimum),g.maximum&&o.push("minimum-scale="+g.maximum)),!e&&(e=this.document.createElement("meta"),e.setAttribute("name","viewport"),this.document.querySelector("head").appendChild(e)),e.setAttribute("content",o.join(", ")),this.window.scrollTo(0,0)),g}},{key:"expand",value:function(){this.emit(h.EVENTS.CONTENTS.EXPAND)}},{key:"listeners",value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}},{key:"removeListeners",value:function(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}},{key:"resizeCheck",value:function(){var n=this.textWidth(),e=this.textHeight();(n!=this._size.width||e!=this._size.height)&&(this._size={width:n,height:e},this.onResize&&this.onResize(this._size),this.emit(h.EVENTS.CONTENTS.RESIZE,this._size))}},{key:"resizeListeners",value:function(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:"transitionListeners",value:function(){var n=this.content;n.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",n.style.transitionDuration="0.001ms",n.style.transitionTimingFunction="linear",n.style.transitionDelay="0",this.document.addEventListener("transitionend",this.resizeCheck.bind(this))}},{key:"mediaQueryListeners",value:function(){for(var n=this.document.styleSheets,e=function(E){E.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),r=0;r<n.length;r+=1){var o;try{o=n[r].cssRules}catch(E){return}if(!o)return;for(var g=0;g<o.length;g+=1)if(o[g].media){var m=this.window.matchMedia(o[g].media.mediaText);m.addListener(e)}}}},{key:"resizeObservers",value:function(){var n=this;this.observer=new MutationObserver(function(){n.resizeCheck()}),this.observer.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}},{key:"imageLoadListeners",value:function(){for(var n=this.document.querySelectorAll("img"),e=0,r;e<n.length;e++)r=n[e],typeof r.naturalWidth!="undefined"&&r.naturalWidth===0&&(r.onload=this.expand.bind(this))}},{key:"fontLoadListeners",value:function(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.resizeCheck()}.bind(this))}},{key:"root",value:function(){return this.document?this.document.documentElement:null}},{key:"locationOf",value:function(n,e){var r={left:0,top:0},o;if(!this.document)return r;if(this.epubcfi.isCfiString(n)){var g=new s.default(n).toRange(this.document,e);if(g)if(g.startContainer.nodeType===Node.ELEMENT_NODE)o=g.startContainer.getBoundingClientRect(),r.left=o.left,r.top=o.top;else if(f){var m=g.startContainer,E=new Range;try{m.nodeType===1?o=m.getBoundingClientRect():g.startOffset+2<m.length?(E.setStart(m,g.startOffset),E.setEnd(m,g.startOffset+2),o=E.getBoundingClientRect()):0<g.startOffset-2?(E.setStart(m,g.startOffset-2),E.setEnd(m,g.startOffset),o=E.getBoundingClientRect()):o=m.parentNode.getBoundingClientRect()}catch(L){console.error(L,L.stack)}}else o=g.getBoundingClientRect()}else if(typeof n=="string"&&-1<n.indexOf("#")){var C=n.substring(n.indexOf("#")+1),O=this.document.getElementById(C);O&&(o=O.getBoundingClientRect())}return o&&(r.left=o.left,r.top=o.top),r}},{key:"addStylesheet",value:function(n){return new Promise(function(e){var r=!1,o;return this.document?(o=this.document.querySelector("link[href='"+n+"']"),o?void e(!0):(o=this.document.createElement("link"),o.type="text/css",o.rel="stylesheet",o.href=n,o.onload=o.onreadystatechange=function(){r||this.readyState&&this.readyState!="complete"||(r=!0,setTimeout(function(){e(!0)},1))},void this.document.head.appendChild(o))):void e(!1)}.bind(this))}},{key:"addStylesheetRules",value:function(n){var e="epubjs-inserted-css",r,o;if(this.document&&n&&n.length!==0)if(r=this.document.getElementById("#"+e),r||(r=this.document.createElement("style"),r.id=e),this.document.head.appendChild(r),o=r.sheet,Object.prototype.toString.call(n)==="[object Array]")for(var g=0,m=n.length;g<m;g++){var E=1,C=n[g],O=n[g][0],L="";Object.prototype.toString.call(C[1][0])==="[object Array]"&&(C=C[1],E=0);for(var I=C.length,A;E<I;E++)A=C[E],L+=A[0]+":"+A[1]+(A[2]?" !important":"")+`;
`;o.insertRule(O+"{"+L+"}",o.cssRules.length)}else{var B=Object.keys(n);B.forEach(function(j){var _=n[j];if(Array.isArray(_))_.forEach(function(S){var F=Object.keys(S),V=F.map(function(W){return W+":"+S[W]}).join(";");o.insertRule(j+"{"+V+"}",o.cssRules.length)});else{var R=Object.keys(_),q=R.map(function(S){return S+":"+_[S]}).join(";");o.insertRule(j+"{"+q+"}",o.cssRules.length)}})}}},{key:"addScript",value:function(n){return new Promise(function(e){var r=!1,o;return this.document?(o=this.document.createElement("script"),o.type="text/javascript",o.async=!0,o.src=n,o.onload=o.onreadystatechange=function(){r||this.readyState&&this.readyState!="complete"||(r=!0,setTimeout(function(){e(!0)},1))},void this.document.head.appendChild(o)):void e(!1)}.bind(this))}},{key:"addClass",value:function(n){var e;this.document&&(e=this.content||this.document.body,e&&e.classList.add(n))}},{key:"removeClass",value:function(n){var e;this.document&&(e=this.content||this.document.body,e&&e.classList.remove(n))}},{key:"addEventListeners",value:function(){this.document&&h.DOM_EVENTS.forEach(function(n){this.document.addEventListener(n,this.triggerEvent.bind(this),!1)},this)}},{key:"removeEventListeners",value:function(){this.document&&h.DOM_EVENTS.forEach(function(n){this.document.removeEventListener(n,this.triggerEvent,!1)},this)}},{key:"triggerEvent",value:function(n){this.emit(n.type,n)}},{key:"addSelectionListeners",value:function(){this.document&&this.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)}},{key:"removeSelectionListeners",value:function(){this.document&&this.document.removeEventListener("selectionchange",this.onSelectionChange,!1)}},{key:"onSelectionChange",value:function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var n=this.window.getSelection();this.triggerSelectedEvent(n)}.bind(this),250)}},{key:"triggerSelectedEvent",value:function(n){var e,r;n&&0<n.rangeCount&&(e=n.getRangeAt(0),!e.collapsed&&(r=new s.default(e,this.cfiBase).toString(),this.emit(h.EVENTS.CONTENTS.SELECTED,r),this.emit(h.EVENTS.CONTENTS.SELECTED_RANGE,e)))}},{key:"range",value:function(n,e){var r=new s.default(n);return r.toRange(this.document,e)}},{key:"cfiFromRange",value:function(n,e){return new s.default(n,this.cfiBase,e).toString()}},{key:"cfiFromNode",value:function(n,e){return new s.default(n,this.cfiBase,e).toString()}},{key:"map",value:function(n){var e=new i.default(n);return e.section()}},{key:"size",value:function(n,e){var r={scale:1,scalable:"no"};this.layoutStyle("scrolling"),0<=n&&(this.width(n),r.width=n,this.css("padding","0 "+n/12+"px",!0)),0<=e&&(this.height(e),r.height=e),this.css("margin","0"),this.css("box-sizing","border-box"),this.viewport(r)}},{key:"columns",value:function(n,e,r,o){var g=(0,d.prefixed)("column-axis"),m=(0,d.prefixed)("column-gap"),E=(0,d.prefixed)("column-width"),C=(0,d.prefixed)("column-fill"),O=this.writingMode(),L=O.indexOf("vertical")===0?"vertical":"horizontal";this.layoutStyle("paginated"),this.content.dir==="rtl"&&this.direction("rtl"),this.width(n),this.height(e),this.viewport({width:n,height:e,scale:1,scalable:"no"}),this.css("overflow-y","hidden"),this.css("margin","0",!0),L=="vertical"?this.css("padding",o/2+"px 20px",!0):this.css("padding","20px "+o/2+"px",!0),this.css("box-sizing","border-box"),this.css("max-width","inherit"),this.css(g,"horizontal"),this.css(C,"auto"),this.css(m,o+"px"),this.css(E,r+"px")}},{key:"scaler",value:function(n,e,r){var o="";this.css("transform-origin","top left"),(0<=e||0<=r)&&(o=" translate("+(e||0)+"px, "+(r||0)+"px )"),this.css("transform","scale("+n+")"+o)}},{key:"fit",value:function(n,e){var r=this.viewport(),o=n/parseInt(r.width),g=e/parseInt(r.height),m=o<g?o:g,E=(e-r.height*m)/2;this.layoutStyle("paginated"),this.width(n),this.height(e),this.overflow("hidden"),this.scaler(m,0,E),this.css("background-color","transparent")}},{key:"direction",value:function(n){this.documentElement&&(this.documentElement.style.direction=n)}},{key:"mapPage",value:function(n,e,r,o,g){var m=new i.default(e,g);return m.page(this,n,r,o)}},{key:"linksHandler",value:function(){var n=this;(0,a.replaceLinks)(this.content,function(e){n.emit(h.EVENTS.CONTENTS.LINK_CLICKED,e)})}},{key:"writingMode",value:function(n){var e=(0,d.prefixed)("writing-mode");return n&&this.documentElement&&(this.documentElement.style[e]=n),this.window.getComputedStyle(this.documentElement)[e]||""}},{key:"layoutStyle",value:function(n){return n&&(this._layoutStyle=n,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||"paginated"}},{key:"epubReadingSystem",value:function(n,e){return navigator.epubReadingSystem={name:n,version:e,layoutStyle:this.layoutStyle(),hasFeature:function(r){return r==="dom-manipulation"||r==="layout-changes"||r==="touch-events"||r==="mouse-events"||r==="keyboard-events"||r!=="spine-scripting"&&!1}},navigator.epubReadingSystem}},{key:"destroy",value:function(){this.observer&&this.observer.disconnect(),this.document.removeEventListener("transitionend",this.resizeCheck),this.removeListeners()}}],[{key:"listenedEvents",get:function(){return h.DOM_EVENTS}}]),p}();(0,y.default)(l.prototype),b.default=l,N.exports=b.default},function(N,b,w){"use strict";function k(n){return n&&n.__esModule?n:{default:n}}function T(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function n(e,r){for(var o=0,g;o<r.length;o++)g=r[o],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(e,g.key,g)}return function(e,r,o){return r&&n(e.prototype,r),o&&n(e,o),e}}(),v=w(2),y=k(v),d=w(0),u=w(19),s=k(u),t=w(12),i=k(t),a=w(56),h=k(a),c=w(66),f=k(c),l=w(3),p=function(){function n(e){T(this,n),this.name="default",this.View=e.view,this.request=e.request,this.renditionQueue=e.queue,this.q=new i.default(this),this.settings=(0,d.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,flow:"scrolled",ignoreClass:""}),(0,d.extend)(this.settings,e.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0},this.rendered=!1}return x(n,[{key:"render",value:function(e,r){var o=e.tagName;o&&(o.toLowerCase()=="body"||o.toLowerCase()=="html")&&(this.fullsize=!0),this.fullsize&&(this.settings.overflow="visible",this.overflow=this.settings.overflow),this.settings.size=r,this.stage=new h.default({width:r.width,height:r.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.fullsize,direction:this.settings.direction}),this.stage.attachTo(e),this.container=this.stage.getContainer(),this.views=new f.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}},{key:"addEventListeners",value:function(){var e;window.addEventListener("unload",function(){this.destroy()}.bind(this)),e=this.fullsize?window:this.container,e.addEventListener("scroll",this.onScroll.bind(this))}},{key:"removeEventListeners",value:function(){var e;e=this.fullsize?window:this.container,e.removeEventListener("scroll",this.onScroll.bind(this))}},{key:"destroy",value:function(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}},{key:"onOrientationChange",value:function(){var e=window,r=e.orientation;this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout(function(){this.orientationTimeout=void 0,this.resize(),this.emit(l.EVENTS.MANAGERS.ORIENTATION_CHANGE,r)}.bind(this),500)}},{key:"onResized",value:function(){this.resize()}},{key:"resize",value:function(e,r){var o=this.stage.size(e,r);return this.winBounds=(0,d.windowBounds)(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height?void(this._stageSize=void 0):void(this._stageSize&&this._stageSize.width===o.width&&this._stageSize.height===o.height||(this._stageSize=o,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(l.EVENTS.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height})))}},{key:"createView",value:function(e){return new this.View(e,this.viewSettings)}},{key:"display",value:function(e,r){var o=new d.defer,g=o.promise;(r===e.href||(0,d.isNumber)(r))&&(r=void 0);var m=this.views.find(e);if(m&&e){var E=m.offset();if(this.settings.direction==="ltr")this.scrollTo(E.left,E.top,!0);else{var C=m.width();this.scrollTo(E.left+C,E.top,!0)}if(r){var O=m.locationOf(r);this.moveTo(O)}return o.resolve(),g}return this.clear(),this.add(e).then(function(L){if(r){var I=L.locationOf(r);this.moveTo(I)}}.bind(this),function(L){o.reject(L)}).then(function(){var L;if(this.layout.name==="pre-paginated"&&1<this.layout.divisor&&(L=e.next(),L))return this.add(L)}.bind(this)).then(function(){this.views.show(),o.resolve()}.bind(this)),g}},{key:"afterDisplayed",value:function(e){this.emit(l.EVENTS.MANAGERS.ADDED,e)}},{key:"afterResized",value:function(e){this.emit(l.EVENTS.MANAGERS.RESIZE,e.section)}},{key:"moveTo",value:function(e){var r=0,o=0;this.isPaginated?(r=K(e.left/this.layout.delta)*this.layout.delta,r+this.layout.delta>this.container.scrollWidth&&(r=this.container.scrollWidth-this.layout.delta)):o=e.top,this.scrollTo(r,o,!0)}},{key:"add",value:function(e){var r=this,o=this.createView(e);return this.views.append(o),o.onDisplayed=this.afterDisplayed.bind(this),o.onResize=this.afterResized.bind(this),o.on(l.EVENTS.VIEWS.AXIS,function(g){r.updateAxis(g)}),o.display(this.request)}},{key:"append",value:function(e){var r=this,o=this.createView(e);return this.views.append(o),o.onDisplayed=this.afterDisplayed.bind(this),o.onResize=this.afterResized.bind(this),o.on(l.EVENTS.VIEWS.AXIS,function(g){r.updateAxis(g)}),o.display(this.request)}},{key:"prepend",value:function(e){var r=this,o=this.createView(e);return o.on(l.EVENTS.VIEWS.RESIZED,function(g){r.counter(g)}),this.views.prepend(o),o.onDisplayed=this.afterDisplayed.bind(this),o.onResize=this.afterResized.bind(this),o.on(l.EVENTS.VIEWS.AXIS,function(g){r.updateAxis(g)}),o.display(this.request)}},{key:"counter",value:function(e){this.settings.axis==="vertical"?this.scrollBy(0,e.heightDelta,!0):this.scrollBy(e.widthDelta,0,!0)}},{key:"next",value:function(){var e=this.settings.direction,r,o;if(this.views.length){if(this.isPaginated&&this.settings.axis==="horizontal"&&(!e||e==="ltr"))this.scrollLeft=this.container.scrollLeft,o=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,o<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):r=this.views.last().section.next();else if(this.isPaginated&&this.settings.axis==="horizontal"&&e==="rtl")this.scrollLeft=this.container.scrollLeft,o=this.container.scrollLeft,0<o?this.scrollBy(this.layout.delta,0,!0):r=this.views.last().section.next();else if(this.isPaginated&&this.settings.axis==="vertical"){this.scrollTop=this.container.scrollTop;var g=this.container.scrollTop+this.container.offsetHeight;g<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):r=this.views.last().section.next()}else r=this.views.last().section.next();return r?(this.clear(),this.append(r).then(function(){var m;if(this.layout.name==="pre-paginated"&&1<this.layout.divisor&&(m=r.next(),m))return this.append(m)}.bind(this),function(m){displaying.reject(m)}).then(function(){this.views.show()}.bind(this))):void 0}}},{key:"prev",value:function(){var e=this.settings.direction,r,o;if(this.views.length){if(this.isPaginated&&this.settings.axis==="horizontal"&&(!e||e==="ltr"))this.scrollLeft=this.container.scrollLeft,o=this.container.scrollLeft,0<o?this.scrollBy(-this.layout.delta,0,!0):r=this.views.first().section.prev();else if(this.isPaginated&&this.settings.axis==="horizontal"&&e==="rtl")this.scrollLeft=this.container.scrollLeft,o=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,o<=this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):r=this.views.first().section.prev();else if(this.isPaginated&&this.settings.axis==="vertical"){this.scrollTop=this.container.scrollTop;var g=this.container.scrollTop;0<g?this.scrollBy(0,-this.layout.height,!0):r=this.views.first().section.prev()}else r=this.views.first().section.prev();return r?(this.clear(),this.prepend(r).then(function(){var m;if(this.layout.name==="pre-paginated"&&1<this.layout.divisor&&(m=r.prev(),m))return this.prepend(m)}.bind(this),function(m){displaying.reject(m)}).then(function(){this.isPaginated&&this.settings.axis==="horizontal"&&(this.settings.direction==="rtl"?this.scrollTo(0,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}.bind(this))):void 0}}},{key:"current",value:function(){var e=this.visible();return e.length?e[e.length-1]:null}},{key:"clear",value:function(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}},{key:"currentLocation",value:function(){return this.location=this.settings.axis==="vertical"?this.scrolledLocation():this.paginatedLocation(),this.location}},{key:"scrolledLocation",value:function(){var e=this,r=this.visible(),o=this.container.getBoundingClientRect(),g=o.height<window.innerHeight?o.height:window.innerHeight,m=0,E=0;this.fullsize&&(m=window.scrollY);var C=r.map(function(O){var L=O.section,I=L.index,A=L.href,B=O.position(),j=O.height(),_=m+o.top-B.top+E,R=_+g-E;R>j&&(R=j,E=R-_);var q=e.layout.count(j,g).pages,S=G(_/g),F=[],V=G(R/g);F=[];for(var W=S,M;W<=V;W++)M=W+1,F.push(M);var P=e.mapping.page(O.contents,O.section.cfiBase,_,R);return{index:I,href:A,pages:F,totalPages:q,mapping:P}});return C}},{key:"paginatedLocation",value:function(){var e=this,r=this.visible(),o=this.container.getBoundingClientRect(),g=0,m=0;this.fullsize&&(g=window.scrollX);var E=r.map(function(C){var O=C.section,L=O.index,I=O.href,A=C.offset().left,B=C.position().left,j=C.width(),_=g+o.left-B+m,R=_+e.layout.width-m,q=e.mapping.page(C.contents,C.section.cfiBase,_,R),S=e.layout.count(j).pages,F=K(_/e.layout.pageWidth),V=[],W=K(R/e.layout.pageWidth);if(0>F&&(F=0,++W),e.settings.direction==="rtl"){var M=F;F=S-W,W=S-M}for(var P=F+1,z;P<=W;P++)z=P,V.push(z);return{index:L,href:I,pages:V,totalPages:S,mapping:q}});return E}},{key:"isVisible",value:function(e,r,o,g){var m=e.position(),E=g||this.bounds();return this.settings.axis==="horizontal"&&m.right>E.left-r&&m.left<E.right+o||this.settings.axis==="vertical"&&m.bottom>E.top-r&&m.top<E.bottom+o}},{key:"visible",value:function(){for(var e=this.bounds(),r=this.views.displayed(),o=r.length,g=[],m=0,E,C;m<o;m++)C=r[m],E=this.isVisible(C,0,0,e),E===!0&&g.push(C);return g}},{key:"scrollBy",value:function(e,r,o){var g=this.settings.direction==="rtl"?-1:1;o&&(this.ignore=!0),this.fullsize?window.scrollBy(e*g,r*g):(e&&(this.container.scrollLeft+=e*g),r&&(this.container.scrollTop+=r)),this.scrolled=!0}},{key:"scrollTo",value:function(e,r,o){o&&(this.ignore=!0),this.fullsize?window.scrollTo(e,r):(this.container.scrollLeft=e,this.container.scrollTop=r),this.scrolled=!0}},{key:"onScroll",value:function(){var e,r;this.fullsize?(e=window.scrollY,r=window.scrollX):(e=this.container.scrollTop,r=this.container.scrollLeft),this.scrollTop=e,this.scrollLeft=r,this.ignore?this.ignore=!1:(this.emit(l.EVENTS.MANAGERS.SCROLL,{top:e,left:r}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(l.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}},{key:"bounds",value:function(){var e;return e=this.stage.bounds(),e}},{key:"applyLayout",value:function(e){this.layout=e,this.updateLayout()}},{key:"updateLayout",value:function(){this.stage&&(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:"setLayout",value:function(e){this.viewSettings.layout=e,this.mapping=new s.default(e.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach(function(r){r&&r.setLayout(e)})}},{key:"updateAxis",value:function(e,r){this.isPaginated||(e="vertical"),(r||e!==this.settings.axis)&&(this.settings.axis=e,this.stage&&this.stage.axis(e),this.viewSettings.axis=e,this.mapping&&(this.mapping=new s.default(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&(e==="vertical"?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)))}},{key:"updateFlow",value:function(e){var r=e==="paginated"||e==="auto";this.isPaginated=r,(e==="scrolled-doc"||e==="scrolled-continuous"||e==="scrolled")&&this.updateAxis("vertical"),this.viewSettings.flow=e,this.overflow=this.settings.overflow?this.settings.overflow:r?"hidden":"auto",this.updateLayout()}},{key:"getContents",value:function(){var e=[];return this.views&&this.views.forEach(function(r){var o=r&&r.contents;o&&e.push(o)}),e}},{key:"direction",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"ltr";this.settings.direction=e,this.stage&&this.stage.direction(e),this.viewSettings.direction=e,this.updateLayout()}},{key:"isRendered",value:function(){return this.rendered}}]),n}();(0,y.default)(p.prototype),b.default=p,N.exports=b.default},function(N){N.exports=function(b){var w=typeof b;return b!=null&&(w=="object"||w=="function")}},function(N){N.exports=Z},function(N){"use strict";var b={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},w=function(){var k={},T,x,v,y;for(T in b)if(b.hasOwnProperty(T)){for(x in b[T])if(b[T].hasOwnProperty(x))if(v=b[T][x],typeof v=="string")k[v]=T+"/"+x;else for(y=0;y<v.length;y++)k[v[y]]=T+"/"+x}return k}();N.exports={lookup:function(k){return k&&w[k.split(".").pop().toLowerCase()]||"text/plain"}}},function(N,b,w){"use strict";function k(j){return j&&j.__esModule?j:{default:j}}function T(j,_){if(!(j instanceof _))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},v=function(){function j(_,R){for(var q=0,S;q<R.length;q++)S=R[q],S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(_,S.key,S)}return function(_,R,q){return R&&j(_.prototype,R),q&&j(_,q),_}}(),y=w(2),d=k(y),u=w(0),s=w(10),t=k(s),i=w(1),a=k(i),h=w(12),c=k(h),f=w(50),l=k(f),p=w(51),n=k(p),e=w(13),r=k(e),o=w(52),g=k(o),m=w(3),E=w(20),C=k(E),O=w(14),L=k(O),I=w(24),A=k(I),B=function(){function j(_,R){T(this,j),this.settings=(0,u.extend)(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,script:null}),(0,u.extend)(this.settings,R),x(this.settings.manager)==="object"&&(this.manager=this.settings.manager),this.book=_,this.hooks={},this.hooks.display=new t.default(this),this.hooks.serialize=new t.default(this),this.hooks.content=new t.default(this),this.hooks.unloaded=new t.default(this),this.hooks.layout=new t.default(this),this.hooks.render=new t.default(this),this.hooks.show=new t.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new n.default(this),this.annotations=new g.default(this),this.epubcfi=new a.default,this.q=new c.default(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new u.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}return v(j,[{key:"setManager",value:function(_){this.manager=_}},{key:"requireManager",value:function(_){var R;return R=typeof _=="string"&&_==="default"?L.default:typeof _=="string"&&_==="continuous"?A.default:_,R}},{key:"requireView",value:function(_){var R;return R=typeof _=="string"&&_==="iframe"?C.default:_,R}},{key:"start",value:function(){this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(m.EVENTS.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(m.EVENTS.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(m.EVENTS.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(m.EVENTS.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(m.EVENTS.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(m.EVENTS.RENDITION.STARTED),this.starting.resolve()}},{key:"attachTo",value:function(_){return this.q.enqueue(function(){this.manager.render(_,{width:this.settings.width,height:this.settings.height}),this.emit(m.EVENTS.RENDITION.ATTACHED)}.bind(this))}},{key:"display",value:function(_){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,_)}},{key:"_display",value:function(_){var R=this;if(this.book){var q=this.epubcfi.isCfiString(_),S=new u.defer,F=S.promise,V;return this.displaying=S,this.book.locations.length()&&((0,u.isFloat)(_)||_==="1.0")&&(_=this.book.locations.cfiFromPercentage(parseFloat(_))),V=this.book.spine.get(_),V?(this.manager.display(V,_).then(function(){S.resolve(V),R.displaying=void 0,R.emit(m.EVENTS.RENDITION.DISPLAYED,V),R.reportLocation()},function(W){R.emit(m.EVENTS.RENDITION.DISPLAY_ERROR,W)}),F):(S.reject(new Error("No Section Found")),F)}}},{key:"afterDisplayed",value:function(_){var R=this;_.on(m.EVENTS.VIEWS.MARK_CLICKED,function(q,S){return R.triggerMarkEvent(q,S,_)}),this.hooks.render.trigger(_,this).then(function(){_.contents?R.hooks.content.trigger(_.contents,R).then(function(){R.emit(m.EVENTS.RENDITION.RENDERED,_.section,_)}):R.emit(m.EVENTS.RENDITION.RENDERED,_.section,_)})}},{key:"afterRemoved",value:function(_){var R=this;this.hooks.unloaded.trigger(_,this).then(function(){R.emit(m.EVENTS.RENDITION.REMOVED,_.section,_)})}},{key:"onResized",value:function(_){this.emit(m.EVENTS.RENDITION.RESIZED,{width:_.width,height:_.height}),this.location&&this.location.start&&this.display(this.location.start.cfi)}},{key:"onOrientationChange",value:function(_){this.emit(m.EVENTS.RENDITION.ORIENTATION_CHANGE,_)}},{key:"moveTo",value:function(_){this.manager.moveTo(_)}},{key:"resize",value:function(_,R){_&&(this.settings.width=_),R&&(this.settings.height=R),this.manager.resize(_,R)}},{key:"clear",value:function(){this.manager.clear()}},{key:"next",value:function(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:"prev",value:function(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:"determineLayoutProperties",value:function(_){var R=this.settings.layout||_.layout||"reflowable",q=this.settings.spread||_.spread||"auto",S=this.settings.orientation||_.orientation||"auto",F=this.settings.flow||_.flow||"auto",V=_.viewport||"",W=this.settings.minSpreadWidth||_.minSpreadWidth||800,M=this.settings.direction||_.direction||"ltr",P;return(this.settings.width===0||0<this.settings.width)&&(this.settings.height===0||0<this.settings.height),P={layout:R,spread:q,orientation:S,flow:F,viewport:V,minSpreadWidth:W,direction:M},P}},{key:"flow",value:function(_){var R=_;(_==="scrolled"||_==="scrolled-doc"||_==="scrolled-continuous")&&(R="scrolled"),(_==="auto"||_==="paginated")&&(R="paginated"),this.settings.flow=_,this._layout&&this._layout.flow(R),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(R),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}},{key:"layout",value:function(_){var R=this;return _&&(this._layout=new l.default(_),this._layout.spread(_.spread,this.settings.minSpreadWidth),this._layout.on(m.EVENTS.LAYOUT.UPDATED,function(q,S){R.emit(m.EVENTS.RENDITION.LAYOUT,q,S)})),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}},{key:"spread",value:function(_,R){this._layout.spread(_,R),this.manager.isRendered()&&this.manager.updateLayout()}},{key:"direction",value:function(_){this.settings.direction=_||"ltr",this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}},{key:"reportLocation",value:function(){return this.q.enqueue(function(){requestAnimationFrame(function(){var _=this.manager.currentLocation();if(_&&_.then&&typeof _.then=="function")_.then(function(q){var S=this.located(q);S&&S.start&&S.end&&(this.location=S,this.emit(m.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(m.EVENTS.RENDITION.RELOCATED,this.location))}.bind(this));else if(_){var R=this.located(_);if(!R||!R.start||!R.end)return;this.location=R,this.emit(m.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(m.EVENTS.RENDITION.RELOCATED,this.location)}}.bind(this))}.bind(this))}},{key:"currentLocation",value:function(){var _=this.manager.currentLocation();if(_&&_.then&&typeof _.then=="function")_.then(function(q){var S=this.located(q);return S}.bind(this));else if(_){var R=this.located(_);return R}}},{key:"located",value:function(_){if(!_.length)return{};var R=_[0],q=_[_.length-1],S={start:{index:R.index,href:R.href,cfi:R.mapping.start,displayed:{page:R.pages[0]||1,total:R.totalPages}},end:{index:q.index,href:q.href,cfi:q.mapping.end,displayed:{page:q.pages[q.pages.length-1]||1,total:q.totalPages}}},F=this.book.locations.locationFromCfi(R.mapping.start),V=this.book.locations.locationFromCfi(q.mapping.end);F!=null&&(S.start.location=F,S.start.percentage=this.book.locations.percentageFromLocation(F)),V!=null&&(S.end.location=V,S.end.percentage=this.book.locations.percentageFromLocation(V));var W=this.book.pageList.pageFromCfi(R.mapping.start),M=this.book.pageList.pageFromCfi(q.mapping.end);return W!=-1&&(S.start.page=W),M!=-1&&(S.end.page=M),q.index===this.book.spine.last().index&&S.end.displayed.page>=S.end.displayed.total&&(S.atEnd=!0),R.index===this.book.spine.first().index&&S.start.displayed.page===1&&(S.atStart=!0),S}},{key:"destroy",value:function(){this.manager&&this.manager.destroy(),this.book=void 0}},{key:"passEvents",value:function(_){var R=this,q=r.default.listenedEvents;q.forEach(function(S){_.on(S,function(F){return R.triggerViewEvent(F,_)})}),_.on(m.EVENTS.CONTENTS.SELECTED,function(S){return R.triggerSelectedEvent(S,_)})}},{key:"triggerViewEvent",value:function(_,R){this.emit(_.type,_,R)}},{key:"triggerSelectedEvent",value:function(_,R){this.emit(m.EVENTS.RENDITION.SELECTED,_,R)}},{key:"triggerMarkEvent",value:function(_,R,q){this.emit(m.EVENTS.RENDITION.MARK_CLICKED,_,R,q)}},{key:"getRange",value:function(_,R){var q=new a.default(_),S=this.manager.visible().filter(function(F){if(q.spinePos===F.index)return!0});if(S.length)return S[0].contents.range(q,R)}},{key:"adjustImages",value:function(_){return this._layout.name==="pre-paginated"?new Promise(function(R){R()}):(_.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+"px":"100%")+"!important","max-height":(this._layout.height?.6*this._layout.height+"px":"60%")+"!important","object-fit":"contain","page-break-inside":"avoid"},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+"px":"100%")+"!important","max-height":(this._layout.height?.6*this._layout.height+"px":"60%")+"!important","page-break-inside":"avoid"}}),new Promise(function(R){setTimeout(function(){R()},1)}))}},{key:"getContents",value:function(){return this.manager?this.manager.getContents():[]}},{key:"views",value:function(){var _=this.manager?this.manager.views:void 0;return _||[]}},{key:"handleLinks",value:function(_){var R=this;_&&_.on(m.EVENTS.CONTENTS.LINK_CLICKED,function(q){var S=R.book.path.relative(q);R.display(S)})}},{key:"injectStylesheet",value:function(_){var R=_.createElement("link");R.setAttribute("type","text/css"),R.setAttribute("rel","stylesheet"),R.setAttribute("href",this.settings.stylesheet),_.getElementsByTagName("head")[0].appendChild(R)}},{key:"injectScript",value:function(_){var R=_.createElement("script");R.setAttribute("type","text/javascript"),R.setAttribute("src",this.settings.script),R.textContent=" ",_.getElementsByTagName("head")[0].appendChild(R)}},{key:"injectIdentifier",value:function(_){var R=this.book.package.metadata.identifier,q=_.createElement("meta");q.setAttribute("name","dc.relation.ispartof"),R&&q.setAttribute("content",R),_.getElementsByTagName("head")[0].appendChild(q)}}]),j}();(0,d.default)(B.prototype),b.default=B,N.exports=b.default},function(N,b,w){"use strict";function k(d,u){if(!(d instanceof u))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function d(u,s){for(var t=0,i;t<s.length;t++)i=s[t],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(u,i.key,i)}return function(u,s,t){return s&&d(u.prototype,s),t&&d(u,t),u}}(),x=w(1),v=function(d){return d&&d.__esModule?d:{default:d}}(x),y=function(){function d(u,s,t,i){k(this,d),this.layout=u,this.horizontal=t==="horizontal",this.direction=s||"ltr",this._dev=i}return T(d,[{key:"section",value:function(u){var s=this.findRanges(u),t=this.rangeListToCfiList(u.section.cfiBase,s);return t}},{key:"page",value:function(u,s,t,i){var a=u&&u.document&&u.document.body,h;if(a){if(h=this.rangePairToCfiPair(s,{start:this.findStart(a,t,i),end:this.findEnd(a,t,i)}),this._dev===!0){var c=u.document,f=new v.default(h.start).toRange(c),l=new v.default(h.end).toRange(c),p=c.defaultView.getSelection(),n=c.createRange();p.removeAllRanges(),n.setStart(f.startContainer,f.startOffset),n.setEnd(l.endContainer,l.endOffset),p.addRange(n)}return h}}},{key:"walk",value:function(u,s){if(!(u&&u.nodeType===Node.TEXT_NODE)){var t={acceptNode:function(f){return 0<f.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},i=t.acceptNode;i.acceptNode=t.acceptNode;for(var a=document.createTreeWalker(u,NodeFilter.SHOW_TEXT,i,!1),h,c;(h=a.nextNode())&&(c=s(h),!c););return c}}},{key:"findRanges",value:function(u){for(var s=[],t=u.contents.scrollWidth(),i=G(t/this.layout.spreadWidth),a=i*this.layout.divisor,h=this.layout.columnWidth,c=this.layout.gap,f=0,l,p;f<a.pages;f++)l=(h+c)*f,p=h*(f+1)+c*f,s.push({start:this.findStart(u.document.body,l,p),end:this.findEnd(u.document.body,l,p)});return s}},{key:"findStart",value:function(u,s,t){for(var i=this,a=[u],h=u,c,f;a.length;)if(c=a.shift(),f=this.walk(c,function(l){var p,n,e,r,o;if(o=i.getBounds(l),i.horizontal&&i.direction==="ltr"){if(p=i.horizontal?o.left:o.top,n=i.horizontal?o.right:o.bottom,p>=s&&p<=t||n>s)return l;h=l,a.push(l)}else if(i.horizontal&&i.direction==="rtl"){if(p=o.left,n=o.right,n<=t&&n>=s||p<t)return l;h=l,a.push(l)}else{if(e=o.top,r=o.bottom,e>=s&&e<=t||r>s)return l;h=l,a.push(l)}}),f)return this.findTextStartRange(f,s,t);return this.findTextStartRange(h,s,t)}},{key:"findEnd",value:function(u,s,t){for(var i=this,a=[u],h=u,c,f;a.length;)if(c=a.shift(),f=this.walk(c,function(l){var p,n,e,r,o;if(o=i.getBounds(l),i.horizontal&&i.direction==="ltr"){if(p=H(o.left),n=H(o.right),p>t&&h)return h;if(n>t)return l;h=l,a.push(l)}else if(i.horizontal&&i.direction==="rtl"){if(p=H(i.horizontal?o.left:o.top),n=H(i.horizontal?o.right:o.bottom),n<s&&h)return h;if(p<s)return l;h=l,a.push(l)}else{if(e=H(o.top),r=H(o.bottom),e>t&&h)return h;if(r>t)return l;h=l,a.push(l)}}),f)return this.findTextEndRange(f,s,t);return this.findTextEndRange(h,s,t)}},{key:"findTextStartRange",value:function(u,s,t){for(var i=this.splitTextNodeIntoRanges(u),a=0,h,c,f,l,p;a<i.length;a++)if(h=i[a],c=h.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(f=c.left,f>=s)return h}else if(this.horizontal&&this.direction==="rtl"){if(p=c.right,p<=t)return h}else if(l=c.top,l>=s)return h;return i[0]}},{key:"findTextEndRange",value:function(u,s,t){for(var i=this.splitTextNodeIntoRanges(u),a=0,h,c,f,l,p,n,e;a<i.length;a++){if(c=i[a],f=c.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(l=f.left,p=f.right,l>t&&h)return h;if(p>t)return c}else if(this.horizontal&&this.direction==="rtl"){if(l=f.left,p=f.right,p<s&&h)return h;if(l<s)return c}else{if(n=f.top,e=f.bottom,n>t&&h)return h;if(e>t)return c}h=c}return i[i.length-1]}},{key:"splitTextNodeIntoRanges",value:function(u,s){var t=[],i=u.textContent||"",a=i.trim(),h=u.ownerDocument,c=s||" ",f=a.indexOf(c),l;if(f===-1||u.nodeType!=Node.TEXT_NODE)return l=h.createRange(),l.selectNodeContents(u),[l];for(l=h.createRange(),l.setStart(u,0),l.setEnd(u,f),t.push(l),l=!1;f!=-1;)f=a.indexOf(c,f+1),0<f&&(l&&(l.setEnd(u,f),t.push(l)),l=h.createRange(),l.setStart(u,f+1));return l&&(l.setEnd(u,a.length),t.push(l)),t}},{key:"rangePairToCfiPair",value:function(u,s){var t=s.start,i=s.end;t.collapse(!0),i.collapse(!1);var a=new v.default(t,u).toString(),h=new v.default(i,u).toString();return{start:a,end:h}}},{key:"rangeListToCfiList",value:function(u,s){for(var t=[],i=0,a;i<s.length;i++)a=this.rangePairToCfiPair(u,s[i]),t.push(a);return t}},{key:"getBounds",value:function(u){var s;if(u.nodeType==Node.TEXT_NODE){var t=document.createRange();t.selectNodeContents(u),s=t.getBoundingClientRect()}else s=u.getBoundingClientRect();return s}},{key:"axis",value:function(u){return u&&(this.horizontal=u==="horizontal"),this.horizontal}}]),d}();b.default=y,N.exports=b.default},function(N,b,w){"use strict";function k(f){return f&&f.__esModule?f:{default:f}}function T(f,l){if(!(f instanceof l))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function f(l,p){for(var n=0,e;n<p.length;n++)e=p[n],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(l,e.key,e)}return function(l,p,n){return p&&f(l.prototype,p),n&&f(l,n),l}}(),v=w(2),y=k(v),d=w(0),u=w(1),s=k(u),t=w(13),i=k(t),a=w(3),h=w(53),c=function(){function f(l,p){T(this,f),this.settings=(0,d.extend)({ignoreClass:"",axis:p.layout&&p.layout.props.flow==="scrolled"?"vertical":"horizontal",direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0},p||{}),this.id="epubjs-view-"+(0,d.uuid)(),this.section=l,this.index=l.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new s.default,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}return x(f,[{key:"container",value:function(l){var p=document.createElement("div");return p.classList.add("epub-view"),p.style.height="0px",p.style.width="0px",p.style.overflow="hidden",p.style.position="relative",p.style.display="block",p.style.flex=l&&l=="horizontal"?"none":"initial",p}},{key:"create",value:function(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.setAttribute("enable-annotation","true"),this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.setAttribute("ref",this.index),this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=(0,d.bounds)(this.element),this.supportsSrcdoc="srcdoc"in this.iframe,this.settings.method||(this.settings.method=this.supportsSrcdoc?"srcdoc":"write"),this.iframe)}},{key:"render",value:function(l){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(l)),this.sectionRender.then(function(p){return this.load(p)}.bind(this)).then(function(){var p=this;this.layout.format(this.contents);var n=this.contents.writingMode(),e=n.indexOf("vertical")===0?"vertical":"horizontal";return this.setAxis(e),this.emit(a.EVENTS.VIEWS.AXIS,e),this.addListeners(),new Promise(function(r){p.expand(),r()})}.bind(this),function(p){return this.emit(a.EVENTS.VIEWS.LOAD_ERROR,p),new Promise(function(n,e){e(p)})}.bind(this)).then(function(){this.emit(a.EVENTS.VIEWS.RENDERED,this.section)}.bind(this))}},{key:"reset",value:function(){this.iframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}},{key:"size",value:function(l,p){var n=l||this.settings.width,e=p||this.settings.height;this.layout.name==="pre-paginated"?this.lock("both",n,e):this.settings.axis==="horizontal"?this.lock("height",n,e):this.lock("width",n,e),this.settings.width=n,this.settings.height=e}},{key:"lock",value:function(l,p,n){var e=(0,d.borders)(this.element),r;r=this.iframe?(0,d.borders)(this.iframe):{width:0,height:0},l=="width"&&(0,d.isNumber)(p)&&(this.lockedWidth=p-e.width-r.width),l=="height"&&(0,d.isNumber)(n)&&(this.lockedHeight=n-e.height-r.height),l==="both"&&(0,d.isNumber)(p)&&(0,d.isNumber)(n)&&(this.lockedWidth=p-e.width-r.width,this.lockedHeight=n-e.height-r.height),this.displayed&&this.iframe&&this.expand()}},{key:"expand",value:function(){var l=this.lockedWidth,p=this.lockedHeight,n;!this.iframe||this._expanding||(this._expanding=!0,this.layout.name==="pre-paginated"?(l=this.layout.columnWidth,p=this.layout.height):this.settings.axis==="horizontal"?(l=this.contents.textWidth(),0<l%this.layout.pageWidth&&(l=G(l/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(n=l/this.layout.delta,1<this.layout.divisor&&this.layout.name==="reflowable"&&0<n%2&&(l+=this.layout.gap+this.layout.columnWidth))):this.settings.axis==="vertical"&&(p=this.contents.textHeight()),(this._needsReframe||l!=this._width||p!=this._height)&&this.reframe(l,p),this._expanding=!1)}},{key:"reframe",value:function(l,p){var n;(0,d.isNumber)(l)&&(this.element.style.width=l+"px",this.iframe.style.width=l+"px",this._width=l),(0,d.isNumber)(p)&&(this.element.style.height=p+"px",this.iframe.style.height=p+"px",this._height=p);var e=this.prevBounds?l-this.prevBounds.width:l,r=this.prevBounds?p-this.prevBounds.height:p;n={width:l,height:p,widthDelta:e,heightDelta:r},this.pane&&this.pane.render(),this.onResize(this,n),this.emit(a.EVENTS.VIEWS.RESIZED,n),this.prevBounds=n,this.elementBounds=(0,d.bounds)(this.element)}},{key:"load",value:function(l){var p=new d.defer,n=p.promise;if(!this.iframe)return p.reject(new Error("No Iframe Available")),n;if(this.iframe.onload=function(e){this.onLoad(e,p)}.bind(this),this.settings.method==="blobUrl")this.blobUrl=(0,d.createBlobUrl)(l,"application/xhtml+xml"),this.iframe.src=this.blobUrl;else if(this.settings.method==="srcdoc")this.iframe.srcdoc=l;else{if(this.document=this.iframe.contentDocument,!this.document)return p.reject(new Error("No Document Available")),n;this.iframe.contentDocument.open(),this.iframe.contentDocument.write(l),this.iframe.contentDocument.close()}return n}},{key:"onLoad",value:function(l,p){var n=this;this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new i.default(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var e=this.document.querySelector("link[rel='canonical']");e?e.setAttribute("href",this.section.canonical):(e=this.document.createElement("link"),e.setAttribute("rel","canonical"),e.setAttribute("href",this.section.canonical),this.document.querySelector("head").appendChild(e)),this.contents.on(a.EVENTS.CONTENTS.EXPAND,function(){n.displayed&&n.iframe&&(n.expand(),n.contents&&n.layout.format(n.contents))}),this.contents.on(a.EVENTS.CONTENTS.RESIZE,function(){n.displayed&&n.iframe&&(n.expand(),n.contents&&n.layout.format(n.contents))}),p.resolve(this.contents)}},{key:"setLayout",value:function(l){this.layout=l,this.contents&&(this.layout.format(this.contents),this.expand())}},{key:"setAxis",value:function(l){this.layout.props.flow==="scrolled"&&(l="vertical"),this.settings.axis=l,this.element.style.flex=l=="horizontal"?"none":"initial",this.size()}},{key:"addListeners",value:function(){}},{key:"removeListeners",value:function(){}},{key:"display",value:function(l){var p=new d.defer;return this.displayed?p.resolve(this):this.render(l).then(function(){this.emit(a.EVENTS.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,p.resolve(this)}.bind(this),function(n){p.reject(n,this)}),p.promise}},{key:"show",value:function(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible"),this.emit(a.EVENTS.VIEWS.SHOWN,this)}},{key:"hide",value:function(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.emit(a.EVENTS.VIEWS.HIDDEN,this)}},{key:"offset",value:function(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"position",value:function(){return this.element.getBoundingClientRect()}},{key:"locationOf",value:function(l){var p=this.iframe.getBoundingClientRect(),n=this.contents.locationOf(l,this.settings.ignoreClass);return{left:n.left,top:n.top}}},{key:"onDisplayed",value:function(){}},{key:"onResize",value:function(){}},{key:"bounds",value:function(l){return(l||!this.elementBounds)&&(this.elementBounds=(0,d.bounds)(this.element)),this.elementBounds}},{key:"highlight",value:function(l){var p=this,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},e=arguments[2];if(this.contents){var r=this.contents.range(l),o=function(){p.emit(a.EVENTS.VIEWS.MARK_CLICKED,l,n)};n.epubcfi=l,this.pane||(this.pane=new h.Pane(this.iframe,this.element));var g=new h.Highlight(r,"epubjs-hl",n,{fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"}),m=this.pane.addMark(g);return this.highlights[l]={mark:m,element:m.element,listeners:[o,e]},m.element.setAttribute("ref","epubjs-hl"),m.element.addEventListener("click",o),m.element.addEventListener("touchstart",o),e&&(m.element.addEventListener("click",e),m.element.addEventListener("touchstart",e)),m}}},{key:"underline",value:function(l){var p=this,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},e=arguments[2];if(this.contents){var r=this.contents.range(l),o=function(){p.emit(a.EVENTS.VIEWS.MARK_CLICKED,l,n)};n.epubcfi=l,this.pane||(this.pane=new h.Pane(this.iframe,this.element));var g=new h.Underline(r,"epubjs-ul",n,{stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"}),m=this.pane.addMark(g);return this.underlines[l]={mark:m,element:m.element,listeners:[o,e]},m.element.setAttribute("ref","epubjs-ul"),m.element.addEventListener("click",o),m.element.addEventListener("touchstart",o),e&&(m.element.addEventListener("click",e),m.element.addEventListener("touchstart",e)),m}}},{key:"mark",value:function(l){var p=this,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},e=arguments[2];if(this.contents){if(l in this.marks){var r=this.marks[l];return r}var o=this.contents.range(l);if(o){var g=o.commonAncestorContainer,m=g.nodeType===1?g:g.parentNode,E=function(){p.emit(a.EVENTS.VIEWS.MARK_CLICKED,l,n)};o.collapsed&&g.nodeType===1?(o=new Range,o.selectNodeContents(g)):o.collapsed&&(o=new Range,o.selectNodeContents(m));var C,O,L;if(this.layout.name==="pre-paginated"||this.settings.axis!=="horizontal"){var I=o.getBoundingClientRect();C=I.top,O=I.right}else for(var A=o.getClientRects(),B=void 0,j=0;j!=A.length;j++)B=A[j],(!L||B.left<L)&&(L=B.left,O=L+this.layout.columnWidth-this.layout.gap,C=B.top);var _=this.document.createElement("a");return _.setAttribute("ref","epubjs-mk"),_.style.position="absolute",_.style.top=C+"px",_.style.left=O+"px",_.dataset.epubcfi=l,n&&Object.keys(n).forEach(function(R){_.dataset[R]=n[R]}),e&&(_.addEventListener("click",e),_.addEventListener("touchstart",e)),_.addEventListener("click",E),_.addEventListener("touchstart",E),this.element.appendChild(_),this.marks[l]={element:_,listeners:[E,e]},m}}}},{key:"unhighlight",value:function(l){var p;l in this.highlights&&(p=this.highlights[l],this.pane.removeMark(p.mark),p.listeners.forEach(function(n){n&&p.element.removeEventListener("click",n)}),delete this.highlights[l])}},{key:"ununderline",value:function(l){var p;l in this.underlines&&(p=this.underlines[l],this.pane.removeMark(p.mark),p.listeners.forEach(function(n){n&&p.element.removeEventListener("click",n)}),delete this.underlines[l])}},{key:"unmark",value:function(l){var p;l in this.marks&&(p=this.marks[l],this.element.removeChild(p.element),p.listeners.forEach(function(n){n&&p.element.removeEventListener("click",n)}),delete this.marks[l])}},{key:"destroy",value:function(){for(var l in this.highlights)this.unhighlight(l);for(var p in this.underlines)this.ununderline(p);for(var n in this.marks)this.unmark(n);this.blobUrl&&(0,d.revokeBlobUrl)(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.iframe=null,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}]),f}();(0,y.default)(c.prototype),b.default=c,N.exports=b.default},function(N,b,w){var k=w(15),T=w(58),x=w(60),v=Math.min;N.exports=function(y,d,u){function s(O){var L=r,I=o;return r=o=void 0,l=O,m=y.apply(I,L),m}function t(O){return l=O,E=setTimeout(h,d),p?s(O):m}function i(O){var L=O-C,I=O-l,A=d-L;return n?v(A,g-I):A}function a(O){var L=O-C,I=O-l;return C==null||L>=d||0>L||n&&I>=g}function h(){var O=T();return a(O)?c(O):void(E=setTimeout(h,i(O)))}function c(O){return E=void 0,e&&r?s(O):(r=o=void 0,m)}function f(){var O=T(),L=a(O);if(r=arguments,o=this,C=O,L){if(E===void 0)return t(C);if(n)return E=setTimeout(h,d),s(C)}return E===void 0&&(E=setTimeout(h,d)),m}var l=0,p=!1,n=!1,e=!0,r,o,g,m,E,C;if(typeof y!="function")throw new TypeError("Expected a function");return d=x(d)||0,k(u)&&(p=!!u.leading,n="maxWait"in u,g=n?$(x(u.maxWait)||0,d):g,e="trailing"in u?!!u.trailing:e),f.cancel=function(){E!==void 0&&clearTimeout(E),l=0,r=C=o=E=void 0},f.flush=function(){return E===void 0?m:c(T())},f}},function(N,b,w){var k=w(59),T=typeof self=="object"&&self&&self.Object===Object&&self,x=k||T||Function("return this")();N.exports=x},function(N,b,w){var k=w(22),T=k.Symbol;N.exports=T},function(N,b,w){"use strict";function k(c){return c&&c.__esModule?c:{default:c}}function T(c,f){if(!(c instanceof f))throw new TypeError("Cannot call a class as a function")}function x(c,f){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:c}function v(c,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);c.prototype=Object.create(f&&f.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(c,f):c.__proto__=f)}Object.defineProperty(b,"__esModule",{value:!0});var y=function(){function c(f,l){for(var p=0,n;p<l.length;p++)n=l[p],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}return function(f,l,p){return l&&c(f.prototype,l),p&&c(f,p),f}}(),d=w(0),u=w(14),s=k(u),t=w(3),i=w(21),a=k(i),h=function(c){function f(l){T(this,f);var p=x(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l));return p.name="continuous",p.settings=(0,d.extend)(p.settings||{},{infinite:!0,overflow:void 0,axis:void 0,flow:"scrolled",offset:500,offsetDelta:250,width:void 0,height:void 0}),(0,d.extend)(p.settings,l.settings||{}),l.settings.gap!="undefined"&&l.settings.gap===0&&(p.settings.gap=l.settings.gap),p.viewSettings={ignoreClass:p.settings.ignoreClass,axis:p.settings.axis,flow:p.settings.flow,layout:p.layout,width:0,height:0,forceEvenPages:!1},p.scrollTop=0,p.scrollLeft=0,p}return v(f,c),y(f,[{key:"display",value:function(l,p){return s.default.prototype.display.call(this,l,p).then(function(){return this.fill()}.bind(this))}},{key:"fill",value:function(l){var p=this,n=l||new d.defer;return this.q.enqueue(function(){return p.check()}).then(function(e){e?p.fill(n):n.resolve()}),n.promise}},{key:"moveTo",value:function(l){var p=0,n=0,e=0,r=0;this.isPaginated?(p=K(l.left/this.layout.delta)*this.layout.delta,e=p+this.settings.offset):(n=l.top,r=l.top+this.settings.offset),(0<p||0<n)&&this.scrollBy(p,n,!0)}},{key:"afterResized",value:function(l){this.emit(t.EVENTS.MANAGERS.RESIZE,l.section)}},{key:"removeShownListeners",value:function(l){l.onDisplayed=function(){}}},{key:"add",value:function(l){var p=this,n=this.createView(l);return this.views.append(n),n.on(t.EVENTS.VIEWS.RESIZED,function(){n.expanded=!0}),n.on(t.EVENTS.VIEWS.AXIS,function(e){p.updateAxis(e)}),n.onDisplayed=this.afterDisplayed.bind(this),n.onResize=this.afterResized.bind(this),n.display(this.request)}},{key:"append",value:function(l){var p=this.createView(l);return p.on(t.EVENTS.VIEWS.RESIZED,function(){p.expanded=!0}),this.views.append(p),p.onDisplayed=this.afterDisplayed.bind(this),p}},{key:"prepend",value:function(l){var p=this,n=this.createView(l);return n.on(t.EVENTS.VIEWS.RESIZED,function(e){p.counter(e),n.expanded=!0}),this.views.prepend(n),n.onDisplayed=this.afterDisplayed.bind(this),n}},{key:"counter",value:function(l){this.settings.axis==="vertical"?this.scrollBy(0,l.heightDelta,!0):this.scrollBy(l.widthDelta,0,!0)}},{key:"update",value:function(l){for(var p=this.bounds(),n=this.views.all(),e=n.length,r=[],o=typeof l=="undefined"?this.settings.offset||0:l,g=new d.defer,m=[],E=0,C,O;E<e;E++)if(O=n[E],C=this.isVisible(O,o,o,p),C===!0){if(O.displayed)O.show();else{var L=O.display(this.request).then(function(I){I.show()},function(){O.hide()});m.push(L)}r.push(O)}else this.q.enqueue(O.destroy.bind(O)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250);return m.length?Promise.all(m).catch(function(I){g.reject(I)}):(g.resolve(),g.promise)}},{key:"check",value:function(l,p){var n=this,e=new d.defer,r=[],o=this.settings.axis==="horizontal",g=this.settings.offset||0;l&&o&&(g=l),p&&!o&&(g=p);var m=this._bounds,E=this.settings.direction==="rtl",C=o&&E?-1:1,O=o?this.scrollLeft:this.scrollTop*C,L=o?m.width:m.height,I=o?this.container.scrollWidth:this.container.scrollHeight,A=function(){var _=n.views.first(),R=_&&_.section.prev();R&&r.push(n.prepend(R))},B=function(){var _=n.views.last(),R=_&&_.section.next();R&&r.push(n.append(R))};O+L+g>=I&&(o&&E?A():B()),0>O-g&&(o&&E?B():A());var j=r.map(function(_){return _.displayed});return r.length?Promise.all(j).then(function(){if(n.layout.name==="pre-paginated"&&n.layout.props.spread)return n.check()}).then(function(){return n.update(g)},function(_){return _}):(this.q.enqueue(function(){this.update()}.bind(this)),e.resolve(!1),e.promise)}},{key:"trim",value:function(){for(var l=new d.defer,p=this.views.displayed(),n=p[0],e=p[p.length-1],r=this.views.indexOf(n),o=this.views.indexOf(e),g=this.views.slice(0,r),m=this.views.slice(o+1),E=0;E<g.length-1;E++)this.erase(g[E],g);for(var C=1;C<m.length;C++)this.erase(m[C]);return l.resolve(),l.promise}},{key:"erase",value:function(l,p){var n,e;this.settings.height?(n=this.container.scrollTop,e=this.container.scrollLeft):(n=window.scrollY,e=window.scrollX);var r=l.bounds();this.views.remove(l),p&&(this.settings.axis==="vertical"?this.scrollTo(0,n-r.height,!0):this.scrollTo(e-r.width,0,!0))}},{key:"addEventListeners",value:function(){window.addEventListener("unload",function(){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners()}},{key:"addScrollListeners",value:function(){var l;this.tick=d.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.height?(l=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft):(l=window,this.scrollTop=window.scrollY,this.scrollLeft=window.scrollX),l.addEventListener("scroll",this.onScroll.bind(this)),this._scrolled=(0,a.default)(this.scrolled.bind(this),30),this.didScroll=!1}},{key:"removeEventListeners",value:function(){var l;l=this.settings.height?this.container:window,l.removeEventListener("scroll",this.onScroll.bind(this))}},{key:"onScroll",value:function(){var l=Math.abs,p=void 0,n=void 0,e=this.settings.direction==="rtl"?-1:1;this.settings.height?(p=this.container.scrollTop,n=this.container.scrollLeft):(p=window.scrollY*e,n=window.scrollX*e),this.scrollTop=p,this.scrollLeft=n,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=l(p-this.prevScrollTop),this.scrollDeltaHorz+=l(n-this.prevScrollLeft),this.prevScrollTop=p,this.prevScrollLeft=n,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.didScroll=!1}},{key:"scrolled",value:function(){this.q.enqueue(function(){this.check()}.bind(this)),this.emit(t.EVENTS.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(t.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this))}},{key:"next",value:function(){var l=this.settings.direction,p=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(p,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}},{key:"prev",value:function(){var l=this.settings.direction,p=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(-p,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}},{key:"updateAxis",value:function(l,p){this.isPaginated||(l="vertical"),(p||l!==this.settings.axis)&&(this.settings.axis=l,this.stage&&this.stage.axis(l),this.viewSettings.axis=l,this.mapping&&this.mapping.axis(l),this.layout&&(l==="vertical"?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)),this.settings.infinite=l==="vertical")}}]),f}(s.default);b.default=h,N.exports=b.default},function(N,b,w){"use strict";(function(k){function T(o){return o&&o.__esModule?o:{default:o}}function x(o,g){return new y.default(o,g)}Object.defineProperty(b,"__esModule",{value:!0});var v=w(26),y=T(v),d=w(18),u=T(d),s=w(1),t=T(s),i=w(13),a=T(i),h=w(0),c=function(o){if(o&&o.__esModule)return o;var g={};if(o!=null)for(var m in o)Object.prototype.hasOwnProperty.call(o,m)&&(g[m]=o[m]);return g.default=o,g}(h);w(69);var f=w(20),l=T(f),p=w(14),n=T(p),e=w(24),r=T(e);x.VERSION="0.3",typeof k!="undefined"&&(k.EPUBJS_VERSION=x.VERSION),x.Book=y.default,x.Rendition=u.default,x.Contents=a.default,x.CFI=t.default,x.utils=c,b.default=x,N.exports=b.default}).call(b,w(8))},function(N,b,w){"use strict";function k(M){return M&&M.__esModule?M:{default:M}}function T(M,P){if(!(M instanceof P))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},v=function(){function M(P,z){for(var D=0,U;D<z.length;D++)U=z[D],U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(P,U.key,U)}return function(P,z,D){return z&&M(P.prototype,z),D&&M(P,D),P}}(),y=w(2),d=k(y),u=w(0),s=w(5),t=k(s),i=w(4),a=k(i),h=w(42),c=k(h),f=w(44),l=k(f),p=w(45),n=k(p),e=w(46),r=k(e),o=w(47),g=k(o),m=w(48),E=k(m),C=w(49),O=k(C),L=w(18),I=k(L),A=w(67),B=k(A),j=w(11),_=k(j),R=w(1),q=k(R),S=w(3),F="META-INF/container.xml",V={BINARY:"binary",BASE64:"base64",EPUB:"epub",OPF:"opf",MANIFEST:"json",DIRECTORY:"directory"},W=function(){function M(P,z){var D=this;T(this,M),typeof z=="undefined"&&(typeof P=="undefined"?"undefined":x(P))==="object"&&(z=P,P=void 0),this.settings=(0,u.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0}),(0,u.extend)(this.settings,z),this.opening=new u.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new u.defer,spine:new u.defer,metadata:new u.defer,cover:new u.defer,navigation:new u.defer,pageList:new u.defer,resources:new u.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources]),this.isRendered=!1,this.request=this.settings.requestMethod||_.default,this.spine=new c.default,this.locations=new l.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,P&&this.open(P).catch(function(){var U=new Error("Cannot load book at "+P);D.emit(S.EVENTS.BOOK.OPEN_FAILED,U)})}return v(M,[{key:"open",value:function(P,z){var D=z||this.determineType(P),U;return D===V.BINARY?(this.archived=!0,this.url=new t.default("/",""),U=this.openEpub(P)):D===V.BASE64?(this.archived=!0,this.url=new t.default("/",""),U=this.openEpub(P,D)):D===V.EPUB?(this.archived=!0,this.url=new t.default("/",""),U=this.request(P,"binary").then(this.openEpub.bind(this))):D==V.OPF?(this.url=new t.default(P),U=this.openPackaging(this.url.Path.toString())):D==V.MANIFEST?(this.url=new t.default(P),U=this.openManifest(this.url.Path.toString())):(this.url=new t.default(P),U=this.openContainer(F).then(this.openPackaging.bind(this))),U}},{key:"openEpub",value:function(P,z){var D=this;return this.unarchive(P,z||this.settings.encoding).then(function(){return D.openContainer(F)}).then(function(U){return D.openPackaging(U)})}},{key:"openContainer",value:function(P){var z=this;return this.load(P).then(function(D){return z.container=new n.default(D),z.resolve(z.container.packagePath)})}},{key:"openPackaging",value:function(P){var z=this;return this.path=new a.default(P),this.load(P).then(function(D){return z.packaging=new r.default(D),z.unpack(z.packaging)})}},{key:"openManifest",value:function(P){var z=this;return this.path=new a.default(P),this.load(P).then(function(D){return z.packaging=new r.default,z.packaging.load(D),z.unpack(z.packaging)})}},{key:"load",value:function(P){var z;return this.archived?(z=this.resolve(P),this.archive.request(z)):(z=this.resolve(P),this.request(z,null,this.settings.requestCredentials,this.settings.requestHeaders))}},{key:"resolve",value:function(P,z){if(P){var D=P,U=-1<P.indexOf("://");return U?P:(this.path&&(D=this.path.resolve(P)),z!=!1&&this.url&&(D=this.url.resolve(D)),D)}}},{key:"canonical",value:function(P){var z=P;return P?(z=this.settings.canonical?this.settings.canonical(P):this.resolve(P,!0),z):""}},{key:"determineType",value:function(P){var z,D,U;return this.settings.encoding==="base64"?V.BASE64:typeof P=="string"?(z=new t.default(P),D=z.path(),U=D.extension,U?U==="epub"?V.EPUB:U==="opf"?V.OPF:U==="json"?V.MANIFEST:void 0:V.DIRECTORY):V.BINARY}},{key:"unpack",value:function(P){var z=this;this.package=P,this.spine.unpack(this.package,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new E.default(this.package.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")}),this.loadNavigation(this.package).then(function(){z.loading.navigation.resolve(z.navigation)}),this.package.coverPath&&(this.cover=this.resolve(this.package.coverPath)),this.loading.manifest.resolve(this.package.manifest),this.loading.metadata.resolve(this.package.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&this.settings.replacements!="none"?this.replacements().then(function(){z.opening.resolve(z)}).catch(function(D){console.error(D)}):this.opening.resolve(this)}},{key:"loadNavigation",value:function(P){var z=this,D=P.navPath||P.ncxPath,U=P.toc;return U?new Promise(function(X){z.navigation=new g.default(U),P.pageList&&(z.pageList=new O.default(P.pageList)),X(z.navigation)}):D?this.load(D,"xml").then(function(X){return z.navigation=new g.default(X),z.pageList=new O.default(X),z.navigation}):new Promise(function(X){z.navigation=new g.default,z.pageList=new O.default,X(z.navigation)})}},{key:"section",value:function(P){return this.spine.get(P)}},{key:"renderTo",value:function(P,z){return this.rendition=new I.default(this,z),this.rendition.attachTo(P),this.rendition}},{key:"setRequestCredentials",value:function(P){this.settings.requestCredentials=P}},{key:"setRequestHeaders",value:function(P){this.settings.requestHeaders=P}},{key:"unarchive",value:function(P,z){return this.archive=new B.default,this.archive.open(P,z)}},{key:"coverUrl",value:function(){var P=this,z=this.loaded.cover.then(function(){return P.archived?P.resources.get(P.cover):P.cover});return z}},{key:"replacements",value:function(){var P=this;return this.spine.hooks.serialize.register(function(z,D){D.output=P.resources.substitute(z,D.url)}),this.resources.replacements().then(function(){return P.resources.replaceCss()})}},{key:"getRange",value:function(P){var z=new q.default(P),D=this.spine.get(z.spinePos),U=this.load.bind(this);return D?D.load(U).then(function(){var X=z.toRange(D.document);return X}):new Promise(function(X,Q){Q("CFI could not be found")})}},{key:"key",value:function(P){var z=P||this.package.metadata.identifier||this.url.filename;return"epubjs:0.3:"+z}},{key:"destroy",value:function(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}]),M}();(0,d.default)(W.prototype),b.default=W,N.exports=b.default},function(N,b,w){"use strict";var k=w(28),T=w(36),x=w(37),v=w(38),y;y=N.exports=function(d,u){var s,t,i,a,h;return 2>arguments.length||typeof d!="string"?(a=u,u=d,d=null):a=arguments[2],d==null?(s=i=!0,t=!1):(s=v.call(d,"c"),t=v.call(d,"e"),i=v.call(d,"w")),h={value:u,configurable:s,enumerable:t,writable:i},a?k(T(a),h):h},y.gs=function(d,u,s){var t,i,a,h;return typeof d=="string"?a=arguments[3]:(a=s,s=u,u=d,d=null),u==null?u=void 0:x(u)?s==null?s=void 0:!x(s)&&(a=s,s=void 0):(a=u,u=s=void 0),d==null?(t=!0,i=!1):(t=v.call(d,"c"),i=v.call(d,"e")),h={get:u,set:s,configurable:t,enumerable:i},a?k(T(a),h):h}},function(N,b,w){"use strict";N.exports=w(29)()?Object.assign:w(30)},function(N){"use strict";N.exports=function(){var b=Object.assign,w;return typeof b=="function"&&(w={foo:"raz"},b(w,{bar:"dwa"},{trzy:"trzy"}),w.foo+w.bar+w.trzy==="razdwatrzy")}},function(N,b,w){"use strict";var k=w(31),T=w(35);N.exports=function(x,v){var y=$(arguments.length,2),d,u,s;for(x=Object(T(x)),s=function(t){try{x[t]=v[t]}catch(i){d||(d=i)}},u=1;u<y;++u)v=arguments[u],k(v).forEach(s);if(d!==void 0)throw d;return x}},function(N,b,w){"use strict";N.exports=w(32)()?Object.keys:w(33)},function(N){"use strict";N.exports=function(){try{return Object.keys("primitive"),!0}catch(b){return!1}}},function(N,b,w){"use strict";var k=w(9),T=Object.keys;N.exports=function(x){return T(k(x)?Object(x):x)}},function(N){"use strict";N.exports=function(){}},function(N,b,w){"use strict";var k=w(9);N.exports=function(T){if(!k(T))throw new TypeError("Cannot use null or undefined");return T}},function(N,b,w){"use strict";var k=w(9),T=Array.prototype.forEach,x=Object.create,v=function(y,d){for(var u in y)d[u]=y[u]};N.exports=function(){var y=x(null);return T.call(arguments,function(d){k(d)&&v(Object(d),y)}),y}},function(N){"use strict";N.exports=function(b){return typeof b=="function"}},function(N,b,w){"use strict";N.exports=w(39)()?J.contains:w(40)},function(N){"use strict";var b="razdwatrzy";N.exports=function(){return typeof b.contains=="function"&&b.contains("dwa")===!0&&b.contains("foo")===!1}},function(N){"use strict";var b=J.indexOf;N.exports=function(w){return-1<b.call(this,w,arguments[1])}},function(N){"use strict";N.exports=function(b){if(typeof b!="function")throw new TypeError(b+" is not a function");return b}},function(N,b,w){"use strict";function k(h){return h&&h.__esModule?h:{default:h}}function T(h,c){if(!(h instanceof c))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function h(c,f){for(var l=0,p;l<f.length;l++)p=f[l],p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(c,p.key,p)}return function(c,f,l){return f&&h(c.prototype,f),l&&h(c,l),c}}(),v=w(1),y=k(v),d=w(10),u=k(d),s=w(43),t=k(s),i=w(7),a=function(){function h(){T(this,h),this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new u.default,this.hooks.content=new u.default,this.hooks.content.register(i.replaceBase),this.hooks.content.register(i.replaceCanonical),this.hooks.content.register(i.replaceMeta),this.epubcfi=new y.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}return x(h,[{key:"unpack",value:function(c,f,l){var p=this;this.items=c.spine,this.manifest=c.manifest,this.spineNodeIndex=c.spineNodeIndex,this.baseUrl=c.baseUrl||c.basePath||"",this.length=this.items.length,this.items.forEach(function(n,e){var r=p.manifest[n.idref],o;n.index=e,n.cfiBase=p.epubcfi.generateChapterComponent(p.spineNodeIndex,n.index,n.idref),n.href&&(n.url=f(n.href,!0),n.canonical=l(n.href)),r&&(n.href=r.href,n.url=f(n.href,!0),n.canonical=l(n.href),r.properties.length&&n.properties.push.apply(n.properties,r.properties)),n.linear==="yes"?(n.prev=function(){for(var g=n.index,m;0<g;){if(m=this.get(g-1),m&&m.linear)return m;g-=1}}.bind(p),n.next=function(){for(var g=n.index,m;g<this.spineItems.length-1;){if(m=this.get(g+1),m&&m.linear)return m;g+=1}}.bind(p)):(n.prev=function(){},n.next=function(){}),o=new t.default(n,p.hooks),p.append(o)}),this.loaded=!0}},{key:"get",value:function(c){var f=0;if(typeof c=="undefined")for(;f<this.spineItems.length;){var l=this.spineItems[f];if(l&&l.linear)break;f+=1}else if(this.epubcfi.isCfiString(c)){var p=new y.default(c);f=p.spinePos}else typeof c=="number"||isNaN(c)===!1?f=c:typeof c=="string"&&c.indexOf("#")===0?f=this.spineById[c.substring(1)]:typeof c=="string"&&(c=c.split("#")[0],f=this.spineByHref[c]||this.spineByHref[encodeURI(c)]);return this.spineItems[f]||null}},{key:"append",value:function(c){var f=this.spineItems.length;return c.index=f,this.spineItems.push(c),this.spineByHref[decodeURI(c.href)]=f,this.spineByHref[encodeURI(c.href)]=f,this.spineByHref[c.href]=f,this.spineById[c.idref]=f,f}},{key:"prepend",value:function(c){return this.spineByHref[c.href]=0,this.spineById[c.idref]=0,this.spineItems.forEach(function(f,l){f.index=l}),0}},{key:"remove",value:function(c){var f=this.spineItems.indexOf(c);if(-1<f)return delete this.spineByHref[c.href],delete this.spineById[c.idref],this.spineItems.splice(f,1)}},{key:"each",value:function(){return this.spineItems.forEach.apply(this.spineItems,arguments)}},{key:"first",value:function(){var c=0;do{var f=this.get(c);if(f&&f.linear)return f;c+=1}while(c<this.spineItems.length)}},{key:"last",value:function(){var c=this.spineItems.length-1;do{var f=this.get(c);if(f&&f.linear)return f;c-=1}while(0<=c)}},{key:"destroy",value:function(){this.each(function(c){return c.destroy()}),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}]),h}();b.default=a,N.exports=b.default},function(N,b,w){"use strict";function k(a){return a&&a.__esModule?a:{default:a}}function T(a,h){if(!(a instanceof h))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function a(h,c){for(var f=0,l;f<c.length;f++)l=c[f],l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(h,l.key,l)}return function(h,c,f){return c&&a(h.prototype,c),f&&a(h,f),h}}(),v=w(0),y=w(1),d=k(y),u=w(10),s=k(u),t=w(7),i=function(){function a(h,c){T(this,a),this.idref=h.idref,this.linear=h.linear==="yes",this.properties=h.properties,this.index=h.index,this.href=h.href,this.url=h.url,this.canonical=h.canonical,this.next=h.next,this.prev=h.prev,this.cfiBase=h.cfiBase,c?this.hooks=c:(this.hooks={},this.hooks.serialize=new s.default(this),this.hooks.content=new s.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}return x(a,[{key:"load",value:function(h){var c=h||this.request||w(11),f=new v.defer,l=f.promise;return this.contents?f.resolve(this.contents):c(this.url).then(function(p){return this.document=p,this.contents=p.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){f.resolve(this.contents)}.bind(this)).catch(function(p){f.reject(p)}),l}},{key:"base",value:function(){return(0,t.replaceBase)(this.document,this)}},{key:"render",value:function(h){var c=new v.defer,f=c.promise;return this.output,this.load(h).then(function(l){var p=typeof navigator!="undefined"&&navigator.userAgent||"",n=0<=p.indexOf("Trident"),e;e=typeof XMLSerializer=="undefined"||n?w(16).XMLSerializer:XMLSerializer;var r=new e;return this.output=r.serializeToString(l),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){c.resolve(this.output)}.bind(this)).catch(function(l){c.reject(l)}),f}},{key:"find",value:function(h){var c=this,f=[],l=h.toLowerCase(),p=function(n){for(var e=n.textContent.toLowerCase(),r=c.document.createRange(),o=-1,g=150,m,E,C;E!=-1;)E=e.indexOf(l,o+1),E!=-1&&(r=c.document.createRange(),r.setStart(n,E),r.setEnd(n,E+l.length),m=c.cfiFromRange(r),n.textContent.length<g?C=n.textContent:(C=n.textContent.substring(E-g/2,E+g/2),C="..."+C+"..."),f.push({cfi:m,excerpt:C})),o=E};return(0,v.sprint)(c.document,function(n){p(n)}),f}},{key:"reconcileLayoutSettings",value:function(h){var c={layout:h.layout,spread:h.spread,orientation:h.orientation};return this.properties.forEach(function(f){var l=f.replace("rendition:",""),p=l.indexOf("-"),n,e;p!=-1&&(n=l.slice(0,p),e=l.slice(p+1),c[n]=e)}),c}},{key:"cfiFromRange",value:function(h){return new d.default(h,this.cfiBase).toString()}},{key:"cfiFromElement",value:function(h){return new d.default(h,this.cfiBase).toString()}},{key:"unload",value:function(){this.document=void 0,this.contents=void 0,this.output=void 0}},{key:"destroy",value:function(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}]),a}();b.default=i,N.exports=b.default},function(N,b,w){"use strict";function k(c){return c&&c.__esModule?c:{default:c}}function T(c,f){if(!(c instanceof f))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function c(f,l){for(var p=0,n;p<l.length;p++)n=l[p],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}return function(f,l,p){return l&&c(f.prototype,l),p&&c(f,p),f}}(),v=w(0),y=w(12),d=k(y),u=w(1),s=k(u),t=w(3),i=w(2),a=k(i),h=function(){function c(f,l,p){T(this,c),this.spine=f,this.request=l,this.pause=p||100,this.q=new d.default(this),this.epubcfi=new s.default,this._locations=[],this.total=0,this.break=150,this._current=0,this.currentLocation="",this._currentCfi="",this.processingTimeout=void 0}return x(c,[{key:"generate",value:function(f){return f&&(this.break=f),this.q.pause(),this.spine.each(function(l){l.linear&&this.q.enqueue(this.process.bind(this),l)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}},{key:"createRange",value:function(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}},{key:"process",value:function(f){return f.load(this.request).then(function(l){var p=new v.defer,n=this.parse(l,f.cfiBase);return this._locations=this._locations.concat(n),f.unload(),this.processingTimeout=setTimeout(function(){return p.resolve(n)},this.pause),p.promise}.bind(this))}},{key:"parse",value:function(f,l,p){var n=[],e=f.ownerDocument,r=(0,v.qs)(e,"body"),o=0,g=p||this.break,m,E;if((0,v.sprint)(r,function(O){var L=O.length,I=0,A;if(O.textContent.trim().length===0)return!1;for(o==0&&(m=this.createRange(),m.startContainer=O,m.startOffset=0),A=g-o,A>L&&(o+=L,I=L);I<L;)if(A=g-o,o===0&&(I+=1,m=this.createRange(),m.startContainer=O,m.startOffset=I),I+A>=L)o+=L-I,I=L;else{I+=A,m.endContainer=O,m.endOffset=I;var B=new s.default(m,l).toString();n.push(B),o=0}E=O}.bind(this)),m&&m.startContainer&&E){m.endContainer=E,m.endOffset=E.length;var C=new s.default(m,l).toString();n.push(C),o=0}return n}},{key:"locationFromCfi",value:function(f){var l;return s.default.prototype.isCfiString(f)&&(f=new s.default(f)),this._locations.length===0?-1:(l=(0,v.locationOf)(f,this._locations,this.epubcfi.compare),l>this.total?this.total:l)}},{key:"percentageFromCfi",value:function(f){if(this._locations.length===0)return null;var l=this.locationFromCfi(f);return this.percentageFromLocation(l)}},{key:"percentageFromLocation",value:function(f){return f&&this.total?f/this.total:0}},{key:"cfiFromLocation",value:function(f){var l=-1;return typeof f!="number"&&(f=parseInt(f)),0<=f&&f<this._locations.length&&(l=this._locations[f]),l}},{key:"cfiFromPercentage",value:function(f){var l;if(1<f&&console.warn("Normalize cfiFromPercentage value to between 0 - 1"),1<=f){var p=new s.default(this._locations[this.total]);return p.collapse(),p.toString()}return l=G(this.total*f),this.cfiFromLocation(l)}},{key:"load",value:function(f){return this._locations=typeof f=="string"?JSON.parse(f):f,this.total=this._locations.length-1,this._locations}},{key:"save",value:function(){return JSON.stringify(this._locations)}},{key:"getCurrent",value:function(){return this._current}},{key:"setCurrent",value:function(f){var l;if(typeof f=="string")this._currentCfi=f;else if(typeof f=="number")this._current=f;else return;this._locations.length===0||(typeof f=="string"?(l=this.locationFromCfi(f),this._current=l):l=f,this.emit(t.EVENTS.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(l)}))}},{key:"length",value:function(){return this._locations.length}},{key:"destroy",value:function(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}},{key:"currentLocation",get:function(){return this._current},set:function(f){this.setCurrent(f)}}]),c}();(0,a.default)(h.prototype),b.default=h,N.exports=b.default},function(N,b,w){"use strict";function k(u,s){if(!(u instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function u(s,t){for(var i=0,a;i<t.length;i++)a=t[i],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}return function(s,t,i){return t&&u(s.prototype,t),i&&u(s,i),s}}(),x=w(6),v=function(u){return u&&u.__esModule?u:{default:u}}(x),y=w(0),d=function(){function u(s){k(this,u),this.packagePath="",this.directory="",this.encoding="",s&&this.parse(s)}return T(u,[{key:"parse",value:function(s){var t;if(!s)throw new Error("Container File Not Found");if(t=(0,y.qs)(s,"rootfile"),!t)throw new Error("No RootFile Found");this.packagePath=t.getAttribute("full-path"),this.directory=v.default.dirname(this.packagePath),this.encoding=s.xmlEncoding}},{key:"destroy",value:function(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}]),u}();b.default=d,N.exports=b.default},function(N,b,w){"use strict";function k(y,d){if(!(y instanceof d))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function y(d,u){for(var s=0,t;s<u.length;s++)t=u[s],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}return function(d,u,s){return u&&y(d.prototype,u),s&&y(d,s),d}}(),x=w(0),v=function(){function y(d){k(this,y),this.manifest={},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.metadata={},d&&this.parse(d)}return T(y,[{key:"parse",value:function(d){var u,s,t;if(!d)throw new Error("Package File Not Found");if(u=(0,x.qs)(d,"metadata"),!u)throw new Error("No Metadata Found");if(s=(0,x.qs)(d,"manifest"),!s)throw new Error("No Manifest Found");if(t=(0,x.qs)(d,"spine"),!t)throw new Error("No Spine Found");return this.manifest=this.parseManifest(s),this.navPath=this.findNavPath(s),this.ncxPath=this.findNcxPath(s,t),this.coverPath=this.findCoverPath(d),this.spineNodeIndex=(0,x.indexOfElementNode)(t),this.spine=this.parseSpine(t,this.manifest),this.metadata=this.parseMetadata(u),this.metadata.direction=t.getAttribute("page-progression-direction"),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}},{key:"parseMetadata",value:function(d){var u={title:this.getElementText(d,"title"),creator:this.getElementText(d,"creator"),description:this.getElementText(d,"description"),pubdate:this.getElementText(d,"date"),publisher:this.getElementText(d,"publisher"),identifier:this.getElementText(d,"identifier"),language:this.getElementText(d,"language"),rights:this.getElementText(d,"rights"),modified_date:this.getPropertyText(d,"dcterms:modified"),layout:this.getPropertyText(d,"rendition:layout"),orientation:this.getPropertyText(d,"rendition:orientation"),flow:this.getPropertyText(d,"rendition:flow"),viewport:this.getPropertyText(d,"rendition:viewport")};return u}},{key:"parseManifest",value:function(d){var u={},s=(0,x.qsa)(d,"item"),t=Array.prototype.slice.call(s);return t.forEach(function(i){var a=i.getAttribute("id"),h=i.getAttribute("href")||"",c=i.getAttribute("media-type")||"",f=i.getAttribute("properties")||"";u[a]={href:h,type:c,properties:f.length?f.split(" "):[]}}),u}},{key:"parseSpine",value:function(d){var u=[],s=(0,x.qsa)(d,"itemref"),t=Array.prototype.slice.call(s);return t.forEach(function(i,a){var h=i.getAttribute("idref"),c=i.getAttribute("properties")||"",f=c.length?c.split(" "):[],l={idref:h,linear:i.getAttribute("linear")||"yes",properties:f,index:a};u.push(l)}),u}},{key:"findNavPath",value:function(d){var u=(0,x.qsp)(d,"item",{properties:"nav"});return!!u&&u.getAttribute("href")}},{key:"findNcxPath",value:function(d,u){var s=(0,x.qsp)(d,"item",{"media-type":"application/x-dtbncx+xml"}),t;return s||(t=u.getAttribute("toc"),t&&(s=d.getElementById(t))),!!s&&s.getAttribute("href")}},{key:"findCoverPath",value:function(d){var u=(0,x.qs)(d,"package"),s=u.getAttribute("version");if(s==="2.0"){var t=(0,x.qsp)(d,"meta",{name:"cover"});if(t){var i=t.getAttribute("content"),a=d.getElementById(i);return a?a.getAttribute("href"):""}return!1}var h=(0,x.qsp)(d,"item",{properties:"cover-image"});return h?h.getAttribute("href"):""}},{key:"getElementText",value:function(d,u){var s=d.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",u),t;return s&&s.length!==0?(t=s[0],t.childNodes.length?t.childNodes[0].nodeValue:""):""}},{key:"getPropertyText",value:function(d,u){var s=(0,x.qsp)(d,"meta",{property:u});return s&&s.childNodes.length?s.childNodes[0].nodeValue:""}},{key:"load",value:function(d){var u=this;return this.metadata=d.metadata,this.spine=d.spine.map(function(s,t){return s.index=t,s}),d.resources.forEach(function(s,t){u.manifest[t]=s,s.rel&&s.rel[0]==="cover"&&(u.coverPath=s.href)}),this.spineNodeIndex=0,this.toc=d.toc.map(function(s){return s.label=s.title,s}),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}},{key:"destroy",value:function(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}]),y}();b.default=v,N.exports=b.default},function(N,b,w){"use strict";function k(y,d){if(!(y instanceof d))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function y(d,u){for(var s=0,t;s<u.length;s++)t=u[s],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}return function(d,u,s){return u&&y(d.prototype,u),s&&y(d,s),d}}(),x=w(0),v=function(){function y(d){k(this,y),this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,d&&this.parse(d)}return T(y,[{key:"parse",value:function(d){var u=d.nodeType,s,t;u&&(s=(0,x.qs)(d,"html"),t=(0,x.qs)(d,"ncx")),u?s?(this.toc=this.parseNav(d),this.landmarks=this.parseLandmarks(d)):t&&(this.toc=this.parseNcx(d)):this.toc=this.load(d),this.length=0,this.unpack(this.toc)}},{key:"unpack",value:function(d){for(var u=0,s;u<d.length;u++)s=d[u],s.href&&(this.tocByHref[s.href]=u),s.id&&(this.tocById[s.id]=u),this.length++,s.subitems.length&&this.unpack(s.subitems)}},{key:"get",value:function(d){var u;return d?(d.indexOf("#")===0?u=this.tocById[d.substring(1)]:d in this.tocByHref&&(u=this.tocByHref[d]),this.toc[u]):this.toc}},{key:"landmark",value:function(d){var u;return d?(u=this.landmarksByType[d],this.landmarks[u]):this.landmarks}},{key:"parseNav",value:function(d){var u=(0,x.querySelectorByType)(d,"nav","toc"),s=u?(0,x.qsa)(u,"li"):[],t=s.length,i={},a=[],h,c,f;if(!s||t===0)return a;for(h=0;h<t;++h)c=this.navItem(s[h]),c&&(i[c.id]=c,c.parent?(f=i[c.parent],f.subitems.push(c)):a.push(c));return a}},{key:"navItem",value:function(d){var u=d.getAttribute("id")||void 0,s=(0,x.filterChildren)(d,"a",!0);if(s){var t=s.getAttribute("href")||"",i=s.textContent||"",a=(0,x.getParentByTagName)(d,"li"),h;for(a&&(h=a.getAttribute("id"));!h&&a;)a=(0,x.getParentByTagName)(a,"li"),a&&(h=a.getAttribute("id"));return{id:u,href:t,label:i,subitems:[],parent:h}}}},{key:"parseLandmarks",value:function(d){var u=(0,x.querySelectorByType)(d,"nav","landmarks"),s=u?(0,x.qsa)(u,"li"):[],t=s.length,i=[],a,h;if(!s||t===0)return i;for(a=0;a<t;++a)h=this.landmarkItem(s[a]),h&&(i.push(h),this.landmarksByType[h.type]=a);return i}},{key:"landmarkItem",value:function(d){var u=(0,x.filterChildren)(d,"a",!0);if(u){var s=u.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0,t=u.getAttribute("href")||"",i=u.textContent||"";return{href:t,label:i,type:s}}}},{key:"parseNcx",value:function(d){var u=(0,x.qsa)(d,"navPoint"),s=u.length,t={},i=[],a,h,c;if(!u||s===0)return i;for(a=0;a<s;++a)h=this.ncxItem(u[a]),t[h.id]=h,h.parent?(c=t[h.parent],c.subitems.push(h)):i.push(h);return i}},{key:"ncxItem",value:function(d){var u=d.getAttribute("id")||!1,s=(0,x.qs)(d,"content"),t=s.getAttribute("src"),i=(0,x.qs)(d,"navLabel"),a=i.textContent?i.textContent:"",h=d.parentNode,c;return h&&h.nodeName==="navPoint"&&(c=h.getAttribute("id")),{id:u,href:t,label:a,subitems:[],parent:c}}},{key:"load",value:function(d){var u=this;return d.map(function(s){return s.label=s.title,s.children&&(s.subitems=u.load(s.children)),s})}},{key:"forEach",value:function(d){return this.toc.forEach(d)}}]),y}();b.default=v,N.exports=b.default},function(N,b,w){"use strict";function k(l){return l&&l.__esModule?l:{default:l}}function T(l,p){if(!(l instanceof p))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function l(p,n){for(var e=0,r;e<n.length;e++)r=n[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(p,r.key,r)}return function(p,n,e){return n&&l(p.prototype,n),e&&l(p,e),p}}(),v=w(7),y=w(0),d=w(5),u=k(d),s=w(17),t=k(s),i=w(4),a=k(i),h=w(6),c=k(h),f=function(){function l(p,n){T(this,l),this.settings={replacements:n&&n.replacements||"base64",archive:n&&n.archive,resolver:n&&n.resolver,request:n&&n.request},this.manifest=p,this.resources=Object.keys(p).map(function(e){return p[e]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}return x(l,[{key:"split",value:function(){this.html=this.resources.filter(function(p){if(p.type==="application/xhtml+xml"||p.type==="text/html")return!0}),this.assets=this.resources.filter(function(p){if(p.type!=="application/xhtml+xml"&&p.type!=="text/html")return!0}),this.css=this.resources.filter(function(p){if(p.type==="text/css")return!0})}},{key:"splitUrls",value:function(){this.urls=this.assets.map(function(p){return p.href}.bind(this)),this.cssUrls=this.css.map(function(p){return p.href})}},{key:"createUrl",value:function(p){var n=new u.default(p),e=t.default.lookup(n.filename);return this.settings.archive?this.settings.archive.createUrl(p,{base64:this.settings.replacements==="base64"}):this.settings.replacements==="base64"?this.settings.request(p,"blob").then(function(r){return(0,y.blob2base64)(r)}).then(function(r){return(0,y.createBase64Url)(r,e)}):this.settings.request(p,"blob").then(function(r){return(0,y.createBlobUrl)(r,e)})}},{key:"replacements",value:function(){var p=this;if(this.settings.replacements==="none")return new Promise(function(e){e(this.urls)}.bind(this));var n=this.urls.map(function(e){var r=p.settings.resolver(e);return p.createUrl(r).catch(function(o){return console.error(o),null})});return Promise.all(n).then(function(e){return p.replacementUrls=e.filter(function(r){return typeof r=="string"}),e})}},{key:"replaceCss",value:function(p,n){var e=[];return p=p||this.settings.archive,n=n||this.settings.resolver,this.cssUrls.forEach(function(r){var o=this.createCssFile(r,p,n).then(function(g){var m=this.urls.indexOf(r);-1<m&&(this.replacementUrls[m]=g)}.bind(this));e.push(o)}.bind(this)),Promise.all(e)}},{key:"createCssFile",value:function(p){var n=this,e;if(c.default.isAbsolute(p))return new Promise(function(m){m()});var r=this.settings.resolver(p),o;o=this.settings.archive?this.settings.archive.getText(r):this.settings.request(r,"text");var g=this.urls.map(function(m){var E=n.settings.resolver(m),C=new a.default(r).relative(E);return C});return o?o.then(function(m){return m=(0,v.substitute)(m,g,n.replacementUrls),e=n.settings.replacements==="base64"?(0,y.createBase64Url)(m,"text/css"):(0,y.createBlobUrl)(m,"text/css"),e},function(){return new Promise(function(m){m()})}):new Promise(function(m){m()})}},{key:"relativeTo",value:function(p,n){return n=n||this.settings.resolver,this.urls.map(function(e){var r=n(e),o=new a.default(p).relative(r);return o}.bind(this))}},{key:"get",value:function(p){var n=this.urls.indexOf(p);return n===-1?void 0:this.replacementUrls.length?new Promise(function(e){e(this.replacementUrls[n])}.bind(this)):this.createUrl(p)}},{key:"substitute",value:function(p,n){var e;return e=n?this.relativeTo(n):this.urls,(0,v.substitute)(p,e,this.replacementUrls)}},{key:"destroy",value:function(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}]),l}();b.default=f,N.exports=b.default},function(N,b,w){"use strict";function k(u,s){if(!(u instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function u(s,t){for(var i=0,a;i<t.length;i++)a=t[i],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}return function(s,t,i){return t&&u(s.prototype,t),i&&u(s,i),s}}(),x=w(1),v=function(u){return u&&u.__esModule?u:{default:u}}(x),y=w(0),d=function(){function u(s){k(this,u),this.pages=[],this.locations=[],this.epubcfi=new v.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,s&&(this.pageList=this.parse(s)),this.pageList&&this.pageList.length&&this.process(this.pageList)}return T(u,[{key:"parse",value:function(s){var t=(0,y.qs)(s,"html"),i=(0,y.qs)(s,"ncx");return t?this.parseNav(s):void 0}},{key:"parseNav",value:function(s){var t=(0,y.querySelectorByType)(s,"nav","page-list"),i=t?(0,y.qsa)(t,"li"):[],a=i.length,h=[],c,f;if(!i||a===0)return h;for(c=0;c<a;++c)f=this.item(i[c]),h.push(f);return h}},{key:"item",value:function(s){var t=(0,y.qs)(s,"a"),i=t.getAttribute("href")||"",a=t.textContent||"",h=parseInt(a),c=i.indexOf("epubcfi"),f,l,p;return c==-1?{href:i,page:h}:(f=i.split("#"),l=f[0],p=1<f.length&&f[1],{cfi:p,href:i,packageUrl:l,page:h})}},{key:"process",value:function(s){s.forEach(function(t){this.pages.push(t.page),t.cfi&&this.locations.push(t.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}},{key:"pageFromCfi",value:function(s){var t=-1;if(this.locations.length===0)return-1;var i=(0,y.indexOfSorted)(s,this.locations,this.epubcfi.compare);return i==-1?(i=(0,y.locationOf)(s,this.locations,this.epubcfi.compare),t=0<=i-1?this.pages[i-1]:this.pages[0],t!==void 0||(t=-1)):t=this.pages[i],t}},{key:"cfiFromPage",value:function(s){var t=-1;typeof s!="number"&&(s=parseInt(s));var i=this.pages.indexOf(s);return i!=-1&&(t=this.locations[i]),t}},{key:"pageFromPercentage",value:function(s){var t=H(this.totalPages*s);return t}},{key:"percentageFromPage",value:function(s){var t=(s-this.firstPage)/this.totalPages;return H(1e3*t)/1e3}},{key:"percentageFromCfi",value:function(s){var t=this.pageFromCfi(s),i=this.percentageFromPage(t);return i}},{key:"destroy",value:function(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}]),u}();b.default=d,N.exports=b.default},function(N,b,w){"use strict";function k(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function s(t,i){for(var a=0,h;a<i.length;a++)h=i[a],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}return function(t,i,a){return i&&s(t.prototype,i),a&&s(t,a),t}}(),x=w(0),v=w(3),y=w(2),d=function(s){return s&&s.__esModule?s:{default:s}}(y),u=function(){function s(t){k(this,s),this.settings=t,this.name=t.layout||"reflowable",this._spread=t.spread!=="none",this._minSpreadWidth=t.minSpreadWidth||800,this._evenSpreads=t.evenSpreads||!1,this._flow=t.flow==="scrolled"||t.flow==="scrolled-continuous"||t.flow==="scrolled-doc"?"scrolled":"paginated",this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}return T(s,[{key:"flow",value:function(t){return typeof t!="undefined"&&(this._flow=t==="scrolled"||t==="scrolled-continuous"||t==="scrolled-doc"?"scrolled":"paginated",this.update({flow:this._flow})),this._flow}},{key:"spread",value:function(t,i){return t&&(this._spread=t!=="none",this.update({spread:this._spread})),0<=i&&(this._minSpreadWidth=i),this._spread}},{key:"calculate",value:function(t,i,a){var h=1,c=a||0,f=t,l=i,p=K(f/12),n,e,r,o;h=this._spread&&f>=this._minSpreadWidth?2:1,this.name!=="reflowable"||this._flow!=="paginated"||0<=a||(c=p%2==0?p:p-1),this.name==="pre-paginated"&&(c=0),1<h?(n=f/h-c,r=n+c):(n=f,r=f),this.name==="pre-paginated"&&1<h&&(f=n),e=n*h+c,o=f,this.width=f,this.height=l,this.spreadWidth=e,this.pageWidth=r,this.delta=o,this.columnWidth=n,this.gap=c,this.divisor=h,this.update({width:f,height:l,spreadWidth:e,pageWidth:r,delta:o,columnWidth:n,gap:c,divisor:h})}},{key:"format",value:function(t){var i;return i=this.name==="pre-paginated"?t.fit(this.columnWidth,this.height):this._flow==="paginated"?t.columns(this.width,this.height,this.columnWidth,this.gap):t.size(this.width,null),i}},{key:"count",value:function(t,i){var a,h;return this.name==="pre-paginated"?(a=1,h=1):this._flow==="paginated"?(i=i||this.delta,a=G(t/i),h=a*this.divisor):(i=i||this.height,a=G(t/i),h=a),{spreads:a,pages:h}}},{key:"update",value:function(t){var i=this;if(Object.keys(t).forEach(function(h){i.props[h]===t[h]&&delete t[h]}),0<Object.keys(t).length){var a=(0,x.extend)(this.props,t);this.emit(v.EVENTS.LAYOUT.UPDATED,a,t)}}}]),s}();(0,d.default)(u.prototype),b.default=u,N.exports=b.default},function(N,b,w){"use strict";function k(u,s){if(!(u instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},x=function(){function u(s,t){for(var i=0,a;i<t.length;i++)a=t[i],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}return function(s,t,i){return t&&u(s.prototype,t),i&&u(s,i),s}}(),v=w(5),y=function(u){return u&&u.__esModule?u:{default:u}}(v),d=function(){function u(s){k(this,u),this.rendition=s,this._themes={default:{rules:{},url:"",serialized:""}},this._overrides={},this._current="default",this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}return x(u,[{key:"register",value:function(){return arguments.length===0?void 0:arguments.length===1&&T(arguments[0])==="object"?this.registerThemes(arguments[0]):arguments.length===1&&typeof arguments[0]=="string"?this.default(arguments[0]):arguments.length===2&&typeof arguments[1]=="string"?this.registerUrl(arguments[0],arguments[1]):arguments.length===2&&T(arguments[1])==="object"?this.registerRules(arguments[0],arguments[1]):void 0}},{key:"default",value:function(s){return s?typeof s=="string"?this.registerUrl("default",s):(typeof s=="undefined"?"undefined":T(s))==="object"?this.registerRules("default",s):void 0:void 0}},{key:"registerThemes",value:function(s){for(var t in s)s.hasOwnProperty(t)&&(typeof s[t]=="string"?this.registerUrl(t,s[t]):this.registerRules(t,s[t]))}},{key:"registerUrl",value:function(s,t){var i=new y.default(t);this._themes[s]={url:i.toString()},this._injected[s]&&this.update(s)}},{key:"registerRules",value:function(s,t){this._themes[s]={rules:t},this._injected[s]&&this.update(s)}},{key:"select",value:function(s){var t=this._current,i;this._current=s,this.update(s),i=this.rendition.getContents(),i.forEach(function(a){a.removeClass(t),a.addClass(s)})}},{key:"update",value:function(s){var t=this,i=this.rendition.getContents();i.forEach(function(a){t.add(s,a)})}},{key:"inject",value:function(s){var t=[],i=this._themes,a;for(var h in i)i.hasOwnProperty(h)&&(h===this._current||h=="default")&&(a=i[h],(a.rules&&0<Object.keys(a.rules).length||a.url&&t.indexOf(a.url)===-1)&&this.add(h,s),this._injected.push(h));this._current!="default"&&s.addClass(this._current)}},{key:"add",value:function(s,t){var i=this._themes[s];i&&t&&(i.url?t.addStylesheet(i.url):i.serialized||i.rules&&(t.addStylesheetRules(i.rules),i.injected=!0))}},{key:"override",value:function(s,t){var i=this,a=this.rendition.getContents();this._overrides[s]=t,a.forEach(function(h){h.css(s,i._overrides[s])})}},{key:"overrides",value:function(s){var t=this._overrides;for(var i in t)t.hasOwnProperty(i)&&s.css(i,t[i])}},{key:"fontSize",value:function(s){this.override("font-size",s)}},{key:"font",value:function(s){this.override("font-family",s)}},{key:"destroy",value:function(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}]),u}();b.default=d,N.exports=b.default},function(N,b,w){"use strict";function k(i){return i&&i.__esModule?i:{default:i}}function T(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function i(a,h){for(var c=0,f;c<h.length;c++)f=h[c],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(a,f.key,f)}return function(a,h,c){return h&&i(a.prototype,h),c&&i(a,c),a}}(),v=w(2),y=k(v),d=w(1),u=k(d),s=function(){function i(a){T(this,i),this.rendition=a,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}return x(i,[{key:"add",value:function(a,h,c,f){var l=encodeURI(h),p=new u.default(h),n=p.spinePos,e=new t({type:a,cfiRange:h,data:c,sectionIndex:n,cb:f});this._annotations[l]=e,n in this._annotationsBySectionIndex?this._annotationsBySectionIndex[n].push(l):this._annotationsBySectionIndex[n]=[l];var r=this.rendition.views();return r.forEach(function(o){e.sectionIndex===o.index&&e.attach(o)}),e}},{key:"remove",value:function(a,h){var c=this,f=encodeURI(a);if(f in this._annotations){var l=this._annotations[f];if(h&&l.type!==h)return;var p=this.rendition.views();p.forEach(function(n){c._removeFromAnnotationBySectionIndex(l.sectionIndex,f),l.sectionIndex===n.index&&l.detach(n)}),delete this._annotations[f]}}},{key:"_removeFromAnnotationBySectionIndex",value:function(a,h){this._annotationsBySectionIndex[a]=this._annotationsAt(a).filter(function(c){return c!==h})}},{key:"_annotationsAt",value:function(a){return this._annotationsBySectionIndex[a]}},{key:"highlight",value:function(a,h,c){this.add("highlight",a,h,c)}},{key:"underline",value:function(a,h,c){this.add("underline",a,h,c)}},{key:"mark",value:function(a,h,c){this.add("mark",a,h,c)}},{key:"each",value:function(){return this._annotations.forEach.apply(this._annotations,arguments)}},{key:"inject",value:function(a){var h=this,c=a.index;if(c in this._annotationsBySectionIndex){var f=this._annotationsBySectionIndex[c];f.forEach(function(l){var p=h._annotations[l];p.attach(a)})}}},{key:"clear",value:function(a){var h=this,c=a.index;if(c in this._annotationsBySectionIndex){var f=this._annotationsBySectionIndex[c];f.forEach(function(l){var p=h._annotations[l];p.detach(a)})}}},{key:"show",value:function(){}},{key:"hide",value:function(){}}]),i}(),t=function(){function i(a){var h=a.type,c=a.cfiRange,f=a.data,l=a.sectionIndex,p=a.cb;T(this,i),this.type=h,this.cfiRange=c,this.data=f,this.sectionIndex=l,this.mark=void 0,this.cb=p}return x(i,[{key:"update",value:function(a){this.data=a}},{key:"attach",value:function(a){var h=this.cfiRange,c=this.data,f=this.type,l=this.mark,p=this.cb,n;return f==="highlight"?n=a.highlight(h,c,p):f==="underline"?n=a.underline(h,c,p):f==="mark"&&(n=a.mark(h,c,p)),this.mark=n,n}},{key:"detach",value:function(a){var h=this.cfiRange,c=this.type,f;return a&&(c==="highlight"?f=a.unhighlight(h):c==="underline"?f=a.ununderline(h):c==="mark"&&(f=a.unmark(h))),this.mark=void 0,f}},{key:"text",value:function(){}}]),i}();(0,y.default)(t.prototype),b.default=s,N.exports=b.default},function(N,b,w){"use strict";function k(r){return r&&r.__esModule?r:{default:r}}function T(r,o){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&((typeof o=="undefined"?"undefined":s(o))==="object"||typeof o=="function")?o:r}function x(r,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof o=="undefined"?"undefined":s(o)));r.prototype=Object.create(o&&o.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(r,o):r.__proto__=o)}function v(r,o){if(!(r instanceof o))throw new TypeError("Cannot call a class as a function")}function y(r,o){var g=o.getBoundingClientRect(),m=r.getBoundingClientRect();return{top:m.top-g.top,left:m.left-g.left,height:r.scrollHeight,width:r.scrollWidth}}function d(r,o){r.style.top=o.top+"px",r.style.left=o.left+"px",r.style.height=o.height+"px",r.style.width=o.width+"px"}function u(r,o){return o.right<=r.right&&o.left>=r.left&&o.top>=r.top&&o.bottom<=r.bottom}var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};Object.defineProperty(b,"__esModule",{value:!0}),b.Underline=b.Highlight=b.Mark=b.Pane=void 0;var t=function r(o,g,m){o===null&&(o=Function.prototype);var E=Object.getOwnPropertyDescriptor(o,g);if(E===void 0){var C=Object.getPrototypeOf(o);return C===null?void 0:r(C,g,m)}if("value"in E)return E.value;var O=E.get;return O===void 0?void 0:O.call(m)},i=function(){function r(o,g){for(var m=0,E;m<g.length;m++)E=g[m],E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(o,E.key,E)}return function(o,g,m){return g&&r(o.prototype,g),m&&r(o,m),o}}(),a=w(54),h=k(a),c=w(55),f=k(c),l=b.Pane=function(){function r(o){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:document.body;v(this,r),this.target=o,this.element=h.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),f.default.proxyMouse(this.target,this.marks),this.container=g,this.container.appendChild(this.element),this.render()}return i(r,[{key:"addMark",value:function(o){var g=h.default.createElement("g");return this.element.appendChild(g),o.bind(g,this.container),this.marks.push(o),o.render(),o}},{key:"removeMark",value:function(o){var g=this.marks.indexOf(o);if(g!==-1){var m=o.unbind();this.element.removeChild(m),this.marks.splice(g,1)}}},{key:"render",value:function(){d(this.element,y(this.target,this.container));var o=!0,g=!1,m;try{for(var E=this.marks[Symbol.iterator](),C,O;!(o=(C=E.next()).done);o=!0)O=C.value,O.render()}catch(L){g=!0,m=L}finally{try{!o&&E.return&&E.return()}finally{if(g)throw m}}}}]),r}(),p=b.Mark=function(){function r(){v(this,r),this.element=null}return i(r,[{key:"bind",value:function(o,g){this.element=o,this.container=g}},{key:"unbind",value:function(){var o=this.element;return this.element=null,o}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(o){this.element&&this.element.dispatchEvent(o)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var o=[],g=this.element.firstChild;g;)o.push(g.getBoundingClientRect()),g=g.nextSibling;return o}},{key:"filteredRanges",value:function(){var o=Array.from(this.range.getClientRects());return o.filter(function(g){for(var m=0;m<o.length;m++){if(o[m]===g)return!0;var E=u(o[m],g);if(E)return!1}return!0})}}]),r}(),n=b.Highlight=function(r){function o(g,m,E,C){v(this,o);var O=T(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return O.range=g,O.className=m,O.data=E||{},O.attributes=C||{},O}return x(o,r),i(o,[{key:"bind",value:function(g,m){for(var E in t(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"bind",this).call(this,g,m),this.data)this.data.hasOwnProperty(E)&&(this.element.dataset[E]=this.data[E]);for(var E in this.attributes)this.attributes.hasOwnProperty(E)&&this.element.setAttribute(E,this.attributes[E]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var g=this.element.ownerDocument.createDocumentFragment(),m=this.filteredRanges(),E=this.element.getBoundingClientRect(),C=this.container.getBoundingClientRect(),O=0,L=m.length;O<L;O++){var I=m[O],A=h.default.createElement("rect");A.setAttribute("x",I.left-E.left+C.left),A.setAttribute("y",I.top-E.top+C.top),A.setAttribute("height",I.height),A.setAttribute("width",I.width),g.appendChild(A)}this.element.appendChild(g)}}]),o}(p),e=b.Underline=function(r){function o(g,m,E,C){return v(this,o),T(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,g,m,E,C))}return x(o,r),i(o,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var g=this.element.ownerDocument.createDocumentFragment(),m=this.filteredRanges(),E=this.element.getBoundingClientRect(),C=this.container.getBoundingClientRect(),O=0,L=m.length;O<L;O++){var I=m[O],A=h.default.createElement("rect");A.setAttribute("x",I.left-E.left+C.left),A.setAttribute("y",I.top-E.top+C.top),A.setAttribute("height",I.height),A.setAttribute("width",I.width),A.setAttribute("fill","none");var B=h.default.createElement("line");B.setAttribute("x1",I.left-E.left+C.left),B.setAttribute("x2",I.left-E.left+C.left+I.width),B.setAttribute("y1",I.top-E.top+C.top+I.height-1),B.setAttribute("y2",I.top-E.top+C.top+I.height-1),B.setAttribute("stroke-width",1),B.setAttribute("stroke","black"),B.setAttribute("stroke-linecap","square"),g.appendChild(A),g.appendChild(B)}this.element.appendChild(g)}}]),o}(n)},function(N,b){"use strict";function w(k){return document.createElementNS("http://www.w3.org/2000/svg",k)}Object.defineProperty(b,"__esModule",{value:!0}),b.createElement=w,b.default={createElement:w}},function(N,b){"use strict";function w(x,v){function y(t){for(var i=v.length-1;0<=i;i--){var a=v[i],h=t.clientX,c=t.clientY;if(t.touches&&t.touches.length&&(h=t.touches[0].clientX,c=t.touches[0].clientY),!!T(a,x,h,c)){a.dispatchEvent(k(t));break}}}if(x.nodeName==="iframe"||x.nodeName==="IFRAME")try{this.target=x.contentDocument}catch(t){this.target=x}else this.target=x;for(var d=["mouseup","mousedown","click","touchstart"],u=0,s;u<d.length;u++)s=d[u],this.target.addEventListener(s,function(t){return y(t)},!1)}function k(x){var v=Object.assign({},x,{bubbles:!1});try{return new MouseEvent(x.type,v)}catch(d){var y=document.createEvent("MouseEvents");return y.initMouseEvent(x.type,!1,v.cancelable,v.view,v.detail,v.screenX,v.screenY,v.clientX,v.clientY,v.ctrlKey,v.altKey,v.shiftKey,v.metaKey,v.button,v.relatedTarget),y}}function T(x,v,y,d){function u(c,f,l){var p=c.top-s.top,n=c.left-s.left,e=p+c.height,r=n+c.width;return p<=l&&n<=f&&e>l&&r>f}var s=v.getBoundingClientRect(),t=x.getBoundingClientRect();if(!u(t,y,d))return!1;for(var i=x.getClientRects(),a=0,h=i.length;a<h;a++)if(u(i[a],y,d))return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0}),b.proxyMouse=w,b.clone=k,b.default={proxyMouse:w}},function(N,b,w){"use strict";function k(u,s){if(!(u instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var T=function(){function u(s,t){for(var i=0,a;i<t.length;i++)a=t[i],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}return function(s,t,i){return t&&u(s.prototype,t),i&&u(s,i),s}}(),x=w(0),v=w(57),y=function(u){return u&&u.__esModule?u:{default:u}}(v),d=function(){function u(s){k(this,u),this.settings=s||{},this.id="epubjs-container-"+(0,x.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}return T(u,[{key:"create",value:function(s){var t=s.height,i=s.width,a=s.overflow||!1,h=s.axis||"vertical",c=s.direction;s.height&&(0,x.isNumber)(s.height)&&(t=s.height+"px"),s.width&&(0,x.isNumber)(s.width)&&(i=s.width+"px");var f=document.createElement("div");return f.id=this.id,f.classList.add("epub-container"),f.style.wordSpacing="0",f.style.lineHeight="0",f.style.verticalAlign="top",f.style.position="relative",h==="horizontal"&&(f.style.display="flex",f.style.flexDirection="row",f.style.flexWrap="nowrap"),i&&(f.style.width=i),t&&(f.style.height=t),a&&(f.style.overflow=a),c&&(f.dir=c,f.style.direction=c),c&&this.settings.fullsize&&(document.body.style.direction=c),f}},{key:"wrap",value:function(s){var t=document.createElement("div");return t.style.visibility="hidden",t.style.overflow="hidden",t.style.width="0",t.style.height="0",t.appendChild(s),t}},{key:"getElement",value:function(s){var t;if((0,x.isElement)(s)?t=s:typeof s=="string"&&(t=document.getElementById(s)),!t)throw new Error("Not an Element");return t}},{key:"attachTo",value:function(s){var t=this.getElement(s),i;if(t)return i=this.settings.hidden?this.wrapper:this.container,t.appendChild(i),this.element=t,t}},{key:"getContainer",value:function(){return this.container}},{key:"onResize",value:function(s){(0,x.isNumber)(this.settings.width)&&(0,x.isNumber)(this.settings.height)||(this.resizeFunc=(0,y.default)(s,50),window.addEventListener("resize",this.resizeFunc,!1))}},{key:"onOrientationChange",value:function(s){this.orientationChangeFunc=s,window.addEventListener("orientationchange",this.orientationChangeFunc,!1)}},{key:"size",value:function(s,t){var i;s===null&&(i=this.element.getBoundingClientRect(),i.width&&(s=i.width,this.container.style.width=i.width+"px")),t===null&&(i=i||this.element.getBoundingClientRect(),i.height&&(t=i.height,this.container.style.height=i.height+"px")),(0,x.isNumber)(s)||(i=this.container.getBoundingClientRect(),s=i.width),(0,x.isNumber)(t)||(i=i||this.container.getBoundingClientRect(),t=i.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};var a=(0,x.windowBounds)();return s||(s=a.width),(this.settings.fullsize||!t)&&(t=a.height),{width:s-this.containerPadding.left-this.containerPadding.right,height:t-this.containerPadding.top-this.containerPadding.bottom}}},{key:"bounds",value:function(){var s;return this.container.style.overflow!=="visible"&&(s=this.container&&this.container.getBoundingClientRect()),s&&s.width&&s.height?s:(0,x.windowBounds)()}},{key:"getSheet",value:function(){var s=document.createElement("style");return s.appendChild(document.createTextNode("")),document.head.appendChild(s),s.sheet}},{key:"addStyleRules",value:function(s,t){var i="#"+this.id+" ",a="";this.sheet||(this.sheet=this.getSheet()),t.forEach(function(h){for(var c in h)h.hasOwnProperty(c)&&(a+=c+":"+h[c]+";")}),this.sheet.insertRule(i+s+" {"+a+"}",0)}},{key:"axis",value:function(s){s==="horizontal"?(this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.flexWrap="nowrap"):this.container.style.display="block"}},{key:"direction",value:function(s){this.container&&(this.container.dir=s,this.container.style.direction=s),this.settings.fullsize&&(document.body.style.direction=s)}},{key:"destroy",value:function(){var s;this.element&&(s=this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener("resize",this.resizeFunc),window.removeEventListener("orientationChange",this.orientationChangeFunc))}}]),u}();b.default=d,N.exports=b.default},function(N,b,w){var k=w(21),T=w(15);N.exports=function(x,v,y){var d=!0,u=!0;if(typeof x!="function")throw new TypeError("Expected a function");return T(y)&&(d="leading"in y?!!y.leading:d,u="trailing"in y?!!y.trailing:u),k(x,v,{leading:d,maxWait:v,trailing:u})}},function(N,b,w){var k=w(22);N.exports=function(){return k.Date.now()}},function(N,b,w){(function(k){var T=typeof k=="object"&&k&&k.Object===Object&&k;N.exports=T}).call(b,w(8))},function(N,b,w){var k=w(15),T=w(61),x=0/0,v=/^\s+|\s+$/g,y=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,u=/^0o[0-7]+$/i,s=parseInt;N.exports=function(t){if(typeof t=="number")return t;if(T(t))return x;if(k(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=k(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=t.replace(v,"");var a=d.test(t);return a||u.test(t)?s(t.slice(2),a?2:8):y.test(t)?x:+t}},function(N,b,w){var k=w(62),T=w(65);N.exports=function(x){return typeof x=="symbol"||T(x)&&k(x)=="[object Symbol]"}},function(N,b,w){var k=w(23),T=w(63),x=w(64),v=k?k.toStringTag:void 0;N.exports=function(y){return y==null?y===void 0?"[object Undefined]":"[object Null]":v&&v in Object(y)?T(y):x(y)}},function(N,b,w){var k=w(23),T=Object.prototype,x=T.hasOwnProperty,v=T.toString,y=k?k.toStringTag:void 0;N.exports=function(d){var u=x.call(d,y),s=d[y];try{d[y]=void 0}catch(i){}var t=v.call(d);return u?d[y]=s:delete d[y],t}},function(N){var b=Object.prototype,w=b.toString;N.exports=function(k){return w.call(k)}},function(N){N.exports=function(b){return b!=null&&typeof b=="object"}},function(N,b){"use strict";function w(x,v){if(!(x instanceof v))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var k=function(){function x(v,y){for(var d=0,u;d<y.length;d++)u=y[d],u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(v,u.key,u)}return function(v,y,d){return y&&x(v.prototype,y),d&&x(v,d),v}}(),T=function(){function x(v){w(this,x),this.container=v,this._views=[],this.length=0,this.hidden=!1}return k(x,[{key:"all",value:function(){return this._views}},{key:"first",value:function(){return this._views[0]}},{key:"last",value:function(){return this._views[this._views.length-1]}},{key:"indexOf",value:function(v){return this._views.indexOf(v)}},{key:"slice",value:function(){return this._views.slice.apply(this._views,arguments)}},{key:"get",value:function(v){return this._views[v]}},{key:"append",value:function(v){return this._views.push(v),this.container&&this.container.appendChild(v.element),this.length++,v}},{key:"prepend",value:function(v){return this._views.unshift(v),this.container&&this.container.insertBefore(v.element,this.container.firstChild),this.length++,v}},{key:"insert",value:function(v,y){return this._views.splice(y,0,v),this.container&&(y<this.container.children.length?this.container.insertBefore(v.element,this.container.children[y]):this.container.appendChild(v.element)),this.length++,v}},{key:"remove",value:function(v){var y=this._views.indexOf(v);-1<y&&this._views.splice(y,1),this.destroy(v),this.length--}},{key:"destroy",value:function(v){v.displayed&&v.destroy(),this.container&&this.container.removeChild(v.element),v=null}},{key:"forEach",value:function(){return this._views.forEach.apply(this._views,arguments)}},{key:"clear",value:function(){var v=this.length,y;if(this.length){for(var d=0;d<v;d++)y=this._views[d],this.destroy(y);this._views=[],this.length=0}}},{key:"find",value:function(v){for(var y=this.length,d=0,u;d<y;d++)if(u=this._views[d],u.displayed&&u.section.index==v.index)return u}},{key:"displayed",value:function(){for(var v=[],y=this.length,d=0,u;d<y;d++)u=this._views[d],u.displayed&&v.push(u);return v}},{key:"show",value:function(){for(var v=this.length,y=0,d;y<v;y++)d=this._views[y],d.displayed&&d.show();this.hidden=!1}},{key:"hide",value:function(){for(var v=this.length,y=0,d;y<v;y++)d=this._views[y],d.displayed&&d.hide();this.hidden=!0}}]),x}();b.default=T,N.exports=b.default},function(N,b,w){"use strict";function k(h){return h&&h.__esModule?h:{default:h}}function T(h,c){if(!(h instanceof c))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){function h(c,f){for(var l=0,p;l<f.length;l++)p=f[l],p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(c,p.key,p)}return function(c,f,l){return f&&h(c.prototype,f),l&&h(c,l),c}}(),v=w(0),y=w(11),d=k(y),u=w(17),s=k(u),t=w(4),i=k(t),a=function(){function h(){T(this,h),this.zip=void 0,this.urlCache={},this.checkRequirements()}return x(h,[{key:"checkRequirements",value:function(){try{if(typeof JSZip=="undefined"){var c=w(68);this.zip=new c}else this.zip=new JSZip}catch(f){throw new Error("JSZip lib not loaded")}}},{key:"open",value:function(c,f){return this.zip.loadAsync(c,{base64:f})}},{key:"openUrl",value:function(c,f){return(0,d.default)(c,"binary").then(function(l){return this.zip.loadAsync(l,{base64:f})}.bind(this))}},{key:"request",value:function(c,f){var l=new v.defer,p=new i.default(c),n;return f||(f=p.extension),n=f=="blob"?this.getBlob(c):this.getText(c),n?n.then(function(e){var r=this.handleResponse(e,f);l.resolve(r)}.bind(this)):l.reject({message:"File not found in the epub: "+c,stack:new Error().stack}),l.promise}},{key:"handleResponse",value:function(c,f){var l;return l=f=="json"?JSON.parse(c):(0,v.isXml)(f)?(0,v.parse)(c,"text/xml"):f=="xhtml"?(0,v.parse)(c,"application/xhtml+xml"):f=="html"||f=="htm"?(0,v.parse)(c,"text/html"):c,l}},{key:"getBlob",value:function(c,f){var l=window.decodeURIComponent(c.substr(1)),p=this.zip.file(l);if(p)return f=f||s.default.lookup(p.name),p.async("uint8array").then(function(n){return new Blob([n],{type:f})})}},{key:"getText",value:function(c){var f=window.decodeURIComponent(c.substr(1)),l=this.zip.file(f);if(l)return l.async("string").then(function(p){return p})}},{key:"getBase64",value:function(c,f){var l=window.decodeURIComponent(c.substr(1)),p=this.zip.file(l);if(p)return f=f||s.default.lookup(p.name),p.async("base64").then(function(n){return"data:"+f+";base64,"+n})}},{key:"createUrl",value:function(c,f){var l=new v.defer,p=window.URL||window.webkitURL||window.mozURL,n=f&&f.base64,e,r;return c in this.urlCache?(l.resolve(this.urlCache[c]),l.promise):(n?(r=this.getBase64(c),r&&r.then(function(o){this.urlCache[c]=o,l.resolve(o)}.bind(this))):(r=this.getBlob(c),r&&r.then(function(o){e=p.createObjectURL(o),this.urlCache[c]=e,l.resolve(e)}.bind(this))),r||l.reject({message:"File not found in the epub: "+c,stack:new Error().stack}),l.promise)}},{key:"revokeUrl",value:function(c){var f=window.URL||window.webkitURL||window.mozURL,l=this.urlCache[c];l&&f.revokeObjectURL(l)}},{key:"destroy",value:function(){var c=window.URL||window.webkitURL||window.mozURL;for(var f in this.urlCache)c.revokeObjectURL(f);this.zip=void 0,this.urlCache={}}}]),h}();b.default=a,N.exports=b.default},function(N){if(typeof Y=="undefined"){var b=new Error('Cannot find module "jszip"');throw b.code="MODULE_NOT_FOUND",b}N.exports=Y},function(N,b,w){"use strict";(function(k,T){var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},v,y,d;(function(u,s){u||(u=window||k),x(T)==="object"&&T.exports?T.exports=s(u):(y=[],v=s,d=typeof v=="function"?v.apply(b,y):v,d!==void 0&&(T.exports=d))})(void 0,function(u){function s(C){return e[C]!==void 0}function t(){f.call(this),this._isInvalid=!0}function i(C){return C==""&&t.call(this),C.toLowerCase()}function a(C){var O=C.charCodeAt(0);return 32<O&&127>O&&[34,35,60,62,63,96].indexOf(O)==-1?C:encodeURIComponent(C)}function h(C){var O=C.charCodeAt(0);return 32<O&&127>O&&[34,35,60,62,96].indexOf(O)==-1?C:encodeURIComponent(C)}function c(C,O,L){function I(U){q.push(U)}var A=O||"scheme start",B=0,j="",_=!1,R=!1,q=[];t:for(;(C[B-1]!=m||B==0)&&!this._isInvalid;){var S=C[B];switch(A){case"scheme start":if(S&&o.test(S))j+=S.toLowerCase(),A="scheme";else if(O){I("Invalid scheme.");break t}else{j="",A="no scheme";continue}break;case"scheme":if(S&&g.test(S))j+=S.toLowerCase();else if(S==":"){if(this._scheme=j,j="",O)break t;s(this._scheme)&&(this._isRelative=!0),A=this._scheme=="file"?"relative":this._isRelative&&L&&L._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}else if(O){if(m==S)break t;I("Code point not allowed in scheme: "+S);break t}else{j="",B=0,A="no scheme";continue}break;case"scheme data":S=="?"?(this._query="?",A="query"):S=="#"?(this._fragment="#",A="fragment"):m!=S&&S!="	"&&S!=`
`&&S!="\r"&&(this._schemeData+=a(S));break;case"no scheme":if(!L||!s(L._scheme))I("Missing scheme."),t.call(this);else{A="relative";continue}break;case"relative or authority":if(S=="/"&&C[B+1]=="/")A="authority ignore slashes";else{I("Expected /, got: "+S),A="relative";continue}break;case"relative":if(this._isRelative=!0,this._scheme!="file"&&(this._scheme=L._scheme),m==S){this._host=L._host,this._port=L._port,this._path=L._path.slice(),this._query=L._query,this._username=L._username,this._password=L._password;break t}else if(S=="/"||S=="\\")S=="\\"&&I("\\ is an invalid code point."),A="relative slash";else if(S=="?")this._host=L._host,this._port=L._port,this._path=L._path.slice(),this._query="?",this._username=L._username,this._password=L._password,A="query";else if(S=="#")this._host=L._host,this._port=L._port,this._path=L._path.slice(),this._query=L._query,this._fragment="#",this._username=L._username,this._password=L._password,A="fragment";else{var F=C[B+1],V=C[B+2];this._scheme=="file"&&o.test(S)&&(F==":"||F=="|")&&(m==V||V=="/"||V=="\\"||V=="?"||V=="#")||(this._host=L._host,this._port=L._port,this._username=L._username,this._password=L._password,this._path=L._path.slice(),this._path.pop()),A="relative path";continue}break;case"relative slash":if(S=="/"||S=="\\")S=="\\"&&I("\\ is an invalid code point."),A=this._scheme=="file"?"file host":"authority ignore slashes";else{this._scheme!="file"&&(this._host=L._host,this._port=L._port,this._username=L._username,this._password=L._password),A="relative path";continue}break;case"authority first slash":if(S=="/")A="authority second slash";else{I("Expected '/', got: "+S),A="authority ignore slashes";continue}break;case"authority second slash":if(A="authority ignore slashes",S!="/"){I("Expected '/', got: "+S);continue}break;case"authority ignore slashes":if(S!="/"&&S!="\\"){A="authority";continue}else I("Expected authority, got: "+S);break;case"authority":if(S=="@"){_&&(I("@ already seen."),j+="%40"),_=!0;for(var W=0,M;W<j.length;W++){if(M=j[W],M=="	"||M==`
`||M=="\r"){I("Invalid whitespace in authority.");continue}if(M==":"&&this._password===null){this._password="";continue}var P=a(M);this._password===null?this._username+=P:this._password+=P}j=""}else if(m==S||S=="/"||S=="\\"||S=="?"||S=="#"){B-=j.length,j="",A="host";continue}else j+=S;break;case"file host":if(m==S||S=="/"||S=="\\"||S=="?"||S=="#"){j.length==2&&o.test(j[0])&&(j[1]==":"||j[1]=="|")?A="relative path":(j.length==0||(this._host=i.call(this,j),j=""),A="relative path start");continue}else S=="	"||S==`
`||S=="\r"?I("Invalid whitespace in file host."):j+=S;break;case"host":case"hostname":if(S==":"&&!R){if(this._host=i.call(this,j),j="",A="port",O=="hostname")break t}else if(m==S||S=="/"||S=="\\"||S=="?"||S=="#"){if(this._host=i.call(this,j),j="",A="relative path start",O)break t;continue}else S!="	"&&S!=`
`&&S!="\r"?(S=="["?R=!0:S=="]"&&(R=!1),j+=S):I("Invalid code point in host/hostname: "+S);break;case"port":if(/[0-9]/.test(S))j+=S;else if(m==S||S=="/"||S=="\\"||S=="?"||S=="#"||O){if(j!=""){var z=parseInt(j,10);z!=e[this._scheme]&&(this._port=z+""),j=""}if(O)break t;A="relative path start";continue}else S=="	"||S==`
`||S=="\r"?I("Invalid code point in port: "+S):t.call(this);break;case"relative path start":if(S=="\\"&&I("'\\' not allowed in path."),A="relative path",S!="/"&&S!="\\")continue;break;case"relative path":if(m==S||S=="/"||S=="\\"||!O&&(S=="?"||S=="#")){S=="\\"&&I("\\ not allowed in relative path.");var D;(D=r[j.toLowerCase()])&&(j=D),j==".."?(this._path.pop(),S!="/"&&S!="\\"&&this._path.push("")):j=="."&&S!="/"&&S!="\\"?this._path.push(""):j!="."&&(this._scheme=="file"&&this._path.length==0&&j.length==2&&o.test(j[0])&&j[1]=="|"&&(j=j[0]+":"),this._path.push(j)),j="",S=="?"?(this._query="?",A="query"):S=="#"&&(this._fragment="#",A="fragment")}else S!="	"&&S!=`
`&&S!="\r"&&(j+=a(S));break;case"query":O||S!="#"?m!=S&&S!="	"&&S!=`
`&&S!="\r"&&(this._query+=h(S)):(this._fragment="#",A="fragment");break;case"fragment":m!=S&&S!="	"&&S!=`
`&&S!="\r"&&(this._fragment+=S)}B++}}function f(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function l(C,O){O===void 0||O instanceof l||(O=new l(O+"")),this._url=C,f.call(this);var L=C.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");c.call(this,L,null,O)}var p=!1;if(!u.forceJURL)try{var n=new URL("b","http://a");n.pathname="c%20d",p=n.href==="http://a/c%20d"}catch(C){}if(p)return u.URL;var e=Object.create(null);e.ftp=21,e.file=0,e.gopher=70,e.http=80,e.https=443,e.ws=80,e.wss=443;var r=Object.create(null);r["%2e"]=".",r[".%2e"]="..",r["%2e."]="..",r["%2e%2e"]="..";var o=/[a-zA-Z]/,g=/[a-zA-Z0-9\+\-\.]/,m;l.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var C="";return(this._username!=""||this._password!=null)&&(C=this._username+(this._password==null?"":":"+this._password)+"@"),this.protocol+(this._isRelative?"//"+C+this.host:"")+this.pathname+this._query+this._fragment},set href(C){f.call(this),c.call(this,C)},get protocol(){return this._scheme+":"},set protocol(C){this._isInvalid||c.call(this,C+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(C){this._isInvalid||!this._isRelative||c.call(this,C,"host")},get hostname(){return this._host},set hostname(C){this._isInvalid||!this._isRelative||c.call(this,C,"hostname")},get port(){return this._port},set port(C){this._isInvalid||!this._isRelative||c.call(this,C,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(C){this._isInvalid||!this._isRelative||(this._path=[],c.call(this,C,"relative path start"))},get search(){return this._isInvalid||!this._query||this._query=="?"?"":this._query},set search(C){this._isInvalid||!this._isRelative||(this._query="?",C[0]=="?"&&(C=C.slice(1)),c.call(this,C,"query"))},get hash(){return this._isInvalid||!this._fragment||this._fragment=="#"?"":this._fragment},set hash(C){this._isInvalid||(this._fragment="#",C[0]=="#"&&(C=C.slice(1)),c.call(this,C,"fragment"))},get origin(){var C;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"file":return"file://";case"data":case"javascript":case"mailto":return"null"}return C=this.host,C?this._scheme+"://"+C:""}};var E=u.URL;return E&&(l.createObjectURL=function(){return E.createObjectURL.apply(E,arguments)},l.revokeObjectURL=function(C){E.revokeObjectURL(C)}),l})}).call(b,w(8),w(70)(N))},function(N){N.exports=function(b){return b.webpackPolyfill||(b.deprecate=function(){},b.paths=[],!b.children&&(b.children=[]),Object.defineProperty(b,"loaded",{enumerable:!0,get:function(){return b.l}}),Object.defineProperty(b,"id",{enumerable:!0,get:function(){return b.i}}),b.webpackPolyfill=1),b}}])});
