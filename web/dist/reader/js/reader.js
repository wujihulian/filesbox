/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2016 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.6.2
 */(function(r,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):n(r.RSVP=r.RSVP||{})})(this,function(r){"use strict";function n(e,t){for(var o=0,i=e.length;o<i;o++)if(e[o]===t)return o;return-1}function a(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}var s={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){if(typeof t!="function")throw new TypeError("Callback must be a function");var o=a(this),i=void 0;i=o[e],i||(i=o[e]=[]),n(i,t)===-1&&i.push(t)},off:function(e,t){var o=a(this),i=void 0,c=void 0;if(!t){o[e]=[];return}i=o[e],c=n(i,t),c!==-1&&i.splice(c,1)},trigger:function(e,t,o){var i=a(this),c=void 0,u=void 0;if(c=i[e])for(var v=0;v<c.length;v++)u=c[v],u(t,o)}},l={instrument:!1};s.mixin(l);function f(e,t){if(arguments.length===2)l[e]=t;else return l[e]}function h(e){var t=typeof e;return e!==null&&(t==="object"||t==="function")}function d(e){return typeof e=="function"}function g(e){return e!==null&&typeof e=="object"}function y(e){return e!==null&&typeof e=="object"}var p=void 0;Array.isArray?p=Array.isArray:p=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var b=p,w=Date.now||function(){return new Date().getTime()},C=[];function x(){setTimeout(function(){for(var e=0;e<C.length;e++){var t=C[e],o=t.payload;o.guid=o.key+o.id,o.childGuid=o.key+o.childId,o.error&&(o.stack=o.error.stack),l.trigger(t.name,t.payload)}C.length=0},50)}function R(e,t,o){C.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:o&&o._id,label:t._label,timeStamp:w(),error:l["instrument-with-stack"]?new Error(t._label):null}})===1&&x()}function _(e,t){var o=this;if(e&&typeof e=="object"&&e.constructor===o)return e;var i=new o(O,t);return I(i,e),i}function S(){return new TypeError("A promises callback cannot return that same promise.")}function O(){}var m=void 0,E=1,N=2,D=new Z;function z(e){try{return e.then}catch(t){return D.error=t,D}}function X(e,t,o,i){try{e.call(t,o,i)}catch(c){return c}}function ue(e,t,o){l.async(function(i){var c=!1,u=X(o,t,function(v){c||(c=!0,t!==v?I(i,v,void 0):A(i,v))},function(v){c||(c=!0,T(i,v))},"Settle: "+(i._label||" unknown promise"));!c&&u&&(c=!0,T(i,u))},e)}function q(e,t){t._state===E?A(e,t._result):t._state===N?(t._onError=null,T(e,t._result)):j(t,void 0,function(o){t!==o?I(e,o,void 0):A(e,o)},function(o){return T(e,o)})}function Y(e,t,o){var i=t.constructor===e.constructor&&o===te&&e.constructor.resolve===_;i?q(e,t):o===D?(T(e,D.error),D.error=null):d(o)?ue(e,t,o):A(e,t)}function I(e,t){e===t?A(e,t):h(t)?Y(e,t,z(t)):A(e,t)}function P(e){e._onError&&e._onError(e._result),K(e)}function A(e,t){e._state===m&&(e._result=t,e._state=E,e._subscribers.length===0?l.instrument&&R("fulfilled",e):l.async(K,e))}function T(e,t){e._state===m&&(e._state=N,e._result=t,l.async(P,e))}function j(e,t,o,i){var c=e._subscribers,u=c.length;e._onError=null,c[u]=t,c[u+E]=o,c[u+N]=i,u===0&&e._state&&l.async(K,e)}function K(e){var t=e._subscribers,o=e._state;if(l.instrument&&R(o===E?"fulfilled":"rejected",e),t.length!==0){for(var i=void 0,c=void 0,u=e._result,v=0;v<t.length;v+=3)i=t[v],c=t[v+o],i?de(o,i,c,u):c(u);e._subscribers.length=0}}function Z(){this.error=null}var ee=new Z;function ze(e,t){try{return e(t)}catch(o){return ee.error=o,ee}}function de(e,t,o,i){var c=d(o),u=void 0,v=void 0;if(c){if(u=ze(o,i),u===ee)v=u.error,u.error=null;else if(u===t){T(t,S());return}}else u=i;t._state!==m||(c&&v===void 0?I(t,u):v!==void 0?T(t,v):e===E?A(t,u):e===N&&T(t,u))}function Ke(e,t){var o=!1;try{t(function(i){o||(o=!0,I(e,i))},function(i){o||(o=!0,T(e,i))})}catch(i){T(e,i)}}function te(e,t,o){var i=this,c=i._state;if(c===E&&!e||c===N&&!t)return l.instrument&&R("chained",i,i),i;i._onError=null;var u=new i.constructor(O,o),v=i._result;if(l.instrument&&R("chained",i,u),c===m)j(i,u,e,t);else{var L=c===E?e:t;l.async(function(){return de(c,u,L,v)})}return u}var re=function(){function e(t,o,i,c){this._instanceConstructor=t,this.promise=new t(O,c),this._abortOnReject=i,this._init.apply(this,arguments)}return e.prototype._init=function(o,i){var c=i.length||0;this.length=c,this._remaining=c,this._result=new Array(c),this._enumerate(i),this._remaining===0&&A(this.promise,this._result)},e.prototype._enumerate=function(o){for(var i=this.length,c=this.promise,u=0;c._state===m&&u<i;u++)this._eachEntry(o[u],u)},e.prototype._settleMaybeThenable=function(o,i){var c=this._instanceConstructor,u=c.resolve;if(u===_){var v=z(o);if(v===te&&o._state!==m)o._onError=null,this._settledAt(o._state,i,o._result);else if(typeof v!="function")this._remaining--,this._result[i]=this._makeResult(E,i,o);else if(c===k){var L=new c(O);Y(L,o,v),this._willSettleAt(L,i)}else this._willSettleAt(new c(function(M){return M(o)}),i)}else this._willSettleAt(u(o),i)},e.prototype._eachEntry=function(o,i){y(o)?this._settleMaybeThenable(o,i):(this._remaining--,this._result[i]=this._makeResult(E,i,o))},e.prototype._settledAt=function(o,i,c){var u=this.promise;u._state===m&&(this._abortOnReject&&o===N?T(u,c):(this._remaining--,this._result[i]=this._makeResult(o,i,c),this._remaining===0&&A(u,this._result)))},e.prototype._makeResult=function(o,i,c){return c},e.prototype._willSettleAt=function(o,i){var c=this;j(o,void 0,function(u){return c._settledAt(E,i,u)},function(u){return c._settledAt(N,i,u)})},e}();function he(e,t,o){return e===E?{state:"fulfilled",value:o}:{state:"rejected",reason:o}}function He(e,t){return b(e)?new re(this,e,!0,t).promise:this.reject(new TypeError("Promise.all must be called with an array"),t)}function Xe(e,t){var o=this,i=new o(O,t);if(!b(e))return T(i,new TypeError("Promise.race must be called with an array")),i;for(var c=0;i._state===m&&c<e.length;c++)j(o.resolve(e[c]),void 0,function(u){return I(i,u)},function(u){return T(i,u)});return i}function Ve(e,t){var o=this,i=new o(O,t);return T(i,e),i}var qe="rsvp_"+w()+"-",Fe=0;function Ue(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Ge(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var k=function(){function e(t,o){this._id=Fe++,this._label=o,this._state=void 0,this._result=void 0,this._subscribers=[],l.instrument&&R("created",this),O!==t&&(typeof t!="function"&&Ue(),this instanceof e?Ke(this,t):Ge())}return e.prototype._onError=function(o){var i=this;l.after(function(){i._onError&&l.trigger("error",o,i._label)})},e.prototype.catch=function(o,i){return this.then(void 0,o,i)},e.prototype.finally=function(o,i){var c=this,u=c.constructor;return c.then(function(v){return u.resolve(o()).then(function(){return v})},function(v){return u.resolve(o()).then(function(){throw v})},i)},e}();k.cast=_,k.all=He,k.race=Xe,k.resolve=_,k.reject=Ve,k.prototype._guidKey=qe,k.prototype.then=te;function ve(){this.value=void 0}var F=new ve,pe=new ve;function Je(e){try{return e.then}catch(t){return F.value=t,F}}function ge(e,t,o){try{e.apply(t,o)}catch(i){return F.value=i,F}}function We(e,t){for(var o={},i=e.length,c=new Array(i),u=0;u<i;u++)c[u]=e[u];for(var v=0;v<t.length;v++){var L=t[v];o[L]=c[v+1]}return o}function Ye(e){for(var t=e.length,o=new Array(t-1),i=1;i<t;i++)o[i-1]=e[i];return o}function Qe(e,t){return{then:function(o,i){return e.call(t,o,i)}}}function me(e,t){var o=function(){for(var i=this,c=arguments.length,u=new Array(c+1),v=!1,L=0;L<c;++L){var M=arguments[L];if(!v)if(v=tt(M),v===pe){var H=new k(O);return T(H,pe.value),H}else v&&v!==!0&&(M=Qe(v,M));u[L]=M}var B=new k(O);return u[c]=function(V,Be){V?T(B,V):t===void 0?I(B,Be):t===!0?I(B,Ye(arguments)):b(t)?I(B,We(arguments,t)):I(B,Be)},v?et(B,u,e,i):Ze(B,u,e,i)};return o.__proto__=e,o}function Ze(e,t,o,i){var c=ge(o,i,t);return c===F&&T(e,c.value),e}function et(e,t,o,i){return k.all(t).then(function(c){var u=ge(o,i,c);return u===F&&T(e,u.value),e})}function tt(e){return e&&typeof e=="object"?e.constructor===k?!0:Je(e):!1}function ye(e,t){return k.all(e,t)}function rt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e}function nt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var be=function(e){nt(t,e);function t(o,i,c){return rt(this,e.call(this,o,i,!1,c))}return t}(re);be.prototype._makeResult=he;function we(e,t){return b(e)?new be(k,e,t).promise:k.reject(new TypeError("Promise.allSettled must be called with an array"),t)}function ke(e,t){return k.race(e,t)}function ot(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e}function it(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var at=Object.prototype.hasOwnProperty,_e=function(e){it(t,e);function t(o,i){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,u=arguments[3];return ot(this,e.call(this,o,i,c,u))}return t.prototype._init=function(i,c){this._result={},this._enumerate(c),this._remaining===0&&A(this.promise,this._result)},t.prototype._enumerate=function(i){var c=this.promise,u=[];for(var v in i)at.call(i,v)&&u.push({position:v,entry:i[v]});var L=u.length;this._remaining=L;for(var M=void 0,H=0;c._state===m&&H<L;H++)M=u[H],this._eachEntry(M.entry,M.position)},t}(re);function Ce(e,t){return g(e)?new _e(k,e,t).promise:k.reject(new TypeError("Promise.hash must be called with an object"),t)}function st(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e}function lt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Ee=function(e){lt(t,e);function t(o,i,c){return st(this,e.call(this,o,i,!1,c))}return t}(_e);Ee.prototype._makeResult=he;function Se(e,t){return g(e)?new Ee(k,e,!1,t).promise:k.reject(new TypeError("RSVP.hashSettled must be called with an object"),t)}function xe(e){throw setTimeout(function(){throw e}),e}function Oe(e){var t={resolve:void 0,reject:void 0};return t.promise=new k(function(o,i){t.resolve=o,t.reject=i},e),t}function Re(e,t,o){return b(e)?d(t)?k.all(e,o).then(function(i){for(var c=i.length,u=new Array(c),v=0;v<c;v++)u[v]=t(i[v]);return k.all(u,o)}):k.reject(new TypeError("RSVP.map expects a function as a second argument"),o):k.reject(new TypeError("RSVP.map must be called with an array"),o)}function ne(e,t){return k.resolve(e,t)}function Te(e,t){return k.reject(e,t)}function oe(e,t){return k.all(e,t)}function ct(e,t){return k.resolve(e,t).then(function(o){return oe(o,t)})}function Pe(e,t,o){if(!b(e)&&!(g(e)&&e.then!==void 0))return k.reject(new TypeError("RSVP.filter must be called with an array or promise"),o);if(!d(t))return k.reject(new TypeError("RSVP.filter expects function as a second argument"),o);var i=b(e)?oe(e,o):ct(e,o);return i.then(function(c){for(var u=c.length,v=new Array(u),L=0;L<u;L++)v[L]=t(c[L]);return oe(v,o).then(function(M){for(var H=new Array(u),B=0,V=0;V<u;V++)M[V]&&(H[B]=c[V],B++);return H.length=B,H})})}var U=0,ie=void 0;function ae(e,t){G[U]=e,G[U+1]=t,U+=2,U===2&&J()}var $e=typeof window!="undefined"?window:void 0,Le=$e||{},Ne=Le.MutationObserver||Le.WebKitMutationObserver,ft=typeof self=="undefined"&&typeof process!="undefined"&&{}.toString.call(process)==="[object process]",ut=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";function dt(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&t[1]==="0"&&t[2]==="10"&&(e=setImmediate),function(){return e(W)}}function ht(){return typeof ie!="undefined"?function(){ie(W)}:se()}function vt(){var e=0,t=new Ne(W),o=document.createTextNode("");return t.observe(o,{characterData:!0}),function(){return o.data=e=++e%2}}function pt(){var e=new MessageChannel;return e.port1.onmessage=W,function(){return e.port2.postMessage(0)}}function se(){return function(){return setTimeout(W,1)}}var G=new Array(1e3);function W(){for(var e=0;e<U;e+=2){var t=G[e],o=G[e+1];t(o),G[e]=void 0,G[e+1]=void 0}U=0}function gt(){try{var e=require,t=e("vertx");return ie=t.runOnLoop||t.runOnContext,ht()}catch(o){return se()}}var J=void 0;ft?J=dt():Ne?J=vt():ut?J=pt():$e===void 0&&typeof require=="function"?J=gt():J=se();var Ae=void 0;if(typeof self=="object")Ae=self;else if(typeof global=="object")Ae=global;else throw new Error("no global: `self` or `global` found");var Q;function je(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}l.async=ae,l.after=function(e){return setTimeout(e,0)};var Me=ne,De=function(e,t){return l.async(e,t)};function le(){l.on.apply(l,arguments)}function Ie(){l.off.apply(l,arguments)}if(typeof window!="undefined"&&typeof window.__PROMISE_INSTRUMENTATION__=="object"){var ce=window.__PROMISE_INSTRUMENTATION__;f("instrument",!0);for(var fe in ce)ce.hasOwnProperty(fe)&&le(fe,ce[fe])}var mt=(Q={asap:ae,cast:Me,Promise:k,EventTarget:s,all:ye,allSettled:we,race:ke,hash:Ce,hashSettled:Se,rethrow:xe,defer:Oe,denodeify:me,configure:f,on:le,off:Ie,resolve:ne,reject:Te,map:Re},je(Q,"async",De),je(Q,"filter",Pe),Q);r.default=mt,r.asap=ae,r.cast=Me,r.Promise=k,r.EventTarget=s,r.all=ye,r.allSettled=we,r.race=ke,r.hash=Ce,r.hashSettled=Se,r.rethrow=xe,r.defer=Oe,r.denodeify=me,r.configure=f,r.on=le,r.off=Ie,r.resolve=ne,r.reject=Te,r.map=Re,r.async=De,r.filter=Pe,Object.defineProperty(r,"__esModule",{value:!0})});var EPUBJS=EPUBJS||{};EPUBJS.core={};var ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8,DOCUMENT_NODE=9;EPUBJS.core.getEl=function(r){return document.getElementById(r)},EPUBJS.core.getEls=function(r){return document.getElementsByClassName(r)},EPUBJS.core.request=function(r,n,a){var s=window.URL,l=s?"blob":"arraybuffer",f=new RSVP.defer,h=new XMLHttpRequest,d,g=XMLHttpRequest.prototype,y=function(){var p;this.readyState==this.DONE&&((this.status===200||this.status===0)&&this.response?(n=="xml"?this.responseXML?p=this.responseXML:p=new DOMParser().parseFromString(this.response,"application/xml"):n=="xhtml"?this.responseXML?p=this.responseXML:p=new DOMParser().parseFromString(this.response,"application/xhtml+xml"):n=="html"?this.responseXML?p=this.responseXML:p=new DOMParser().parseFromString(this.response,"text/html"):n=="json"?p=JSON.parse(this.response):n=="blob"?s?p=this.response:p=new Blob([this.response]):p=this.response,f.resolve(p)):f.reject({message:this.response,stack:new Error().stack}))};return"overrideMimeType"in g||Object.defineProperty(g,"overrideMimeType",{value:function(b){}}),h.onreadystatechange=y,h.open("GET",r,!0),a&&(h.withCredentials=!0),n||(d=EPUBJS.core.uri(r),n=d.extension,n={htm:"html"}[n]||n),n=="blob"&&(h.responseType=l),n=="json"&&h.setRequestHeader("Accept","application/json"),n=="xml"&&(h.responseType="document",h.overrideMimeType("text/xml")),n=="xhtml"&&(h.responseType="document"),n=="html"&&(h.responseType="document"),n=="binary"&&(h.responseType="arraybuffer"),h.send(),f.promise},EPUBJS.core.toArray=function(r){var n=[];for(var a in r){var s;r.hasOwnProperty(a)&&(s=r[a],s.ident=a,n.push(s))}return n},EPUBJS.core.uri=function(r){var n={protocol:"",host:"",path:"",origin:"",directory:"",base:"",filename:"",extension:"",fragment:"",href:r},a=r.indexOf("blob:"),s=r.indexOf("://"),l=r.indexOf("?"),f=r.indexOf("#"),h,d,g;return a===0?(n.protocol="blob",n.base=r.indexOf(0,f),n):(f!=-1&&(n.fragment=r.slice(f+1),r=r.slice(0,f)),l!=-1&&(n.search=r.slice(l+1),r=r.slice(0,l),href=n.href),s!=-1?(n.protocol=r.slice(0,s),h=r.slice(s+3),g=h.indexOf("/"),g===-1?(n.host=n.path,n.path=""):(n.host=h.slice(0,g),n.path=h.slice(g)),n.origin=n.protocol+"://"+n.host,n.directory=EPUBJS.core.folder(n.path),n.base=n.origin+n.directory):(n.path=r,n.directory=EPUBJS.core.folder(r),n.base=n.directory),n.filename=r.replace(n.base,""),d=n.filename.lastIndexOf("."),d!=-1&&(n.extension=n.filename.slice(d+1)),n)},EPUBJS.core.folder=function(r){var n=r.lastIndexOf("/");if(n==-1)var a="";return a=r.slice(0,n+1),a},EPUBJS.core.dataURLToBlob=function(r){var n=";base64,",a,s,l,f,h;if(r.indexOf(n)==-1)return a=r.split(","),s=a[0].split(":")[1],l=a[1],new Blob([l],{type:s});a=r.split(n),s=a[0].split(":")[1],l=window.atob(a[1]),f=l.length,h=new Uint8Array(f);for(var d=0;d<f;++d)h[d]=l.charCodeAt(d);return new Blob([h],{type:s})},EPUBJS.core.addScript=function(r,n,a){var s,l;l=!1,s=document.createElement("script"),s.type="text/javascript",s.async=!1,s.src=r,s.onload=s.onreadystatechange=function(){!l&&(!this.readyState||this.readyState=="complete")&&(l=!0,n&&n())},a=a||document.body,a.appendChild(s)},EPUBJS.core.addScripts=function(r,n,a){var s=r.length,l=0,f=function(){l++,s==l?n&&n():EPUBJS.core.addScript(r[l],f,a)};EPUBJS.core.addScript(r[l],f,a)},EPUBJS.core.addCss=function(r,n,a){var s,l;l=!1,s=document.createElement("link"),s.type="text/css",s.rel="stylesheet",s.href=r,s.onload=s.onreadystatechange=function(){!l&&(!this.readyState||this.readyState=="complete")&&(l=!0,n&&n())},a=a||document.body,a.appendChild(s)},EPUBJS.core.prefixed=function(r){var n=["Webkit","Moz","O","ms"],a=["-Webkit-","-moz-","-o-","-ms-"],s=r[0].toUpperCase()+r.slice(1),l=n.length;if(typeof document.documentElement.style[r]!="undefined")return r;for(var f=0;f<l;f++)if(typeof document.documentElement.style[n[f]+s]!="undefined")return n[f]+s;return r},EPUBJS.core.resolveUrl=function(r,n){var a,s=[],l=EPUBJS.core.uri(n),f=r.split("/"),h;return l.host?n:(f.pop(),h=n.split("/"),h.forEach(function(d){d===".."?f.pop():s.push(d)}),a=f.concat(s),a.join("/"))},EPUBJS.core.uuid=function(){var r=new Date().getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var s=(r+Math.random()*16)%16|0;return r=Math.floor(r/16),(a=="x"?s:s&7|8).toString(16)});return n},EPUBJS.core.insert=function(r,n,a){var s=EPUBJS.core.locationOf(r,n,a);return n.splice(s,0,r),s},EPUBJS.core.locationOf=function(r,n,a,s,l){var f=s||0,h=l||n.length,d=parseInt(f+(h-f)/2),g;return a||(a=function(y,p){if(y>p)return 1;if(y<p)return-1;if(y=p)return 0}),h-f<=0?d:(g=a(n[d],r),h-f==1?g>0?d:d+1:g===0?d:g===-1?EPUBJS.core.locationOf(r,n,a,d,h):EPUBJS.core.locationOf(r,n,a,f,d))},EPUBJS.core.indexOfSorted=function(r,n,a,s,l){var f=s||0,h=l||n.length,d=parseInt(f+(h-f)/2),g;return a||(a=function(y,p){if(y>p)return 1;if(y<p)return-1;if(y=p)return 0}),h-f<=0?-1:(g=a(n[d],r),h-f==1?g===0?d:-1:g===0?d:g===-1?EPUBJS.core.indexOfSorted(r,n,a,d,h):EPUBJS.core.indexOfSorted(r,n,a,f,d))},EPUBJS.core.queue=function(r){var n=[],a=r,s=function(g,y,p){return n.push({funcName:g,args:y,context:p}),n},l=function(){var g;n.length&&(g=n.shift(),a[g.funcName].apply(g.context||a,g.args))},f=function(){for(;n.length;)l()},h=function(){n=[]},d=function(){return n.length};return{enqueue:s,dequeue:l,flush:f,clear:h,length:d}},EPUBJS.core.getElementXPath=function(r){return r&&r.id?'//*[@id="'+r.id+'"]':EPUBJS.core.getElementTreeXPath(r)},EPUBJS.core.getElementTreeXPath=function(r){var n=[],a=r.ownerDocument.documentElement.getAttribute("xmlns")==="http://www.w3.org/1999/xhtml",s,l,f,h;for(r.nodeType===Node.TEXT_NODE&&(s=EPUBJS.core.indexOfTextNode(r)+1,n.push("text()["+s+"]"),r=r.parentNode);r&&r.nodeType==1;r=r.parentNode){s=0;for(var d=r.previousSibling;d;d=d.previousSibling)d.nodeType!=Node.DOCUMENT_TYPE_NODE&&d.nodeName==r.nodeName&&++s;l=r.nodeName.toLowerCase(),f=a?"xhtml:"+l:l,h=s?"["+(s+1)+"]":"",n.splice(0,0,f+h)}return n.length?"./"+n.join("/"):null},EPUBJS.core.nsResolver=function(r){var n={xhtml:"http://www.w3.org/1999/xhtml",epub:"http://www.idpf.org/2007/ops"};return n[r]||null},EPUBJS.core.cleanStringForXpath=function(r){var n=r.match(/[^'"]+|['"]/g);return n=n.map(function(a){return a==="'"?`"'"`:a==='"'?`'"'`:"'"+a+"'"}),"concat('',"+n.join(",")+")"},EPUBJS.core.indexOfTextNode=function(r){for(var n=r.parentNode,a=n.childNodes,s,l=-1,f=0;f<a.length&&(s=a[f],s.nodeType===Node.TEXT_NODE&&l++,s!=r);f++);return l},EPUBJS.core.defaults=function(r){for(var n=1,a=arguments.length;n<a;n++){var s=arguments[n];for(var l in s)r[l]===void 0&&(r[l]=s[l])}return r},EPUBJS.core.extend=function(r){var n=[].slice.call(arguments,1);return n.forEach(function(a){!a||Object.getOwnPropertyNames(a).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(a,s))})}),r},EPUBJS.core.clone=function(r){return EPUBJS.core.isArray(r)?r.slice():EPUBJS.core.extend({},r)},EPUBJS.core.isElement=function(r){return!!(r&&r.nodeType==1)},EPUBJS.core.isNumber=function(r){return!isNaN(parseFloat(r))&&isFinite(r)},EPUBJS.core.isString=function(r){return typeof r=="string"||r instanceof String},EPUBJS.core.isArray=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"},EPUBJS.core.values=function(r){var n=-1,a,s,l;if(!r)return[];for(a=Object.keys(r),s=a.length,l=Array(s);++n<s;)l[n]=r[a[n]];return l},EPUBJS.core.indexOfNode=function(r,n){for(var a=r.parentNode,s=a.childNodes,l,f=-1,h=0;h<s.length&&(l=s[h],l.nodeType===n&&f++,l!=r);h++);return f},EPUBJS.core.indexOfTextNode=function(r){return EPUBJS.core.indexOfNode(r,TEXT_NODE)},EPUBJS.core.indexOfElementNode=function(r){return EPUBJS.core.indexOfNode(r,ELEMENT_NODE)};var EPUBJS=EPUBJS||{};EPUBJS.reader={},EPUBJS.reader.plugins={},function(r,n){var a=r.ePubReader||{},s=r.ePubReader=function(l,f){return new EPUBJS.Reader(l,f)};typeof define=="function"&&define.amd?define(function(){return Reader}):typeof module!="undefined"&&module.exports&&(module.exports=s)}(window,jQuery),EPUBJS.Reader=function(r,n){var a=this,s,l,f=$("#viewer"),h=window.location.search,d;this.settings=EPUBJS.core.defaults(n||{},{bookPath:r,restore:!1,reload:!1,bookmarks:void 0,annotations:void 0,contained:void 0,bookKey:void 0,styles:void 0,sidebarReflow:!1,generatePagination:!1,history:!0}),h&&(d=h.slice(1).split("&"),d.forEach(function(g){var y=g.split("="),p=y[0],b=y[1]||"";a.settings[p]=decodeURIComponent(b)})),this.setBookKey(this.settings.bookPath),this.settings.restore&&this.isSaved()&&this.applySavedSettings(),this.settings.styles=this.settings.styles||{fontSize:"100%"},this.book=s=new ePub(this.settings.bookPath,this.settings),this.offline=!1,this.sidebarOpen=!1,this.settings.bookmarks||(this.settings.bookmarks=[]),this.settings.annotations||(this.settings.annotations=[]),this.settings.generatePagination&&s.generatePagination(f.width(),f.height()),this.rendition=s.renderTo("viewer",{ignoreClass:"annotator-hl",width:"100%",height:"100%"}),this.settings.previousLocationCfi?this.displayed=this.rendition.display(this.settings.previousLocationCfi):this.displayed=this.rendition.display(),s.ready.then(function(){a.ReaderController=EPUBJS.reader.ReaderController.call(a,s),a.SettingsController=EPUBJS.reader.SettingsController.call(a,s),a.ControlsController=EPUBJS.reader.ControlsController.call(a,s),a.SidebarController=EPUBJS.reader.SidebarController.call(a,s),a.BookmarksController=EPUBJS.reader.BookmarksController.call(a,s),a.NotesController=EPUBJS.reader.NotesController.call(a,s),window.addEventListener("hashchange",this.hashChanged.bind(this),!1),document.addEventListener("keydown",this.adjustFontSize.bind(this),!1),this.rendition.on("keydown",this.adjustFontSize.bind(this)),this.rendition.on("keydown",a.ReaderController.arrowKeys.bind(this)),this.rendition.on("selected",this.selectedRange.bind(this))}.bind(this)).then(function(){a.ReaderController.hideLoader()}.bind(this));for(l in EPUBJS.reader.plugins)EPUBJS.reader.plugins.hasOwnProperty(l)&&(a[l]=EPUBJS.reader.plugins[l].call(a,s));return s.loaded.metadata.then(function(g){a.MetaController=EPUBJS.reader.MetaController.call(a,g)}),s.loaded.navigation.then(function(g){a.TocController=EPUBJS.reader.TocController.call(a,g)}),window.addEventListener("beforeunload",this.unload.bind(this),!1),this},EPUBJS.Reader.prototype.adjustFontSize=function(r){var n,a=2,s=187,l=189,f=48,h=r.ctrlKey||r.metaKey;!this.settings.styles||(this.settings.styles.fontSize||(this.settings.styles.fontSize="100%"),n=parseInt(this.settings.styles.fontSize.slice(0,-1)),h&&r.keyCode==s&&(r.preventDefault(),this.book.setStyle("fontSize",n+a+"%")),h&&r.keyCode==l&&(r.preventDefault(),this.book.setStyle("fontSize",n-a+"%")),h&&r.keyCode==f&&(r.preventDefault(),this.book.setStyle("fontSize","100%")))},EPUBJS.Reader.prototype.addBookmark=function(r){var n=this.isBookmarked(r);n>-1||(this.settings.bookmarks.push(r),this.trigger("reader:bookmarked",r))},EPUBJS.Reader.prototype.removeBookmark=function(r){var n=this.isBookmarked(r);n!==-1&&(this.settings.bookmarks.splice(n,1),this.trigger("reader:unbookmarked",n))},EPUBJS.Reader.prototype.isBookmarked=function(r){var n=this.settings.bookmarks;return n.indexOf(r)},EPUBJS.Reader.prototype.clearBookmarks=function(){this.settings.bookmarks=[]},EPUBJS.Reader.prototype.addNote=function(r){this.settings.annotations.push(r)},EPUBJS.Reader.prototype.removeNote=function(r){var n=this.settings.annotations.indexOf(r);n!==-1&&delete this.settings.annotations[n]},EPUBJS.Reader.prototype.clearNotes=function(){this.settings.annotations=[]},EPUBJS.Reader.prototype.setBookKey=function(r){return this.settings.bookKey||(this.settings.bookKey="epubjsreader:"+EPUBJS.VERSION+":"+window.location.host+":"+r),this.settings.bookKey},EPUBJS.Reader.prototype.isSaved=function(r){var n;return!(!localStorage||(n=localStorage.getItem(this.settings.bookKey),n===null))},EPUBJS.Reader.prototype.removeSavedSettings=function(){if(!localStorage)return!1;localStorage.removeItem(this.settings.bookKey)},EPUBJS.Reader.prototype.applySavedSettings=function(){var r;if(!localStorage)return!1;try{r=JSON.parse(localStorage.getItem(this.settings.bookKey))}catch(n){return!1}return r?(r.styles&&(this.settings.styles=EPUBJS.core.defaults(this.settings.styles||{},r.styles)),this.settings=EPUBJS.core.defaults(this.settings,r),!0):!1},EPUBJS.Reader.prototype.saveSettings=function(){if(this.book&&(this.settings.previousLocationCfi=this.rendition.currentLocation().start.cfi),!localStorage)return!1;localStorage.setItem(this.settings.bookKey,JSON.stringify(this.settings))},EPUBJS.Reader.prototype.unload=function(){this.settings.restore&&localStorage&&this.saveSettings()},EPUBJS.Reader.prototype.hashChanged=function(){var r=window.location.hash.slice(1);this.rendition.display(r)},EPUBJS.Reader.prototype.selectedRange=function(r){var n="#"+r;this.settings.history&&window.location.hash!=n&&(history.pushState({},"",n),this.currentLocationCfi=r)},RSVP.EventTarget.mixin(EPUBJS.Reader.prototype),EPUBJS.reader.BookmarksController=function(){var r=this,n=this.book,a=this.rendition,s=$("#bookmarksView"),l=s.find("#bookmarks"),f=document.createDocumentFragment(),h=function(){s.show()},d=function(){s.hide()},g=0,y=function(p){var b=document.createElement("li"),w=document.createElement("a");b.id="bookmark-"+g,b.classList.add("list_item");var C=n.spine.get(p),x;return C.index in n.navigation.toc?(x=n.navigation.toc[C.index],w.textContent=x.label):w.textContent=p,w.href=p,w.classList.add("bookmark_link"),w.addEventListener("click",function(R){var _=this.getAttribute("href");a.display(_),R.preventDefault()},!1),b.appendChild(w),g++,b};return this.settings.bookmarks.forEach(function(p){var b=y(p);f.appendChild(b)}),l.append(f),this.on("reader:bookmarked",function(p){var b=y(p);l.append(b)}),this.on("reader:unbookmarked",function(p){var b=$("#bookmark-"+p);b.remove()}),{show:h,hide:d}},EPUBJS.reader.ControlsController=function(r){var n=this,a=this.rendition,s=$("#store"),l=$("#fullscreen"),f=$("#fullscreenicon"),h=$("#cancelfullscreenicon"),d=$("#slider"),g=$("#main"),y=$("#sidebar"),p=$("#setting"),b=$("#bookmark");return d.on("click",function(){n.sidebarOpen?(n.SidebarController.hide(),d.addClass("icon-menu"),d.removeClass("icon-right")):(n.SidebarController.show(),d.addClass("icon-right"),d.removeClass("icon-menu"))}),typeof screenfull!="undefined"&&(l.on("click",function(){screenfull.toggle($("#container")[0])}),screenfull.raw&&document.addEventListener(screenfull.raw.fullscreenchange,function(){fullscreen=screenfull.isFullscreen,fullscreen?l.addClass("icon-resize-small").removeClass("icon-resize-full"):l.addClass("icon-resize-full").removeClass("icon-resize-small")})),p.on("click",function(){n.SettingsController.show()}),b.on("click",function(){var w=n.rendition.currentLocation().start.cfi,C=n.isBookmarked(w);C===-1?(n.addBookmark(w),b.addClass("icon-bookmark").removeClass("icon-bookmark-empty")):(n.removeBookmark(w),b.removeClass("icon-bookmark").addClass("icon-bookmark-empty"))}),a.on("relocated",function(w){var C=w.start.cfi,x="#"+C,R=n.isBookmarked(C);R===-1?b.removeClass("icon-bookmark").addClass("icon-bookmark-empty"):b.addClass("icon-bookmark").removeClass("icon-bookmark-empty"),n.currentLocationCfi=C,n.settings.history&&window.location.hash!=x&&history.pushState({},"",x)}),{}},EPUBJS.reader.MetaController=function(r){var n=r.title,a=r.creator,s=$("#book-title"),l=$("#chapter-title"),f=$("#title-seperator");document.title=n+" \u2013 "+a,s.html(n),l.html(a),f.show()},EPUBJS.reader.NotesController=function(){var r=this.book,n=this.rendition,a=this,s=$("#notesView"),l=$("#notes"),f=$("#note-text"),h=$("#note-anchor"),d=a.settings.annotations,g=r.renderer,y=[],p=new ePub.CFI,b=function(){s.show()},w=function(){s.hide()},C=function(S){var O,m,E,N=r.renderer.doc,D,z;if(N.caretPositionFromPoint?(O=N.caretPositionFromPoint(S.clientX,S.clientY),m=O.offsetNode,E=O.offset):N.caretRangeFromPoint&&(O=N.caretRangeFromPoint(S.clientX,S.clientY),m=O.startContainer,E=O.startOffset),m.nodeType!==3){for(var X=0;X<m.childNodes.length;X++)if(m.childNodes[X].nodeType==3){m=m.childNodes[X];break}}E=m.textContent.indexOf(".",E),E===-1?E=m.length:E+=1,D=p.generateCfiFromTextNode(m,E,r.renderer.currentChapter.cfiBase),z={annotatedAt:new Date,anchor:D,body:f.val()},a.addNote(z),x(z),R(z),f.val(""),h.text("Attach"),f.prop("disabled",!1),n.off("click",C)},x=function(S){var O=document.createElement("li"),m=document.createElement("a");O.innerHTML=S.body,m.innerHTML=" context &#187;",m.href="#"+S.anchor,m.onclick=function(){return n.display(S.anchor),!1},O.appendChild(m),l.append(O)},R=function(S){var O=r.renderer.doc,m=document.createElement("span"),E=document.createElement("a");m.classList.add("footnotesuperscript","reader_generated"),m.style.verticalAlign="super",m.style.fontSize=".75em",m.style.lineHeight="1em",E.style.padding="2px",E.style.backgroundColor="#fffa96",E.style.borderRadius="5px",E.style.cursor="pointer",m.id="note-"+EPUBJS.core.uuid(),E.innerHTML=d.indexOf(S)+1+"[Reader]",m.appendChild(E),p.addMarker(S.anchor,O,m),_(m,S.body)},_=function(S,O){var m=S.id,E=function(){var ue,q=g.height,Y=g.width,I,P,A=225,T,j,K,Z;y[m]||(y[m]=document.createElement("div"),y[m].setAttribute("class","popup"),pop_content=document.createElement("div"),y[m].appendChild(pop_content),pop_content.innerHTML=O,pop_content.setAttribute("class","pop_content"),g.render.document.body.appendChild(y[m]),y[m].addEventListener("mouseover",N,!1),y[m].addEventListener("mouseout",D,!1),n.on("locationChanged",z,this),n.on("locationChanged",D,this)),P=y[m],T=S.getBoundingClientRect(),j=T.left,K=T.top,P.classList.add("show"),popRect=P.getBoundingClientRect(),P.style.left=j-popRect.width/2+"px",P.style.top=K+"px",A>q/2.5&&(A=q/2.5,pop_content.style.maxHeight=A+"px"),popRect.height+K>=q-25?(P.style.top=K-popRect.height+"px",P.classList.add("above")):P.classList.remove("above"),j-popRect.width<=0?(P.style.left=j+"px",P.classList.add("left")):P.classList.remove("left"),j+popRect.width/2>=Y?(P.style.left=j-300+"px",popRect=P.getBoundingClientRect(),P.style.left=j-popRect.width+"px",popRect.height+K>=q-25?(P.style.top=K-popRect.height+"px",P.classList.add("above")):P.classList.remove("above"),P.classList.add("right")):P.classList.remove("right")},N=function(){y[m].classList.add("on")},D=function(){y[m].classList.remove("on")},z=function(){setTimeout(function(){y[m].classList.remove("show")},100)},X=function(){a.ReaderController.slideOut(),b()};S.addEventListener("mouseover",E,!1),S.addEventListener("mouseout",z,!1),S.addEventListener("click",X,!1)};return h.on("click",function(S){h.text("Cancel"),f.prop("disabled","true"),n.on("click",C)}),d.forEach(function(S){x(S)}),{show:b,hide:w}},EPUBJS.reader.ReaderController=function(r){var n=$("#main"),a=$("#divider"),s=$("#loader"),l=$("#next"),f=$("#prev"),h=this,r=this.book,d=this.rendition,g=function(){var _=d.currentLocation().start.cfi;h.settings.sidebarReflow?(n.removeClass("single"),n.one("transitionend",function(){d.resize()})):n.removeClass("closed")},y=function(){var _=d.currentLocation();if(!!_){var S=_.start.cfi;h.settings.sidebarReflow?(n.addClass("single"),n.one("transitionend",function(){d.resize()})):n.addClass("closed")}},p=function(){s.show(),C()},b=function(){s.hide()},w=function(){a.addClass("show")},C=function(){a.removeClass("show")},x=!1,R=function(_){_.keyCode==37&&(r.package.metadata.direction==="rtl"?d.next():d.prev(),f.addClass("active"),x=!0,setTimeout(function(){x=!1,f.removeClass("active")},100),_.preventDefault()),_.keyCode==39&&(r.package.metadata.direction==="rtl"?d.prev():d.next(),l.addClass("active"),x=!0,setTimeout(function(){x=!1,l.removeClass("active")},100),_.preventDefault())};return document.addEventListener("keydown",R,!1),l.on("click",function(_){r.package.metadata.direction==="rtl"?d.prev():d.next(),_.preventDefault()}),f.on("click",function(_){r.package.metadata.direction==="rtl"?d.next():d.prev(),_.preventDefault()}),d.on("layout",function(_){_.spread===!0?w():C()}),d.on("relocated",function(_){_.atStart&&f.addClass("disabled"),_.atEnd&&l.addClass("disabled")}),{slideOut:y,slideIn:g,showLoader:p,hideLoader:b,showDivider:w,hideDivider:C,arrowKeys:R}},EPUBJS.reader.SettingsController=function(){var r=this.book,n=this,a=$("#settings-modal"),s=$(".overlay"),l=function(){a.addClass("md-show")},f=function(){a.removeClass("md-show")},h=$("#sidebarReflow");return h.on("click",function(){n.settings.sidebarReflow=!n.settings.sidebarReflow}),a.find(".closer").on("click",function(){f()}),s.on("click",function(){f()}),{show:l,hide:f}},EPUBJS.reader.SidebarController=function(r){var n=this,a=$("#sidebar"),s=$("#panels"),l="Toc",f=function(y){var p=y+"Controller";l==y||typeof n[p]=="undefined"||(n[l+"Controller"].hide(),n[p].show(),l=y,s.find(".active").removeClass("active"),s.find("#show-"+y).addClass("active"))},h=function(){return l},d=function(){n.sidebarOpen=!0,n.ReaderController.slideOut(),a.addClass("open")},g=function(){n.sidebarOpen=!1,n.ReaderController.slideIn(),a.removeClass("open")};return s.find(".show_view").on("click",function(y){var p=$(this).data("view");f(p),y.preventDefault()}),{show:d,hide:g,getActivePanel:h,changePanelTo:f}},EPUBJS.reader.TocController=function(r){var n=this.book,a=this.rendition,s=$("#tocView"),l=document.createDocumentFragment(),f=!1,h=function(b,w){var C=document.createElement("ul");return w||(w=1),b.forEach(function(x){var R=document.createElement("li"),_=document.createElement("a");toggle=document.createElement("a");var S;R.id="toc-"+x.id,R.classList.add("list_item"),_.textContent=x.label,_.href=x.href,_.classList.add("toc_link"),R.appendChild(_),x.subitems&&x.subitems.length>0&&(w++,S=h(x.subitems,w),toggle.classList.add("toc_toggle"),R.insertBefore(toggle,_),R.appendChild(S)),C.appendChild(R)}),C},d=function(){s.show()},g=function(){s.hide()},y=function(b){var w=b.id,C=s.find("#toc-"+w),x=s.find(".currentChapter"),R=s.find(".openChapter");C.length&&(C!=x&&C.has(f).length>0&&x.removeClass("currentChapter"),C.addClass("currentChapter"),C.parents("li").addClass("openChapter"))};a.on("renderered",y);var p=h(r);return l.appendChild(p),s.append(l),s.find(".toc_link").on("click",function(b){var w=this.getAttribute("href");b.preventDefault(),a.display(w),s.find(".currentChapter").addClass("openChapter").removeClass("currentChapter"),$(this).parent("li").addClass("currentChapter")}),s.find(".toc_toggle").on("click",function(b){var w=$(this).parent("li"),C=w.hasClass("openChapter");b.preventDefault(),C?w.removeClass("openChapter"):w.addClass("openChapter")}),{show:d,hide:g}};
